<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Boli Help — Szczegóły</title>
  <meta name="theme-color" content="#0e1230" />
  <style>
    :root{
      --bg:#0e1230; --text:#eef2ff; --muted:#b8c2e0;
      --card: rgba(60,32,100,.30); --stroke: rgba(164,107,255,.18);
      --accent:#a46bff; --pink:#ff6ec7; --teal:#5eead4;
      --ok:#70e1b1; --warn:#ffd16c; --danger:#ff6b6b;
      --radius:16px; --gap:14px; --speed:.24s;
      --c-symptoms: rgba(94,234,212,.55);
      --c-causes:   rgba(164,107,255,.55);
      --c-firstaid: rgba(112,225,177,.55);
      --c-otc:      rgba(255,184,108,.65);
      --c-rx:       rgba(255,107,107,.70);
      --c-rehab:    rgba(94,234,212,.65);
      --c-myths:    rgba(164,107,255,.65);
      --c-faq:      rgba(94,234,212,.55);
      --c-dx:       rgba(164,107,255,.65);
      --c-docs:     rgba(94,234,212,.65);
    }
    *{box-sizing:border-box} html,body{height:100%}
    body[data-page="szczegoly"]{margin:0; background:var(--bg); color:var(--text);
      font:15px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;}
    .bg-anim{position:fixed; inset:0; z-index:-3; pointer-events:none;
      background:
        radial-gradient(42vw 36vh at 16% 12%, rgba(255,110,199,.26), transparent 60%),
        radial-gradient(36vw 30vh at 84% 10%, rgba(94,234,212,.22), transparent 60%),
        radial-gradient(40vw 44vh at 20% 88%, rgba(164,107,255,.16), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,0));
      filter: blur(10px) saturate(118%);
    }
    .grid-bg{position:fixed; inset:0; z-index:-2; pointer-events:none; opacity:.22;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='104' viewBox='0 0 120 104'%3E%3Cg fill='none' stroke='rgba(173,216,255,0.26)' stroke-width='1'%3E%3Cpolygon points='30,0 90,0 120,52 90,104 30,104 0,52'/%3E%3C/g%3E%3C/svg%3E");
      background-size:160px 138px; background-position:center;}
    #bh-particles{ position:fixed; inset:0; z-index:-1; opacity:.85; pointer-events:none }

    header.app{ max-width:1100px; margin:16px auto 0; padding:16px 16px 8px; }
    main{ max-width:1100px; margin:0 auto 72px; padding:0 16px 24px; }
    .bh-backbar{max-width:1100px; margin:8px auto 0; padding:0 16px;}
    #bhReturnTop{
      appearance:none; border:1px solid rgba(164,107,255,.28); background:rgba(60,32,100,.28);
      color:#eef2ff; font-weight:800; letter-spacing:.2px; padding:10px 14px; border-radius:12px; cursor:pointer;
      box-shadow:0 6px 16px rgba(8,10,22,.35), inset 0 0 0 1px rgba(164,107,255,.12), 0 0 8px rgba(164,107,255,.45);
      transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease;
    }
    #bhReturnTop:hover{ transform:translateY(-1px); border-color:rgba(164,107,255,.55); box-shadow:0 10px 20px rgba(8,10,22,.45), 0 0 14px rgba(164,107,255,.65), inset 0 0 0 1px rgba(164,107,255,.18) }
    #bhReturnTop:focus-visible{ outline:2px solid rgba(164,107,255,.75); outline-offset:2px }

    .hero{ background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid var(--stroke); border-radius:var(--radius); padding:16px;
      backdrop-filter: blur(6px) saturate(120%); box-shadow: 0 18px 48px rgba(8,10,22,.55), 0 0 22px rgba(164,107,255,.18);}
    .hero-top{ display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap;}
    .crumbs{font-weight:800; letter-spacing:.2px; color:#cfe2ff}
    .label{ display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px;
      background: rgba(164,107,255,.18); border:1px solid var(--stroke); font-weight:800; letter-spacing:.3px; }
    .hero-note{ margin-top:10px; color:#b8c2e0; font-size:13px; }
    .legend{ color:#d6e4ff; font-weight:700; margin-top:6px; font-size:13px }

    .steps{display:grid; grid-template-columns:repeat(4,1fr); gap:8px; margin:14px 0 0}
    .step{position:relative; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.05); font-weight:900; letter-spacing:.2px; color:#dfe6ff; text-align:center}
    .step.active{border-color:rgba(94,234,212,.55); box-shadow:0 0 0 2px rgba(94,234,212,.35), 0 8px 18px rgba(8,10,22,.35)}

    .tabs{ display:flex; flex-wrap:wrap; gap:8px; margin:16px 0 8px; }
    .tab{ padding:9px 13px; border-radius:10px; font-weight:800; letter-spacing:.2px; cursor:pointer; user-select:none;
      background: transparent; border:1px solid rgba(255,255,255,.16); color:#e9efff;
      transition: box-shadow var(--speed), transform var(--speed), border-color var(--speed), background var(--speed);}
    .tab:hover{ transform: translateY(-1px); }
    .tab[aria-selected="true"]{ box-shadow:0 0 0 2px rgba(94,234,212,.35); border-color:rgba(94,234,212,.55) }

    .cards{ margin-top:8px }
    .card{ display:none; background: var(--card); border:1px solid var(--stroke); border-radius:var(--radius);
      padding:16px 16px 14px; backdrop-filter: blur(10px) saturate(125%); box-shadow: 0 14px 34px rgba(8,10,22,.42);
      transition: transform var(--speed), box-shadow var(--speed), border-color var(--speed); color:var(--text); }
    .card[aria-hidden="false"]{ display:block; animation:fadeIn .28s ease both }
    @keyframes fadeIn{ from{opacity:0; transform:translateY(4px)} to{opacity:1; transform:none} }
    .card h3{ position:relative; margin:.15rem 0 .85rem; font-size:16px; font-weight:900; letter-spacing:.3px; color:#e6f0ff }
    .card h3::after{ content:""; display:block; height:1px; margin-top:.55rem;
      background:linear-gradient(90deg, rgba(207,226,255,.55), rgba(255,255,255,.08) 45%, transparent); }

    ul.clean{ list-style:none; margin:0; padding:0 }
    ul.clean li{ position:relative; padding:10px 12px 10px 36px; border-radius:10px; margin-bottom:7px;
      border:1px solid rgba(255,255,255,.10); background: rgba(255,255,255,.03); color:#f6f8ff; }
    .cb{ position:absolute; left:10px; top:50%; transform:translateY(-50%); width:18px; height:18px; border-radius:4px;
      border:1px solid rgba(255,255,255,.35); background:rgba(255,255,255,.05); display:inline-block }
    .cb.checked{ background:#fff; box-shadow:0 0 0 2px rgba(164,107,255,.25) inset }
    .li-checked{ outline:1px solid rgba(164,107,255,.45); background: rgba(164,107,255,.10) }

    .risk-mini{ display:flex; align-items:center; gap:10px; margin:.15rem 0 .35rem }
    .risk-mini small{ color:#d6e4ff; font-weight:800 }
    .riskbar{ position:relative; width:200px; height:12px; border-radius:999px; overflow:hidden;
      outline:1px solid rgba(255,255,255,.16);
      background: linear-gradient(90deg, var(--ok), var(--warn), var(--danger)); }
    .cursor{ position:absolute; top:50%; transform:translate(-50%,-50%); width:16px; height:16px; border-radius:50%; background:#fff }

    .strip{ background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      border: 1px solid rgba(255,255,255,.16); padding:.7rem 1rem; border-radius:.8rem; margin:.6rem 0; }
    .strip--warn{ background: linear-gradient(180deg, rgba(255,184,108,.18), rgba(255,255,255,.04)); border-color: rgba(255,184,108,.55); }
    .cta{ display:inline-block; padding:8px 12px; border-radius:10px; font-weight:900; background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.18); text-decoration:none; color:var(--text); }

    .dx-hint{ display:none; margin-top:10px; border-radius:10px; padding:10px 12px;
      background:rgba(164,107,255,.12); border:1px solid rgba(164,107,255,.35); color:#e9e6ff; }
    .dx-hint.show{ display:block }
    .dx-hint button{ margin-left:8px; padding:8px 10px; border-radius:10px; font-weight:900; cursor:pointer;
      background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.18); color:#fff }

    .dx-ico{ width:22px; height:22px; display:grid; place-items:center; border-radius:6px;
      background:rgba(164,107,255,.18); border:1px solid rgba(164,107,255,.35) }
    .dx-meta{ margin-left:auto; display:flex; flex-direction:column; align-items:flex-end; gap:6px; min-width:160px }
    .conf-wrap{ width:120px; height:8px; border-radius:999px; outline:1px solid rgba(255,255,255,.16); overflow:hidden;
      background:linear-gradient(90deg, rgba(94,234,212,.25), rgba(164,107,255,.25)); }
    .conf-bar{ height:100%; width:0%; background:linear-gradient(90deg, rgba(94,234,212,.65), rgba(164,107,255,.65)) }
    .dx-badge,.doc-badge{ font-size:12px; padding:4px 8px; border-radius:999px; font-weight:900; letter-spacing:.2px; }
    .dx-badge.poz,.doc-badge.poz{ background:rgba(94,234,212,.18); border:1px solid rgba(94,234,212,.45); color:#d9fffa }
    .dx-badge.sor,.doc-badge.sor{ background:rgba(255,107,107,.20); border:1px solid rgba(255,107,107,.65); color:#ffe6e6 }
  </style>

  <style>
    html,body{max-width:100%;overflow-x:hidden}
    *,*::before,*::after{box-sizing:border-box}
    img,video,canvas{max-width:100%;height:auto}
    .bg-anim,.grid-bg,#bh-particles{position:fixed;inset:0;pointer-events:none}

    @media (max-width:768px){
      /* ukryj ewentualny stary selektor w headerze */
      .header .tools :is(.lang,.langpick,#bhLangPick){display:none!important}
      .header .tools :is(.lang,.langpick,#bhLangPick)::before,
      .header .tools :is(.lang,.langpick,#bhLangPick)::after{content:none!important;display:none!important}

      /* jedyna definicja pływającego guzika języka, aby nadpisać tę z main.css */
      #bhLangPick {
        top: 10px !important; right: 12px !important; padding: 5px 8px !important;
        background: rgba(14,18,48,.8) !important; border:1px solid rgba(164,107,255,.4) !important;
      }
      #bhLangSelect{ font-size: 13px !important; }
    }
  </style>
</head>
<body data-page="szczegoly">

  <div class="bg-anim"></div>
  <div class="grid-bg"></div>
  <div id="bh-particles"></div>

  <div class="bh-backbar">
    <a href="./index.html" id="bhReturnTop">← Powrót do wyboru</a>
  </div>

  <header class="app">
    <div class="hero">
      <div class="hero-top">
        <div class="crumbs" id="breadcrumbs">
          <span id="crumb-typ"></span>
          <span>&nbsp;›&nbsp;</span>
          <span id="crumb-label"></span>
        </div>
        <div class="label" id="bh-label-wrap">
          <svg viewBox="0 0 24 24" width="22" height="22" fill="#fff"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>
          <span id="label-text"></span>
        </div>
      </div>
      <p class="hero-note" id="hero-note"></p>
      <div class="legend" id="legend"></div>

      <div class="steps">
        <div class="step active" id="s-objawy">Objawy (Wybór)</div>
        <div class="step" id="s-diagnoza">Diagnoza (Wstępna)</div>
        <div class="step" id="s-pomoc">Leczenie / Pomoc</div>
        <div class="step" id="s-mity">Mity / FAQ</div>
      </div>
    </div>
  </header>

  <main>
    <div class="tabs">
      <div class="tab" data-target="#card-symptoms" aria-selected="true" data-variant="symptoms" id="tab-symptoms">Objawy</div>
      <div class="tab" data-target="#card-dx" data-variant="dx" id="tab-dx">Diagnostyka</div>
      <div class="tab" data-target="#card-cause" data-variant="causes" id="tab-cause">Przyczyny</div>
      <div class="tab" data-target="#card-aid" data-variant="firstaid" id="tab-aid">Pierwsza Pomoc</div>
      <div class="tab" data-target="#card-otc" data-variant="otc" id="tab-otc">OTC / Bez recepty</div>
      <div class="tab" data-target="#card-rx" data-variant="rx" id="tab-rx">RX / Na receptę</div>
      <div class="tab" data-target="#card-rehab" data-variant="rehab" id="tab-rehab">Rehabilitacja</div>
      <div class="tab" data-target="#card-myths" data-variant="myths" id="tab-myths">Mity / Fakty</div>
      <div class="tab" data-target="#card-faq" data-variant="faq" id="tab-faq">FAQ</div>
      <div class="tab" data-target="#card-docs" data-variant="docs" id="tab-docs">Lekarze</div>
    </div>

    <div class="cards">

      <div class="card" id="card-symptoms" role="tabpanel" aria-hidden="false">
        <div class="risk-mini">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="#ffb86c"><path d="M12 2L1 21h22L12 2zm0 4.99L18.47 18H5.53L12 6.99zM13 16h-2v2h2v-2zm0-4h-2v4h2v-4z"/></svg>
          <div class="riskbar"><span class="cursor" id="risk-cursor-card" style="left:5%"></span></div>
          <small>Ryzyko: <span id="risk-label">Niskie</span></small>
        </div>
        <p class="strip strip--warn" id="urgent-strip"></p>

        <h3 id="h-obj"></h3>
        <ul class="clean" id="symp-common"></ul>

        <h3 class="subhead"></h3>
        <ul class="clean" id="urgent"></ul>

        <div class="dx-hint" id="dx-hint">
          Wybrano <span id="dx-count-text">0</span> objawów.
          <button id="dx-btn">Oceń ryzyko i diagnozę</button>
        </div>
      </div>

      <div class="card" id="card-dx" role="tabpanel" aria-hidden="true">
        <h3 id="h-dx"></h3>
        <ul class="clean" id="dx-list"></ul>
      </div>

      <div class="card" id="card-cause" role="tabpanel" aria-hidden="true">
        <h3 id="h-cause"></h3>
        <ul class="clean" id="causes"></ul>
      </div>

      <div class="card" id="card-aid" role="tabpanel" aria-hidden="true">
        <h3 id="h-aid"></h3>
        <ul class="clean" id="firstaid"></ul>
      </div>

      <div class="card" id="card-otc" role="tabpanel" aria-hidden="true">
        <h3 id="h-otc"></h3>
        <ul class="clean" id="meds-otc"></ul>
      </div>

      <div class="card" id="card-rx" role="tabpanel" aria-hidden="true">
        <h3 id="h-rx"></h3>
        <ul class="clean" id="meds-rx"></ul>
      </div>

      <div class="card" id="card-rehab" role="tabpanel" aria-hidden="true">
        <h3 id="h-rehab"></h3>
        <ul class="clean" id="rehab"></ul>
      </div>

      <div class="card" id="card-myths" role="tabpanel" aria-hidden="true">
        <h3 id="h-mity"></h3>
        <ul class="clean" id="myths"></ul>
      </div>

      <div class="card" id="card-faq" role="tabpanel" aria-hidden="true">
        <h3 id="h-faq"></h3>
        <ul class="clean" id="faq"></ul>
      </div>

      <div class="card" id="card-docs" role="tabpanel" aria-hidden="true">
        <h3 id="h-docs"></h3>
        <ul class="clean" id="docs-list"></ul>
      </div>

    </div>
  </main>

  <script>
    // ========== TŁUMACZENIA GLOBALNE ==========
    const I18N = {
      pl: {
        crumbs_details: "Szczegóły",
        hero_note: "Wybierz **wszystkie** objawy, które Cię dotyczą. System automatycznie obliczy wstępny poziom ryzyka (od 0 do 100) i zasugeruje diagnozy.",
        legend: "⚠️ **Ryzyko** (od 0 do 100) jest orientacyjne. Używaj go jako wskazówki, a nie ostatecznej diagnozy.",
        urgent_strip: "Objawy alarmowe: nie bagatelizuj! Zobacz poniżej, które. W razie nagłego zagrożenia zdrowia:",
        call_112: "Zadzwoń na 112",
        risk: "Ryzyko:",
        risk_low: "Niskie (Leczenie w domu / POZ)",
        risk_mid: "Średnie (POZ / Specjalista)",
        risk_high: "Wysokie (SOR / Pilna pomoc)",
        symptoms_head: "Objawy główne (do wyboru)",
        urgent_head: "Objawy ALARMOWE (czerwone flagi)",
        back: "← Powrót do wyboru",
        lang_label: "Język",
        tabs: {
          symptoms: "Objawy", causes: "Przyczyny", firstaid: "Pierwsza Pomoc",
          otc: "OTC / Bez recepty", rx: "RX / Na receptę", rehab: "Rehabilitacja",
          myths: "Mity / Fakty", faq: "FAQ", dx: "Diagnoza", docs: "Lekarze"
        },
        docs_pl: {
          poz: "Lekarz POZ / Rodzinny", spec: "Lekarz Specjalista", sor: "SOR / Pomoc doraźna"
        },
        dx_btn_txt: "Oceń ryzyko i diagnozę"
      },
      en: {
        crumbs_details: "Details",
        hero_note: "Select **all** symptoms that apply to you. The system will automatically calculate a preliminary risk level (from 0 to 100) and suggest potential diagnoses.",
        legend: "⚠️ **Risk** (from 0 to 100) is indicative. Use it as a guide, not a final diagnosis.",
        urgent_strip: "Alarm symptoms: do not ignore! See below. In case of sudden health threat:",
        call_112: "Call 112 / 999",
        risk: "Risk:",
        risk_low: "Low (Home treatment / GP)",
        risk_mid: "Medium (GP / Specialist)",
        risk_high: "High (ER / Urgent care)",
        symptoms_head: "Main symptoms (selectable)",
        urgent_head: "ALARM symptoms (red flags)",
        back: "← Back to selection",
        lang_label: "Language",
        tabs: {
          symptoms: "Symptoms", causes: "Causes", firstaid: "First Aid",
          otc: "OTC / Over the Counter", rx: "RX / Prescription", rehab: "Rehabilitation",
          myths: "Myths / Facts", faq: "FAQ", dx: "Diagnosis", docs: "Doctors"
        },
        docs_pl: {
          poz: "GP / Family Doctor", spec: "Specialist Doctor", sor: "ER / Emergency Department"
        },
        dx_btn_txt: "Calculate risk and diagnosis"
      }
    };

    // ========== JĘZYK: Odczyt z LocalStorage lub domyślnie 'pl' ==========
    const L=()=> localStorage.getItem('bh_lang') || 'pl';

    // ========== DANE CZĘŚCI CIAŁA (CONTENT_PL) – POPRAWIONY I UZUPEŁNIONY BLOK ==========
    const CONTENT_PL={
      glowa:{label:"Głowa / Twarz",symptoms:[{t:"Silny, pulsujący ból",audience:"adult"},{t:"Ból z tyłu głowy (napięciowy)",audience:"adult"},"Zawroty głowy","Drętwienie / mrowienie twarzy"],causes:["Migrena","Ból napięciowy","Zapalenie zatok","Udar (pilne)"],urgent:[{t:"Najgorszy ból głowy w życiu (nagły) — pilne",audience:"adult"},{t:"Utrata przytomności",audience:"adult"},{t:"Sztywność karku",audience:"adult"},{t:"Drgawki",audience:"adult"}],otc:["Paracetamol","Ibuprofen"],rx:["Tryptany (migrena)","Leki przeciwpadaczkowe"],rehab:["Terapia manualna","Higiena snu"],myths:[{m:"Każdy ból głowy to migrena",f:"Migrena to 15% bólów głowy. Najczęstszy jest napięciowy."}, {m:"Przeziębienia to tylko zmęczenie",f:"Nie. Są spowodowane wirusami i wymagają odpoczynku, nie tylko ignorowania."}],faq:[{q:"Kiedy do neurologa?",a:"Przy nawracających migrenach lub chronicznym bólu głowy."}, {q:"Czy picie kawy pomaga?",a:"Może pomóc na migrenę, ale nadużywanie prowadzi do bólu polekowego."}]},
      nos:{label:"Nos / Zatoki",symptoms:["Zatkany nos / uczucie ucisku","Wodnisty lub gęsty katar","Ból w okolicy policzków/czoła","Utrata węchu"],causes:["Nieżyt nosa (alergiczny/infekcyjny)","Zapalenie zatok","Polipy w nosie"],urgent:["Krwawienie z nosa nie dające się zatamować","Puchnięcie oka/twarzy (zatoki)"],otc:["Krople obkurczające","Woda morska","Leki przeciwalergiczne"],rx:["Antybiotyki (rzadko, na zapalenie zatok)","Sterydy donosowe"],rehab:["Płukanie zatok","Unikanie alergenów"],myths:[{m:"Katar leczy się tydzień, a nieleczony 7 dni",f:"Leczenie objawowe skraca czas trwania kataru i ułatwia codzienne funkcjonowanie."}, {m:"Zawsze muszę smarkać mocno",f:"Zbyt mocne wydmuchiwanie kataru może wepchnąć infekcję do zatok lub ucha."}],faq:[{q:"Kiedy do laryngologa?",a:"Przy przewlekłym zapaleniu zatok lub polipach."}, {q:"Czy zimne powietrze pomaga?",a:"Może obkurczać naczynia, ale na dłuższą metę podrażnia błony śluzowe."}]},
      klatka:{label:"Klatka piersiowa",symptoms:[{t:"Kłujący ból w klatce piersiowej",audience:"adult"},"Uczucie ucisku za mostkiem","Kaszel (suchy lub mokry)","Duszność (trudności w oddychaniu)"],causes:["Refluks żołądkowy (zgaga)","Nerwoból (międzyżebrowy)","Zawał serca (pilne)","Zapalenie płuc"],urgent:[{t:"Nagły, silny ucisk w klatce — pilne",audience:"adult"},{t:"Duszność spoczynkowa, sinica",audience:"adult"},{t:"Wykrztuszanie krwi",audience:"adult"},{t:"Silny ból przy wdechu (zapalenie opłucnej)",audience:"adult"}],otc:["Leki na zgagę","Leki przeciwkaszlowe"],rx:["Antybiotyki (przy zapaleniu płuc)","Inhibitory pompy protonowej (refluks)"],rehab:["Rehabilitacja oddechowa","Unikanie stresu"],myths:[{m:"Ból w klatce to zawsze zawał",f:"Najczęściej to przyczyny niekardiologiczne, np. refluks czy nerwobóle."}, {m:"Wystarczy przeczekać kaszel",f:"Długotrwały kaszel wymaga diagnostyki (rtg, spirometria)."}],faq:[{q:"Kiedy do kardiologa?",a:"Przy bólu powiązanym z wysiłkiem, kołataniem, dusznością."}, {q:"Czy stres wpływa na ból?",a:"Tak. Stres wywołuje skurcze mięśni i nerwobóle."}]},
      brzuch:{label:"Brzuch / Jama brzuszna",symptoms:["Ból w nadbrzuszu (żołądek)","Wzdęcia / gazy","Biegunka lub zaparcie","Ból w prawym dolnym kwadrancie (wyrostek)"],causes:["Zatrucie pokarmowe","Zespół jelita drażliwego (IBS)","Choroba Leśniowskiego-Crohna","Kamica żółciowa"],urgent:[{t:"Twardy, deskowaty brzuch — pilne",audience:"adult"},{t:"Ostry ból po prawej stronie (wyrostek)",audience:"adult"},{t:"Krwawe wymioty/stolce",audience:"adult"}],otc:["Leki rozkurczowe","Probiotyki"],rx:["Antybiotyki (na biegunkę bakteryjną)","Leki na IBS/Crohna"],rehab:["Dieta FODMAP","Psychoterapia"],myths:[{m:"Na zatrucie najlepszy alkohol",f:"Alkohol podrażnia żołądek. Najważniejsze jest nawadnianie i elektrolity."}, {m:"Zawsze muszę mieć 3 stolce dziennie",f:"Normalny zakres to 3/dzień do 3/tydzień, jeśli stolec jest bez wysiłku."}],faq:[{q:"Kiedy do gastroenterologa?",a:"Przy przewlekłych bólach, biegunkach lub podejrzeniu IBS/Crohna."}, {q:"Czy dieta wpływa na IBS?",a:"Tak, dieta eliminacyjna (FODMAP) może znacząco zmniejszyć objawy."}]},
      serce:{label:"Serce / Układ krążenia",symptoms:[{t:"Kołatanie (palpitacje)",audience:"adult"},"Zawroty głowy","Omdlenia / stany przedomdleniowe","Obrzęki nóg"],causes:["Arytmie (migotanie przedsionków)","Niewydolność serca","Nadciśnienie","Choroba wieńcowa"],urgent:[{t:"Kołatanie z omdleniem lub bólem w klatce — pilne",audience:"adult"},{t:"Duszność spoczynkowa, sinica",audience:"adult"},{t:"Utrzymująca się tachykardia >150/min",audience:"adult"},{t:"Objawy udaru (przy migotaniu przedsionków) — pilne",audience:"adult"}],otc:["Magnez","Omega-3"],rx:["Beta-blokery","Leki przeciwkrzepliwe"],rehab:["Aktywność fizyczna (po ocenie)","Unikanie używek; monitorowanie elektrolitów"],myths:[{m:"Kołatanie zawsze oznacza groźną arytmię",f:"Często to łagodna ekstrasystolia, ale wymaga oceny EKG."}, {m:"Magnez leczy wszystkie kołatania",f:"Pomaga przy niedoborach, ale nie leczy strukturalnych arytmii."}],faq:[{q:"How to prep for a visit?",a:"Note episodes (when, trigger, duration), meds, conditions, HR/BP readings."}, {q:"Is smartwatch enough?",a:"It can capture episodes; diagnosis still relies on ECG/Holter."} ] },
      
      // --- DODANE BRAKUJĄCE SEKCJE ---
      gardlo: {
          label: "Gardło / Krtań", 
          symptoms: ["Ból przy przełykaniu", "Chrypka lub zmiana głosu", "Powiększone migdałki (biały nalot)", "Drapanie w gardle"],
          causes: ["Infekcja wirusowa (najczęściej)", "Angina bakteryjna (rzadziej)", "Refluks żołądkowo-przełykowy (GERD)"],
          urgent: ["Duszność (trudności w oddychaniu)", "Ślinotok i niemożność przełykania", "Bardzo wysoka gorączka >39°C z dreszczami"],
          otc: ["Leki przeciwzapalne (np. ibuprofen)", "Pastylki/spraye na gardło", "Płukanki solą fizjologiczną"],
          rx: ["Antybiotyki (tylko przy anginie bakteryjnej)", "Leki sterydowe"],
          rehab: ["Unikanie palenia tytoniu", "Nawilżanie powietrza", "Oszczędzanie głosu"],
          myths: [{m:"Antybiotyk zawsze pomoże na ból gardła", f:"Nie. Większość bólów gardła to infekcje wirusowe, na które antybiotyki nie działają."}, {m:"Przeziębienia to tylko zmęczenie", f:"Nie. Są spowodowane wirusami i wymagają odpoczynku."}],
          faq: [{q:"Kiedy do laryngologa?", a:"Jeśli chrypka trwa dłużej niż 3 tygodnie lub masz nawracające anginy."}]
      },
      nerki: {
          label: "Nerki / Układ moczowy",
          symptoms: ["Ból w okolicy lędźwiowej (po boku lub z tyłu)", "Pieczenie lub ból przy oddawaniu moczu (dyzuria)", "Częstomocz", "Krew w moczu (hematuria)"],
          causes: ["Zakażenie układu moczowego (ZUM)", "Kamica nerkowa (kolka nerkowa)", "Odwodnienie"],
          urgent: ["Bardzo silny, narastający ból (kolka nerkowa)", "Gorączka i dreszcze", "Brak oddawania moczu"],
          otc: ["Preparaty z żurawiną", "Leki rozkurczowe"],
          rx: ["Antybiotyki (na ZUM)", "Silne leki przeciwbólowe"],
          rehab: ["Picie dużych ilości wody", "Unikanie nadmiaru soli w diecie"],
          myths: [{m:"Picie piwa pomaga na kamicę nerkową", f:"Nie. Alkohol działa odwadniająco i podrażnia nerki; woda jest lepsza."}, {m:"ZUM łapie się tylko od zimna", f:"Nie. ZUM jest spowodowane bakteriami (E. coli)." }],
          faq: [{q:"Kiedy zgłosić się do urologa?", a:"Przy podejrzeniu kamicy, nawracających ZUM lub problemach z prostatą."}]
      },
      plecy: {
          label: "Plecy / Kręgosłup",
          symptoms: ["Ból lędźwiowy (krzyża)", "Rwa kulszowa (ból promieniujący do nogi)", "Ograniczenie ruchomości", "Ból po wysiłku"],
          causes: ["Dyskopatia / wypadnięcie dysku", "Napięcie mięśniowe", "Rwa kulszowa"],
          urgent: ["Utrata czucia w nogach", "Nietrzymanie moczu/stolca (zespół ogona końskiego)"],
          otc: ["Maści przeciwbólowe", "Paracetamol/Ibuprofen"],
          rx: ["Leki rozluźniające mięśnie", "Silne leki przeciwbólowe"],
          rehab: ["Fizjoterapia", "Ćwiczenia wzmacniające mięśnie głębokie"],
          myths: [{m:"Gdy boli, trzeba leżeć", f:"Nie. Umiarkowany ruch i wczesna fizjoterapia są kluczowe."}, {m:"Ból pleców to zawsze starość", f:"Nie. Dotyka to też młodych, często z powodu pracy siedzącej."}],
          faq: [{q:"Kiedy do ortopedy?", a:"Przy urazach, podejrzeniu złamania lub silnej rwie kulszowej."}]
      },
      nogi: {
          label: "Nogi / Stawy",
          symptoms: ["Obrzęk kostek", "Ból stawów (kolano/biodro)", "Uczucie ciężkich nóg", "Skurcze"],
          causes: ["Choroba zwyrodnieniowa stawów", "Zakrzepica (pilne)", "Niewydolność żylna"],
          urgent: ["Nagły, silny ból i opuchlizna jednej nogi (możliwa zakrzepica)"],
          otc: ["Leki na stawy (glukozamina)", "Preparaty na żylaki"],
          rx: ["Leki przeciwzakrzepowe"],
          rehab: ["Fizjoterapia", "Umiarkowany ruch"],
          myths: [{m:"Bieganie niszczy stawy", f:"Nie. Umiarkowane bieganie wzmacnia mięśnie i chrząstkę, o ile nie ma wady."}, {m:"Żylaki to tylko problem estetyczny", f:"Nie. Niewydolność żylna jest chorobą, która może prowadzić do zakrzepicy."}],
          faq: [{q:"Kiedy do chirurga naczyniowego?", a:"Przy podejrzeniu zakrzepicy lub silnych żylakach."}]
      }
    };
    
    // ========== PARAMETRY URL ==========
    const qs=new URLSearchParams(location.search);
    const RAW_TYP=(qs.get('typ')||'kobieta').toLowerCase();
    const RAW_CZESC=(qs.get('czesc')||'glowa').toLowerCase();
    const RAW_LABEL=(qs.get('label')||RAW_CZESC).toString();
    const ALIAS={'oko':'glowa','klatka-piersiowa':'klatka','zoladek':'brzuch'};
    const TYP=RAW_TYP, CZESC=(ALIAS[RAW_CZESC]||RAW_CZESC), LABEL=RAW_LABEL;

    // ========== ZASTOSOWANIE I18N DO UI ==========
    (function applyI18N(){ 
      const d=I18N[L()]; 
      // breadcrumb
      const typMap = L()==='en' ? {kobieta:'Woman',mezczyzna:'Man',dziecko:'Child'} : {kobieta:'Kobieta',mezczyzna:'Mężczyzna',dziecko:'Dziecko'};
      document.getElementById('crumb-typ').textContent=(typMap[TYP]||TYP);
      document.getElementById('crumb-label').textContent=d.crumbs_details;
      // hero
      const note=document.querySelector('.hero-note'); if(note) note.innerHTML=d.hero_note;
      const leg=document.querySelector('.legend'); if(leg) leg.innerHTML=d.legend;
      // tabs
      const tab=(v,txt)=>{ const el=document.querySelector(`.tab[data-variant="${v}"]`); if(el) el.textContent=txt; };
      Object.entries(d.tabs).forEach(([k,v])=>tab(k,v));
      // headings
      const setTxt=(sel,txt)=>{ const el=document.querySelector(sel); if(el) el.textContent=txt; };
      setTxt('#h-obj', d.symptoms_head); setTxt('.subhead', d.urgent_head); setTxt('#h-cause', d.tabs.causes);
      setTxt('#h-aid', d.tabs.firstaid); setTxt('#h-otc', d.tabs.otc); setTxt('#h-rx', d.tabs.rx);
      setTxt('#h-rehab', d.tabs.rehab); setTxt('#h-mity', d.tabs.myths); setTxt('#h-faq', d.tabs.faq);
      setTxt('#h-dx', d.tabs.dx); setTxt('#h-docs', d.tabs.docs);
      // back + urgent strip + risk caption
      const back=document.getElementById('bhReturnTop'); if(back) back.textContent=d.back;
      const strip=document.getElementById('urgent-strip'); if(strip) strip.innerHTML=`${d.urgent_strip} <a class="cta" id="cta-112" href="tel:112" aria-label="${d.call_112}">${d.call_112}</a>`;
      const riskWrap=document.querySelector('.risk-mini small');
      if(riskWrap){
        const lbl=document.getElementById('risk-label')||document.createElement('span'); lbl.id='risk-label'; lbl.textContent=d.risk_low;
        riskWrap.textContent=d.risk+' '; riskWrap.appendChild(lbl);
      }
      // dx button
      const dxBtn=document.getElementById('dx-btn'); if(dxBtn) dxBtn.textContent=d.dx_btn_txt;
    })();

    // ========== WYBÓR CONTENTU WG JĘZYKA I CZĘŚCI CIAŁA ==========
    const CONTENT=CONTENT_PL; // (Dla uproszczenia, w tym projekcie tylko PL)
    const entry = CONTENT[CZESC] || CONTENT.glowa;
    document.getElementById('label-text').innerHTML='<b>'+(entry.label||LABEL)+'</b> • '+TYP;

    // ========== HELPERS / SCORING ==========
    const isChild=(TYP==='dziecko');
    const allowItem=(it)=> typeof it==='string' ? true : (isChild ? (it.audience!=='adult') : (it.audience!=='child'));
    const textOf =(it)=> typeof it==='string' ? it : it.t;

    const HIGH_PL=["duszność","sinica","utrata przytomności","krwawienie","twardy brzuch","najgorszy ból"];
    const MID_PL =["gorączka","sztywność karku","silny ból"];
    const HIGH_EN=["dyspnea","cyanosis","loss of consciousness","rigid abdomen","bleeding","thunderclap"];
    const MID_EN =["fever","neck stiffness","severe pain"];

    const phrases=()=> L()==='en'?{H:HIGH_EN,M:MID_EN}:{H:HIGH_PL,M:MID_PL};
    
    function weightFor(text,bucket){
      const s=(text||'').toLowerCase();
      if(bucket==='urgent') return 35;
      const P=phrases();
      if(P.H.some(k=>s.includes(k))) return 20;
      if(P.M.some(k=>s.includes(k))) return 10;
      if(bucket==='symptoms') return 6;
      return 0;
    }

    // ========== RENDERERY LIST ==========
    let selectedWeights=0, selectedCount=0;

    function renderListInteractive(id,arr,bucket){
      const ul=document.getElementById(id);
      ul.innerHTML='';
      (arr||[]).filter(allowItem).map(textOf).forEach(txt=>{
        const li=document.createElement('li');
        const cb=document.createElement('span');
        cb.className='cb';
        cb.setAttribute('role','checkbox');
        cb.setAttribute('aria-checked','false');
        const w=weightFor(txt,bucket);
        li.dataset.weight=w;
        li.appendChild(cb);
        li.appendChild(document.createTextNode(txt));

        function toggle(){
          const on=cb.classList.toggle('checked');
          li.classList.toggle('li-checked',on);
          cb.setAttribute('aria-checked',on?'true':'false');
          selectedWeights += on? +w : -w;
          selectedCount += on? 1 : -1;
          updateRisk();
          document.dispatchEvent(new CustomEvent('bh:symptoms-changed'));
        }

        li.addEventListener('click',e=>{ if(e.target!==cb) toggle(); });
        cb.addEventListener('click',e=>{ e.stopPropagation(); toggle(); });
        ul.appendChild(li);
      });
    }

    function renderListPlain(id,arr){
      const ul=document.getElementById(id);
      ul.innerHTML='';
      (arr||[]).filter(allowItem).map(textOf).forEach(txt=>{
        const li=document.createElement('li');
        const cb=document.createElement('span');
        cb.className='cb';
        cb.style.visibility='hidden';
        li.appendChild(cb);
        li.appendChild(document.createTextNode(txt));
        ul.appendChild(li);
      });
    }

    function fillPairs(id,arr){
      const ul=document.getElementById(id);
      ul.innerHTML='';
      (arr||[]).forEach(x=>{
        const li=document.createElement('li');
        const cb=document.createElement('span');
        cb.className='cb';
        cb.style.visibility='hidden';
        li.appendChild(cb);
        const isEn=L()==='en';
        const m=document.createElement('div');
        m.innerHTML='<strong>'+(isEn?'Myth:':'Mit:')+'</strong> '+(x.m||'—');
        const f=document.createElement('div');
        f.innerHTML='<strong>'+(isEn?'Fact:':'Fakt:')+'</strong> '+(x.f||'—');
        li.appendChild(m);
        li.appendChild(f);
        ul.appendChild(li);
      });
    }

    function fillFAQ(id,arr){
      const ul=document.getElementById(id);
      ul.innerHTML='';
      (arr||[]).forEach(x=>{
        const li=document.createElement('li');
        const cb=document.createElement('span');
        cb.className='cb';
        cb.style.visibility='hidden';
        li.appendChild(cb);
        li.innerHTML+='<strong>'+(x.q|| (L()==='en'?'Question':'Pytanie'))+'</strong><div style="margin-top:4px;color:#b8c2e0">'+(x.a|| (L()==='en'?'Answer':'Odpowiedź'))+'</div>';
        ul.appendChild(li);
      });
    }

    // ========== WYPEŁNIENIE KART Z DANYMI ==========
    renderListInteractive('symp-common',entry.symptoms,'symptoms');
    renderListInteractive('urgent',entry.urgent||[],'urgent');
    renderListPlain('causes',entry.causes||[]);
    renderListPlain('firstaid',entry.firstaid||[]);
    renderListPlain('meds-otc',entry.otc||[]);
    renderListPlain('meds-rx',entry.rx||[]);
    renderListPlain('rehab',entry.rehab||[]);
    fillPairs('myths',entry.myths||[]);
    fillFAQ('faq',entry.faq||[]);

    // ========== AKTUALIZACJA RYZYKA / STEPPERA ==========
    function updateRisk(){
      const d=I18N[L()];
      const c=document.getElementById('risk-cursor-card');
      const lbl=document.getElementById('risk-label');
      const val=Math.max(0,Math.min(100,selectedWeights));
      if(c) c.style.left=val+'%';
      if(lbl){
        let t=d.risk_low;
        if(val>=70) t=d.risk_high;
        else if(val>=40) t=d.risk_mid;
        lbl.textContent=t;
      }
      const hint=document.getElementById('dx-hint');
      hint.classList.toggle('show',selectedCount>0);

      // Aktualizacja kroku
      document.getElementById('dx-count-text').textContent=selectedCount;
      const step2=document.getElementById('s-diagnoza');
      const step3=document.getElementById('s-pomoc');
      const step4=document.getElementById('s-mity');

      // Wyczyść wszystkie, potem ustaw aktywne
      [step2,step3,step4].forEach(el=>el.classList.remove('active'));

      if(selectedCount > 0){
        step2.classList.add('active'); // Diagnostyka
        if(selectedWeights > 0){
          step3.classList.add('active'); // Pomoc
          step4.classList.add('active'); // Mity / FAQ
        }
      }
    }
    updateRisk();

    // ========== ZARZĄDZANIE TABAMI ==========
    const tabs=[...document.querySelectorAll('.tab')];
    const panels=[...document.querySelectorAll('.card[role="tabpanel"]')];
    
    function showPanel(sel){
      panels.forEach(p=>p.setAttribute('aria-hidden',('#'+p.id)===sel?'false':'true'));
      tabs.forEach(t=>t.setAttribute('aria-selected', t.getAttribute('data-target')===sel?'true':'false'));
      
      const step1=document.getElementById('s-objawy');
      const step2=document.getElementById('s-diagnoza');
      const step3=document.getElementById('s-pomoc');
      const step4=document.getElementById('s-mity');
      
      [step1,step2,step3,step4].forEach(el=>el.classList.remove('active'));

      // Ustawienie aktywnych kroków na podstawie aktywnej karty
      if(sel === '#card-symptoms'){ step1.classList.add('active'); }
      else if(sel === '#card-dx'){ 
        if(selectedCount===0) showPanel('#card-symptoms'); // Wróć do objawów, jeśli pusta
        else step2.classList.add('active'); 
      }
      else if(['#card-cause','#card-aid','#card-otc','#card-rx','#card-rehab','#card-docs'].includes(sel)){ 
        if(selectedCount===0) showPanel('#card-symptoms'); // Wróć do objawów, jeśli pusta
        else step3.classList.add('active'); 
      }
      else if(['#card-myths','#card-faq'].includes(sel)){ 
        if(selectedCount===0) showPanel('#card-symptoms'); // Wróć do objawów, jeśli pusta
        else step4.classList.add('active'); 
      }

      // Aktualizacja aktywnych stanów po manualnej aktywacji
      updateRisk();
      document.querySelector(sel)?.scrollIntoView({behavior:'smooth',block:'start'});
    }

    tabs.forEach(t=>t.addEventListener('click',()=>showPanel(t.getAttribute('data-target'))));

    // ========== LOGIKA DX / LEKARZE ==========
    function gather(){
      const from=(id)=>[...document.querySelectorAll('#'+id+' li.li-checked')].map(li=>li.textContent.toLowerCase());
      return {symp:from('symp-common'),urgent:from('urgent')};
    }

    // ========== DANE REGUŁ DIAGNOSTYCZNYCH (DX_RULES) – POPRAWIONY I UZUPEŁNIONY BLOK ==========
    const DX_RULES={
      glowa:[
          {pl:{name:"Ból napięciowy",advice:"POZ / higiena snu"},en:{name:"Tension-type headache",advice:"GP / sleep hygiene"},keys:["ucisk","napięcie","bilateral"],badge:"poz"},
          {pl:{name:"Migrena",advice:"POZ; przy nawrotach neurolog"},en:{name:"Migraine",advice:"GP; neurologist if recurrent"},keys:["pulsujący","światło"],badge:"poz"},
          {pl:{name:"Zapalenie opon — pilnie",advice:"SOR/112"},en:{name:"Meningitis — urgent",advice:"ER/112"},keys:["sztywność karku","gorączka","najgorszy ból"],badge:"sor"}
      ],
      nos:[
          {pl:{name:"Nieżyt nosa",advice:"POZ / objawowo, sól"},en:{name:"Rhinitis",advice:"GP / symptomatic, saline"},keys:["katar","zatkanie"],badge:"poz"},
          {pl:{name:"Zapalenie zatok",advice:"POZ; ew. antybiotyk"},en:{name:"Sinusitis",advice:"GP; consider antibiotics"},keys:["ból zatok","gorączka"],badge:"poz"}
      ],
      klatka:[
          {pl:{name:"Refluks",advice:"POZ; dieta, PPI"},en:{name:"Reflux",advice:"GP; diet, PPI"},keys:["zgaga","pieczenie"],badge:"poz"},
          {pl:{name:"OZW/Zawał — pilnie",advice:"SOR/112"},en:{name:"ACS/MI — urgent",advice:"ER/112"},keys:["ucisk","duszność","zimny pot"],badge:"sor"}
      ],
      brzuch:[
          {pl:{name:"Niestrawność/IBS",advice:"POZ; dieta"},en:{name:"Indigestion/IBS",advice:"GP; diet"},keys:["wzdęcia","biegunka","zaparcie"],badge:"poz"},
          {pl:{name:"Ostry brzuch — pilnie",advice:"SOR/112"},en:{name:"Acute abdomen — urgent",advice:"ER/112"},keys:["twardy brzuch","silny ból"],badge:"sor"}
      ],
      serce:[
          {pl:{name:"Zaburzenia rytmu",advice:"POZ → EKG"},en:{name:"Arrhythmias",advice:"GP → ECG"},keys:["kołatanie","zawroty"],badge:"poz"}
      ],
      gardlo:[
          {pl:{name:"Angina (bakteryjna)",advice:"POZ; antybiotyk"},en:{name:"Strep throat",advice:"GP; antibiotics"},keys:["biały nalot","gorączka"],badge:"poz"},
          {pl:{name:"Ostre zapalenie nagłośni — pilnie",advice:"SOR/112"},en:{name:"Acute epiglottitis — urgent",advice:"ER/112"},keys:["duszność","ślinotok","trudność w przełykaniu"],badge:"sor"}
      ],
      nerki:[
          {pl:{name:"Kolka nerkowa — pilnie",advice:"SOR"},en:{name:"Renal colic — urgent",advice:"ER"},keys:["silny ból","krew w moczu"],badge:"sor"},
          {pl:{name:"ZUM (Zakażenie ukł. moczowego)",advice:"POZ; antybiotyk"},en:{name:"UTI",advice:"GP; antibiotics"},keys:["pieczenie","częstomocz"],badge:"poz"}
      ],
      plecy:[
          {pl:{name:"Rwa kulszowa",advice:"POZ → Fizjoterapia"},en:{name:"Sciatica",advice:"GP → Physiotherapy"},keys:["ból promieniujący do nogi","drętwienie"],badge:"poz"},
          {pl:{name:"Zespół ogona końskiego — pilnie",advice:"SOR/112"},en:{name:"Cauda equina syndrome — urgent",advice:"ER/112"},keys:["utrata czucia w nogach","nietrzymanie moczu"],badge:"sor"}
      ],
      nogi:[
          {pl:{name:"Zakrzepica żylna (DVT) — pilnie",advice:"SOR/112"},en:{name:"DVT — urgent",advice:"ER/112"},keys:["nagły ból","opuchlizna jednej nogi"],badge:"sor"},
          {pl:{name:"Choroba zwyrodnieniowa stawów",advice:"POZ → Ortopeda"},en:{name:"Osteoarthritis",advice:"GP → Orthopedist"},keys:["ból stawów","ograniczenie ruchomości"],badge:"poz"}
      ]
    };

    function computeDx(){
      if(selectedCount === 0) return; // Nic nie wybrano

      const {symp,urgent}=gather();
      const picked=symp.concat(urgent);
      const rules=DX_RULES[CZESC]||[];
      const hits=[];

      // 1. Sprawdzenie, czy objawy pilne wskazują na alarm
      const urgentHit = (L()==='en' ? ["dyspnea","cyanosis","loss of consciousness","rigid abdomen","bleeding","thunderclap"] : ["duszność","sinica","utrata przytomności","twardy brzuch","krwawienie","najgorszy ból"])
        .some(k=>picked.some(p=>p.includes(k)));

      if(urgentHit) {
        hits.push({
          _score:999,
          name:L()==='en'?'Alarm signs':'Objawy alarmowe',
          advice:L()==='en'?'Call 112 / ER':'Zadzwoń 112 / SOR',
          badge:'sor'
        });
      }

      // 2. Punktacja reguł
      rules.forEach(rule=>{
        const keys=rule.keys||[];
        const matchCount=keys.filter(k=>picked.some(p=>p.includes(k))).length;
        if(matchCount>0){
          const score=Math.floor(Math.min(95,(matchCount/keys.length)*100));
          const data=(L()==='en')?rule.en:rule.pl;
          hits.push({...data, _score:score, badge:rule.badge});
        }
      });

      // 3. Sortowanie: najwyższy wynik (urgent 999) + unikalność
      const uniqueHits = Array.from(new Map(hits.map(item => [item.name, item])).values());
      uniqueHits.sort((a,b)=>b._score - a._score);
      
      renderDx(uniqueHits.filter(h=>h._score>0));
      renderDocs(uniqueHits.filter(h=>h._score>0));
      showPanel('#card-dx');
    }

    function renderDx(arr){
      const ul=document.getElementById('dx-list');
      ul.innerHTML='';
      arr.forEach(dx=>{
        const li=document.createElement('li');
        li.style.padding='14px 12px';
        li.style.display='flex';
        li.style.alignItems='center';
        li.style.justifyContent='space-between';
        
        const content=document.createElement('div');
        content.style.flexGrow='1';

        content.innerHTML=`
          <div style="font-weight:900; color:#eafff8">${dx.name}</div>
          <div style="font-size:13px; color:#b8c2e0; margin-top:3px;">Zalecenie: ${dx.advice}</div>
        `;
        li.appendChild(content);

        const meta=document.createElement('div');
        meta.className='dx-meta';
        meta.innerHTML=`
          <div class="dx-badge ${dx.badge}">${I18N[L()].docs_pl[dx.badge]||dx.badge.toUpperCase()}</div>
          <div class="conf-wrap">
            <div class="conf-bar" style="width:${dx._score}%"></div>
          </div>
          <small style="font-size:11px; color:#b8c2e0; font-weight:700">${dx._score}% Dopasowania</small>
        `;
        li.appendChild(meta);
        ul.appendChild(li);
      });
      if(arr.length===0){
        ul.innerHTML=`<li style="text-align:center;color:#b8c2e0">Nie wybrano wystarczającej liczby objawów do oceny.</li>`;
      }
    }

    // ========== RENDEROWANIE LEKARZY NA PODSTAWIE DX ==========
    function renderDocs(arr){
      const d=I18N[L()];
      const doctorMap = { poz: 'POZ', sor: 'SOR', spec: 'SPECJALISTA' };
      const uniqueBadges = Array.from(new Set(arr.map(dx => dx.badge)));
      
      const doctors = uniqueBadges.map(badge => ({
          name: d.docs_pl[badge] || doctorMap[badge] || badge.toUpperCase(),
          badge: badge
      }));
      
      const ul=document.getElementById('docs-list');
      ul.innerHTML='';
      
      doctors.forEach(doc=>{
        const li=document.createElement('li');
        li.style.padding='14px 12px';
        li.style.display='flex';
        li.style.alignItems='center';
        li.style.justifyContent='space-between';
        
        const content=document.createElement('div');
        content.style.flexGrow='1';
        
        content.innerHTML=`
          <div style="font-weight:900; color:#eafff8">${doc.name}</div>
        `;
        li.appendChild(content);

        const meta=document.createElement('div');
        meta.innerHTML=`<div class="doc-badge ${doc.badge}">${doc.name}</div>`;
        li.appendChild(meta);
        ul.appendChild(li);
      });
      if(doctors.length===0){
        ul.innerHTML=`<li style="text-align:center;color:#b8c2e0">Nie wybrano objawów, aby wskazać lekarza.</li>`;
      }
    }


    document.getElementById('dx-btn').addEventListener('click', computeDx);
    document.getElementById('dx-hint').addEventListener('click', computeDx);

    // ========== WSTRZYKIWANIE TŁUMACZA ==========
    // Uwaga: Poniższy blok jest skróconą wersją, która wczytuje dane z I18N
    (function(){
      if(document.getElementById('bhLangPick')) return; 

      const BASE = document.location.origin + document.location.pathname.replace(/\/([^\/]+)\.html$/, '/');
      const LS_KEY = 'bh_lang';
      let lang = localStorage.getItem(LS_KEY) || 'pl';

      // 1. Wstrzyknięcie HTML
      const pick = document.createElement('div');
      pick.id = 'bhLangPick';
      pick.innerHTML = `
        <label for="bhLangSelect">Język</label>
        <select id="bhLangSelect">
          <option value="pl">PL</option>
          <option value="en">EN</option>
        </select>
      `;
      document.body.appendChild(pick);

      const sel = document.getElementById('bhLangSelect');
      const lab = document.querySelector('#bhLangPick label');

      function apply(){
        const d = I18N[lang];
        if(!d) return;

        // Aktualizacja widoku w szczegoly.html
        (function applyI18N(){ 
          // Aktualizacja nagłówków i tekstów
          const setTxt=(sel,txt)=>{ const el=document.querySelector(sel); if(el) el.textContent=txt; };
          const tab=(v,txt)=>{ const el=document.querySelector(`.tab[data-variant="${v}"]`); if(el) el.textContent=txt; };
          
          Object.entries(d.tabs).forEach(([k,v])=>tab(k,v));
          setTxt('#h-obj', d.symptoms_head); setTxt('.subhead', d.urgent_head); setTxt('#h-cause', d.tabs.causes);
          setTxt('#h-aid', d.tabs.firstaid); setTxt('#h-otc', d.tabs.otc); setTxt('#h-rx', d.tabs.rx);
          setTxt('#h-rehab', d.tabs.rehab); setTxt('#h-mity', d.tabs.myths); setTxt('#h-faq', d.tabs.faq);
          setTxt('#h-dx', d.tabs.dx); setTxt('#h-docs', d.tabs.docs);
          
          const back=document.getElementById('bhReturnTop'); if(back) back.textContent=d.back;
          const strip=document.getElementById('urgent-strip'); if(strip) strip.innerHTML=`${d.urgent_strip} <a class="cta" id="cta-112" href="tel:112" aria-label="${d.call_112}">${d.call_112}</a>`;
          document.querySelector('.hero-note').innerHTML = d.hero_note;
          document.querySelector('.legend').innerHTML = d.legend;
          document.getElementById('dx-btn').textContent = d.dx_btn_txt;

          // Wymuś przeliczenie i renderowanie (zmiana języka ma wpływ na listy, które nie mają EN)
          renderListInteractive('symp-common',entry.symptoms,'symptoms');
          renderListInteractive('urgent',entry.urgent||[],'urgent');
          renderListPlain('causes',entry.causes||[]);
          renderListPlain('firstaid',entry.firstaid||[]);
          renderListPlain('meds-otc',entry.otc||[]);
          renderListPlain('meds-rx',entry.rx||[]);
          renderListPlain('rehab',entry.rehab||[]);
          fillPairs('myths',entry.myths||[]);
          fillFAQ('faq',entry.faq||[]);

          if(document.getElementById('card-dx').getAttribute('aria-hidden') === 'false'){
            computeDx();
          }

          // breadcrumb
          const typMap = lang==='en' ? {kobieta:'Woman',mezczyzna:'Man',dziecko:'Child'} : {kobieta:'Kobieta',mezczyzna:'Mężczyzna',dziecko:'Dziecko'};
          document.getElementById('crumb-typ').textContent=(typMap[TYP]||TYP);
          document.getElementById('crumb-label').textContent=d.crumbs_details;
          
          // risk
          const riskWrap=document.querySelector('.risk-mini small');
          if(riskWrap){
              const lbl=document.getElementById('risk-label');
              riskWrap.textContent=d.risk+' '; 
              riskWrap.appendChild(lbl); 
          }
          
          updateRisk();

        })();

        if(lab){ lab.textContent = d.lang_label; }
        if(sel){ sel.value = lang; }
      }

      function setLang(l){
        if(!I18N[l]) return;
        lang = l;
        localStorage.setItem(LS_KEY, lang);
        apply();
      }

      if(sel){
        sel.addEventListener('change', function(){ setLang(sel.value); });
      }

      apply();
    })();
  </script>
</body>
</html>
