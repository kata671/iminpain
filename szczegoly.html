<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Boli Help — Szczegóły</title>
  <meta name="theme-color" content="#0e1230" />
  <style>
    :root{--bg:#0e1230;--text:#eef2ff;--muted:#b8c2e0;--card:rgba(60,32,100,.30);--stroke:rgba(164,107,255,.18);--radius:16px}
    html,body{height:100%} body{margin:0;background:var(--bg);color:var(--text);font:15px/1.6 system-ui,-apple-system,Segoe UI,Roboto}
    .container{max-width:1100px;margin:0 auto;padding:16px}
    .crumbs{font-weight:800;letter-spacing:.2px;color:#cfe2ff;margin-bottom:10px}
    .hero{background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));border:1px solid var(--stroke);border-radius:var(--radius);padding:16px}
    .tabs{display:flex;flex-wrap:wrap;gap:8px;margin:16px 0 8px}
    .tab{padding:9px 13px;border-radius:10px;font-weight:800;cursor:pointer;background:transparent;border:1px solid rgba(255,255,255,.16);color:#e9efff}
    .tab[aria-selected="true"]{box-shadow:0 0 0 2px rgba(94,234,212,.35);border-color:rgba(94,234,212,.55)}
    .card{display:none;background:var(--card);border:1px solid var(--stroke);border-radius:var(--radius);padding:16px;margin-top:8px}
    .card[aria-hidden="false"]{display:block}
    h1,h2,h3{margin:.4rem 0}
    ul.clean{list-style:none;margin:0;padding:0}
    ul.clean li{padding:10px 12px;border:1px solid rgba(255,255,255,.12);border-radius:10px;margin:6px 0;background:rgba(255,255,255,.05)}
    .warn{background:linear-gradient(180deg,rgba(255,184,108,.18),rgba(255,255,255,.04));border:1px solid rgba(255,184,108,.55);padding:10px 12px;border-radius:10px;margin:10px 0}
    #back{appearance:none;border:1px solid rgba(164,107,255,.28);background:rgba(60,32,100,.28);color:#eef2ff;font-weight:800;padding:8px 12px;border-radius:10px;cursor:pointer}
  </style>
</head>
<body data-page="szczegoly">
  <div class="container">
    <button id="back" type="button">← Wróć</button>
    <div class="crumbs" id="crumbs">Boli Help • <span id="who"></span> • <span id="part"></span></div>
    <div class="hero">
      <h1 id="title">Szczegóły</h1>
      <p id="note">Wybierz zakładkę, aby zobaczyć treści.</p>
      <div class="tabs" id="tabs" role="tablist"></div>
      <div class="cards" id="cards"></div>
    </div>
  </div>

<script>
(function(){
  // Back button
  const back=document.getElementById('back');
  back.addEventListener('click', ()=>{
    if (document.referrer && document.referrer.includes(location.host)) history.back();
    else location.href = 'index.html';
  });

  // Read params
  const U=new URL(location.href);
  const typ=U.searchParams.get('typ')||'kobieta';
  const czesc=U.searchParams.get('czesc')||'glowa';
  const label=U.searchParams.get('label')||czesc;

  // UI crumbs
  document.getElementById('who').textContent = (typ==='kobieta'?'Kobieta':(typ==='mezczyzna'?'Mężczyzna':(typ==='dziecko'?'Dziecko':typ)));
  document.getElementById('part').textContent = decodeURIComponent(label);

  // Load atlas
  fetch('assets/atlas.json', {cache:'no-store'}).then(r=>r.json()).then(atlas=>{
    const part = atlas.parts[czesc];
    if(!part){
      document.getElementById('title').textContent = 'Brak danych dla: '+czesc;
      document.getElementById('note').textContent = 'Uzupełnij w assets/atlas.json';
      return;
    }
    document.getElementById('title').textContent = part.title || decodeURIComponent(label);

    const order = [
      ['objawy','Objawy'],
      ['przyczyny','Przyczyny'],
      ['pierwsza_pomoc','Pierwsza pomoc'],
      ['leki_otc','Leki bez recepty'],
      ['leki_rx','Leki na receptę'],
      ['rehabilitacja','Rehabilitacja'],
      ['mity','Mity'],
      ['faq','FAQ']
    ];

    const tabs = document.getElementById('tabs');
    const cards = document.getElementById('cards');

    order.forEach(([key, name], idx)=>{
      const btn = document.createElement('button');
      btn.className='tab'; btn.type='button'; btn.setAttribute('role','tab');
      btn.textContent = name; btn.dataset.key=key;
      if(idx===0) btn.setAttribute('aria-selected','true');
      tabs.appendChild(btn);

      const card = document.createElement('section');
      card.className='card'; card.id='card-'+key; card.setAttribute('role','tabpanel');
      card.setAttribute('aria-hidden', idx===0?'false':'true');

      const h = document.createElement('h3'); h.textContent = name; card.appendChild(h);
      const list = document.createElement('ul'); list.className='clean';
      const arr = Array.isArray(part[key]) ? part[key] : (part[key]? [String(part[key])] : []);
      if(arr.length===0){ const p=document.createElement('p'); p.className='warn'; p.textContent='Brak treści. Uzupełnij w assets/atlas.json.'; card.appendChild(p); }
      else{
        arr.forEach(t=>{ const li=document.createElement('li'); li.textContent=t; list.appendChild(li); });
        card.appendChild(list);
      }
      cards.appendChild(card);
    });

    // Tabs logic
    tabs.addEventListener('click', (e)=>{
      const b=e.target.closest('.tab'); if(!b) return;
      const key=b.dataset.key;
      [...tabs.children].forEach(x=>x.setAttribute('aria-selected','false'));
      b.setAttribute('aria-selected','true');
      [...cards.children].forEach(c=>c.setAttribute('aria-hidden','true'));
      document.getElementById('card-'+key).setAttribute('aria-hidden','false');
    });
  }).catch(err=>{
    document.getElementById('title').textContent='Błąd ładowania atlasu';
    document.getElementById('note').textContent=String(err);
  });
})();
</script>
</body>
</html>
