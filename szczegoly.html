<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Szczeg√≥≈Çy</title>
  <link rel="stylesheet" href="style.css?v=details-final" />
  <style>
    .detail-hero{max-width:980px;margin:24px auto;display:grid;gap:16px}
    #content .card{margin-bottom:12px}
    #content h3{margin:.4rem 0}
    .detail-hero img{width:100%;height:auto;border-radius:18px;box-shadow:var(--glow);background:#0b1222}
  </style>
</head>
<body class="bg-med szczegoly-page">

  <nav class="quickbar">
    <a href="index.html">üè† Start</a>
    <a href="pierwsza-pomoc.html">‚õëÔ∏è Pierwsza pomoc</a>
    <a href="lokalizacja.html">üìç Lokalizacja</a>
  </nav>

  <header class="site-header">
    <h1 id="title">Szczeg√≥≈Çy</h1>
    <p class="subtitle" id="subtitle"></p>
  </header>

  <main class="container">
    <section class="detail-hero">
      <img id="hero" src="" alt="" />
      <div id="content"></div>
    </section>
  </main>

  <footer class="site-footer"><small>¬© 2025 ‚Ä¢ Bolihelp.com</small></footer>

  <!-- Twoje skrypty (je≈õli istniejƒÖ) ‚Äì nie usuwaj -->
  <script src="content.js?v=1" defer></script>
  <script src="details.js?v=1" defer></script>
  <script src="szczegoly.js?v=1" defer></script>

  <script>
  (function(){
    const id = new URLSearchParams(location.search).get('id') || '';

    // aliasy p√≥l (pl/en)
    const pick = (o,keys)=> (o||[]).map ? o : keys.reduce((acc,k)=> acc || o?.[k], null);
    const arr = v => Array.isArray(v) ? v : (typeof v==='string' ? v.split('|').map(s=>s.trim()).filter(Boolean) : []);
    const labels = {
      symptoms: ['symptoms','objawy'],
      causes: ['causes','przyczyny','mozliwe_przyczyny','mo≈ºliwe_przyczyny'],
      firstAid: ['firstAid','first_aid','pierwsza_pomoc'],
      whenToSeeDoctor: ['whenToSeeDoctor','kiedy_do_lekarza'],
      otc: ['otc','bez_recepty'],
      rx: ['rx','na_recepte','na_receptƒô'],
      prevention: ['prevention','profilaktyka'],
      diagnostics: ['diagnostics','badania','diagnostyka']
    };

    // 1) pr√≥ba z globalnych obiekt√≥w JS
    function fromGlobals(key){
      const pools = [window.DETAILED_CONDITIONS, window.CONDITIONS, window.DETAILS];
      for (const p of pools){
        if (p && p[key]) return p[key];
      }
      return null;
    }

    // 2) pr√≥ba z JSON (kilka mo≈ºliwych ≈õcie≈ºek)
    async function fromJsons(key){
      const urls = [
        'data/detailed_conditions.json',
        'detailed_conditions.json',
        'data/conditions.json',
        'conditions.json'
      ];
      for (const url of urls){
        try{
          const r = await fetch(url, {cache:'no-store'});
          if (!r.ok) continue;
          const data = await r.json();
          if (data && data[key]) return data[key];
        }catch(e){/* skip */}
      }
      return null;
    }

    function normalize(raw){
      if (!raw) return null;
      const norm = {
        title: raw.title || raw.nazwa || '',
        subtitle: raw.subtitle || raw.podtytul || raw.podtytu≈Ç || '',
        image: raw.image || raw.img || ''
      };
      for (const k in labels){
        const val = labels[k].map(name=> raw[name]).find(v=> v!=null);
        norm[k] = arr(val);
      }
      return norm;
    }

    function sectionHTML(label, items){
      if (!items || !items.length) return '';
      return `<div class="card"><h3>${label}</h3><ul>` +
             items.map(li=>`<li>${li}</li>`).join('') +
             `</ul></div>`;
    }

    function render(data){
      document.getElementById('title').textContent = data.title || 'Szczeg√≥≈Çy';
      document.getElementById('subtitle').textContent = data.subtitle || '';
      const hero = document.getElementById('hero');
      if (data.image){ hero.src = data.image; hero.alt = data.title || ''; } else { hero.style.display='none'; }

      const blocks = [
        sectionHTML('Objawy', data.symptoms),
        sectionHTML('Mo≈ºliwe przyczyny', data.causes),
        sectionHTML('Pierwsza pomoc', data.firstAid),
        sectionHTML('Kiedy do lekarza', data.whenToSeeDoctor),
        sectionHTML('Leki ‚Äî Bez recepty', data.otc),
        sectionHTML('Leki ‚Äî Na receptƒô', data.rx),
        sectionHTML('Profilaktyka', data.prevention),
        sectionHTML('Badania / Diagnostyka', data.diagnostics),
      ].filter(Boolean);

      document.getElementById('content').innerHTML =
        blocks.length ? blocks.join('') : `<div class="card"><p>Brak szczeg√≥≈Çowych danych dla: ${id}</p></div>`;
    }

    async function init(){
      let raw = fromGlobals(id);
      if (!raw) raw = await fromJsons(id);
      const data = normalize(raw);
      if (data) render(data);
      else {
        document.getElementById('title').textContent = 'Brak danych';
        document.getElementById('subtitle').textContent = id;
        document.getElementById('hero').style.display='none';
        document.getElementById('content').innerHTML =
          `<div class="card"><p>Nie znaleziono opisu. Upewnij siƒô, ≈ºe wpis istnieje w <code>content.js</code> lub w JSON.</p></div>`;
      }
    }
    init();
  })();
  </script>
</body>
</html>
