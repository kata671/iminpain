<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Szczegóły</title>
  <link rel="stylesheet" href="style.css" />

  <style>
    /* Układ kafelków — stabilny (jak w backupie) */
    .cards{
      display:grid;
      grid-template-columns:repeat(3,minmax(260px,1fr));
      gap:24px;
      max-width:1200px;
      margin:28px auto 40px;
      padding:0 16px;
      justify-items:center;
      align-items:start;
    }
    @media (max-width:980px){ .cards{ grid-template-columns:repeat(2,minmax(260px,1fr)); } }
    @media (max-width:640px){ .cards{ grid-template-columns:1fr; } }

    .card{ width:100%; max-width:360px; box-sizing:border-box; }
    .card h3{ margin:0 0 8px; font-size:1.05rem; line-height:1.35rem; }
    .card ul{ margin:0; padding-left:18px; list-style:disc; list-style-position:outside; }
    .card li{ margin:6px 0; }

    .card.emergency{ cursor:pointer; }
  </style>
</head>
<body data-page="szczegoly">

  <div class="nav-links" style="margin:10px 0;">
    <a href="index.html" class="back-link">← Strona główna</a>
    <a id="sectionBack" class="back-link" style="margin-left:14px;">← Wróć do wyboru sekcji</a>
  </div>

  <h1 id="title" style="text-align:center;">Szczegóły</h1>

  <div id="content"></div>
  <div id="err" class="error" style="display:none;color:#ff9999;text-align:center;margin-top:20px;"></div>

  <footer style="margin:40px auto; text-align:center;">
    <p>© 2025 Iminpain — Materiał poglądowy, nie zastępuje konsultacji z lekarzem.</p>
  </footer>

  <script>
  (function(){
    /* mapowanie id → odpowiednia strona powrotu */
    function sectionUrlFromId(id){
      if(!id) return "index.html";
      const female = id.endsWith("_k");
      const male   = id.endsWith("_m");

      const groupMapK = {
        oczy_k:"kobieta-glowa.html", uszy_k:"kobieta-glowa.html", nos_k:"kobieta-glowa.html",
        szczeka_k:"kobieta-glowa.html", szyja_k:"kobieta-glowa.html", glowa_k:"kobieta-glowa.html",
        serce_k:"kobieta-klatka.html", pluca_k:"kobieta-klatka.html", klatka_piersiowa_k:"kobieta-klatka.html",
        brzuch_k:"kobieta-klatka-narzady.html", plecy_k:"kobieta-klatka.html",
        uklad_krw_k:"kobieta-klatka.html", uklad_oddech_k:"kobieta-klatka.html", uklad_pokarm_k:"kobieta-klatka-narzady.html",
        biodra_k:"kobieta-nogi.html", uda_k:"kobieta-nogi.html", kolano_k:"kobieta-nogi.html",
        lydka_k:"kobieta-nogi.html", kostka_k:"kobieta-nogi.html", stopy_k:"kobieta-nogi.html",
        ciaza_k:"kobieta-klatka-narzady.html"
      };
      const groupMapM = {
        oczy_m:"mezczyzna-glowa.html", uszy_m:"mezczyzna-glowa.html", nos_m:"mezczyzna-glowa.html",
        szczeka_m:"mezczyzna-glowa.html", szyja_m:"mezczyzna-glowa.html", glowa_m:"mezczyzna-glowa.html",
        serce_m:"mezczyzna-klatka.html", pluca_m:"mezczyzna-klatka.html", klatka_piersiowa_m:"mezczyzna-klatka.html",
        brzuch_m:"mezczyzna-klatka-narzady.html", plecy_m:"mezczyzna-klatka.html",
        uklad_krw_m:"mezczyzna-klatka.html", uklad_oddech_m:"mezczyzna-klatka.html", uklad_pokarm_m:"mezczyzna-klatka-narzady.html",
        biodra_m:"mezczyzna-nogi.html", uda_m:"mezczyzna-nogi.html", kolano_m:"mezczyzna-nogi.html",
        lydka_m:"mezczyzna-nogi.html", kostka_m:"mezczyzna-nogi.html", stopy_m:"mezczyzna-nogi.html"
      };

      if(female) return groupMapK[id] || "kobieta.html";
      if(male)   return groupMapM[id] || "mezczyzna.html";
      return "index.html";
    }

    const params = new URLSearchParams(location.search);
    const id = params.get("id");
    document.getElementById("sectionBack").href = sectionUrlFromId(id);

    function el(tag, className, html){
      const e = document.createElement(tag);
      if(className) e.className = className;
      if(html !== undefined) e.innerHTML = html;
      return e;
    }

    function card(title, items){
      const c = el('div','card');
      c.appendChild(el('h3',null,title));

      if(Array.isArray(items)){
        const ul = el('ul');
        items.forEach(v=>ul.appendChild(el('li',null,v)));
        c.appendChild(ul);
      }else if(typeof items==='string' && items){
        c.appendChild(el('p',null,items));
      }

      // czerwony kafelek
      if(/Niezwłoczna pomoc/i.test(title)){
        c.classList.add('emergency');
        c.addEventListener('click', ()=>location.href='pomoc.html');
      }
      return c;
    }

    async function load(){
      const err = document.getElementById('err');
      try{
        if(!id) throw new Error("Brak parametru id.");
        const ts = Date.now();

        let data=null;
        try{
          const resA = await fetch('data/detailed_conditions.json?ts='+ts);
          if(resA.ok){ const det=await resA.json(); data=det[id]; }
        }catch(e){}

        if(!data){
          const resB = await fetch('data/conditions.json?ts='+ts);
          if(!resB.ok) throw new Error("Błąd HTTP "+resB.status);
          const base=await resB.json();
          data=base[id];
        }
        if(!data) throw new Error("Nie znaleziono wpisu dla id="+id);

        document.getElementById('title').textContent=data.title||'Szczegóły';

        const grid=el('div','cards');
        const order=[
          ['Możliwe przyczyny',data.causes],
          ['Objawy',data.symptoms],
          ['Kiedy się niepokoić',data.concerns],
          ['Lekarze',data.doctors],
          ['Leki',data.medications],
          ['Pierwsza pomoc',data.first_aid],
          ['Rehabilitacja / Ćwiczenia',data.rehab],
          ['Czego unikać',data.avoid],
          ['Profilaktyka',data.prevention],
          ['Najczęstsze błędy',data.mistakes],
          ['Dodatkowe informacje',data.description]
        ];
        order.forEach(([title,items])=>{
          const has=(Array.isArray(items)&&items.length)||(typeof items==='string'&&items.trim().length);
          if(has) grid.appendChild(card(title,items));
        });

        const emergencyList=Array.isArray(data.emergency)&&data.emergency.length?data.emergency:[
          "Silny, narastający ból, duszność, zlewne poty, omdlenie.",
          "Objawy udaru: osłabienie, bełkotliwa mowa, opadnięty kącik ust.",
          "Ostra duszność, sinica, krwioplucie, silny uraz.",
          "W razie wątpliwości: natychmiast zadzwoń 112."
        ];
        grid.appendChild(card('Niezwłoczna pomoc (112/SOR)',emergencyList));

        const content=document.getElementById('content');
        content.innerHTML='';
        content.appendChild(grid);

      }catch(e){
        err.style.display='block';
        err.textContent='Błąd: '+e.message;
        console.error(e);
      }
    }

    if(document.readyState==='loading'){
      document.addEventListener('DOMContentLoaded',load);
    }else load();
  })();
  </script>

  <script>
  /* Natywne tooltipy jako title (bez zmian w layoucie) */
  (function(){
    const tips={
      "Możliwe przyczyny":"Najczęstsze źródła dolegliwości.",
      "Objawy":"Co możesz odczuwać teraz.",
      "Kiedy się niepokoić":"Czerwone flagi — reaguj szybciej.",
      "Lekarze":"Do kogo najlepiej się zgłosić.",
      "Leki":"Zielone — bez recepty; czerwone — na receptę.",
      "Pierwsza pomoc":"3 szybkie kroki: zabezpiecz – złagodź – obserwuj.",
      "Rehabilitacja / Ćwiczenia":"Delikatny, regularny ruch zwykle pomaga.",
      "Czego unikać":"Co najczęściej nasila objawy.",
      "Profilaktyka":"Nawyki zmniejszające ryzyko nawrotu.",
      "Najczęstsze błędy":"Typowe rzeczy, które utrwalają ból.",
      "Dodatkowe informacje":"Krótkie wskazówki edukacyjne.",
      "Niezwłoczna pomoc (112/SOR)":"Kliknij, by znaleźć najbliższy SOR / pomoc."
    };
    function applyTitles(){
      document.querySelectorAll('.card').forEach(function(card){
        const h=card.querySelector('h3');
        if(!h) return;
        const tip=tips[h.textContent.trim()];
        if(tip) card.setAttribute('title',tip);
      });
    }
    if(document.readyState==='loading') document.addEventListener('DOMContentLoaded',applyTitles);
    else applyTitles();
  })();
  </script>
</body>
</html>
