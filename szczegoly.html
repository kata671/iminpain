<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Boli Help ‚Äî Szczeg√≥≈Çy</title>
  <meta name="theme-color" content="#0e1230" />
  <style>
    :root{
      --bg:#0e1230; --text:#eef2ff; --muted:#b8c2e0;
      --card: rgba(60,32,100,.30); --stroke: rgba(164,107,255,.18);
      --accent:#a46bff; --pink:#ff6ec7; --teal:#5eead4;
      --ok:#70e1b1; --warn:#ffd16c; --danger:#ff6b6b;
      --radius:16px; --gap:14px; --speed:.24s;
      --c-symptoms: rgba(94,234,212,.55);
      --c-causes:   rgba(164,107,255,.55);
      --c-firstaid: rgba(112,225,177,.55);
      --c-otc:      rgba(255,184,108,.65);
      --c-rx:       rgba(255,107,107,.70);
      --c-rehab:    rgba(94,234,212,.65);
      --c-myths:    rgba(164,107,255,.65);
      --c-faq:      rgba(94,234,212,.55);
      --c-dx:       rgba(164,107,255,.65);
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0; background:var(--bg); color:var(--text);
      font:15px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;}
    .bg-anim{position:fixed; inset:0; z-index:-3; pointer-events:none;
      background:
        radial-gradient(42vw 36vh at 16% 12%, rgba(255,110,199,.26), transparent 60%),
        radial-gradient(36vw 30vh at 84% 10%, rgba(94,234,212,.22), transparent 60%),
        radial-gradient(40vw 44vh at 20% 88%, rgba(164,107,255,.16), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,0));
      filter: blur(10px) saturate(118%);
    }
    .grid-bg{position:fixed; inset:0; z-index:-2; pointer-events:none; opacity:.22;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='104' viewBox='0 0 120 104'%3E%3Cg fill='none' stroke='rgba(173,216,255,0.26)' stroke-width='1'%3E%3Cpolygon points='30,0 90,0 120,52 90,104 30,104 0,52'/%3E%3C/g%3E%3C/svg%3E");
      background-size:160px 138px; background-position:center;}
    #bh-particles{ position:fixed; inset:0; z-index:-1; opacity:.85; pointer-events:none }

    header.app{ max-width:1100px; margin:16px auto 0; padding:16px 16px 8px; }
    main{ max-width:1100px; margin:0 auto 72px; padding:0 16px 24px; }

    .bh-backbar{max-width:1100px; margin:8px auto 0; padding:0 16px;}
    #bhReturnTop{
      appearance:none; border:1px solid rgba(164,107,255,.28); background:rgba(60,32,100,.28);
      color:#eef2ff; font-weight:800; letter-spacing:.2px; padding:10px 14px; border-radius:12px; cursor:pointer;
      box-shadow:0 6px 16px rgba(8,10,22,.35), inset 0 0 0 1px rgba(164,107,255,.12), 0 0 8px rgba(164,107,255,.45);
      transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease;
    }
    #bhReturnTop:hover{ transform:translateY(-1px); border-color:rgba(164,107,255,.55); box-shadow:0 10px 20px rgba(8,10,22,.45), 0 0 14px rgba(164,107,255,.65), inset 0 0 0 1px rgba(164,107,255,.18) }
    #bhReturnTop:focus-visible{ outline:2px solid rgba(164,107,255,.75); outline-offset:2px }

    .hero{ background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid var(--stroke); border-radius:var(--radius); padding:16px;
      backdrop-filter: blur(6px) saturate(120%); box-shadow: 0 18px 48px rgba(8,10,22,.55), 0 0 22px rgba(164,107,255,.18);}
    .hero-top{ display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap;}
    .crumbs{font-weight:800; letter-spacing:.2px; color:#cfe2ff}
    .label{ display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px;
      background: rgba(164,107,255,.18); border:1px solid var(--stroke); font-weight:800; letter-spacing:.3px; }
    .hero-note{ margin-top:10px; color:#b8c2e0; font-size:13px; }
    .legend{ color:#d6e4ff; font-weight:700; margin-top:6px; font-size:13px }

    .tabs{ display:flex; flex-wrap:wrap; gap:8px; margin:16px 0 8px; }
    .tab{ padding:9px 13px; border-radius:10px; font-weight:800; letter-spacing:.2px; cursor:pointer; user-select:none;
      background: transparent; border:1px solid rgba(255,255,255,.16); color:#e9efff;
      transition: box-shadow var(--speed), transform var(--speed), border-color var(--speed), background var(--speed);}
    .tab:hover{ transform: translateY(-1px); }
    .tab[data-variant="symptoms"]{ border-color: rgba(94,234,212,.25) }
    .tab[data-variant="causes"]  { border-color: rgba(164,107,255,.25) }
    .tab[data-variant="firstaid"]{ border-color: rgba(112,225,177,.25) }
    .tab[data-variant="otc"]     { border-color: rgba(255,184,108,.28) }
    .tab[data-variant="rx"]      { border-color: rgba(255,107,107,.35) }
    .tab[data-variant="rehab"]   { border-color: rgba(94,234,212,.28) }
    .tab[data-variant="myths"]   { border-color: rgba(164,107,255,.28) }
    .tab[data-variant="faq"]     { border-color: rgba(94,234,212,.25) }
    .tab[data-variant="dx"]      { border-color: rgba(164,107,255,.45) }
    .tab[aria-selected="true"][data-variant="symptoms"]{ border-color: var(--c-symptoms); box-shadow:0 0 0 2px var(--c-symptoms), 0 8px 22px rgba(0,0,0,.25) }
    .tab[aria-selected="true"][data-variant="causes"]  { border-color: var(--c-causes);   box-shadow:0 0 0 2px var(--c-causes),   0 8px 22px rgba(0,0,0,.25) }
    .tab[aria-selected="true"][data-variant="firstaid"]{ border-color: var(--c-firstaid); box-shadow:0 0 0 2px var(--c-firstaid), 0 8px 22px rgba(0,0,0,.25) }
    .tab[aria-selected="true"][data-variant="otc"]     { border-color: var(--c-otc);      box-shadow:0 0 0 2px var(--c-otc),      0 8px 22px rgba(0,0,0,.25) }
    .tab[aria-selected="true"][data-variant="rx"]      { border-color: var(--c-rx);       box-shadow:0 0 0 2px var(--c-rx),       0 8px 22px rgba(0,0,0,.25) }
    .tab[aria-selected="true"][data-variant="rehab"]   { border-color: var(--c-rehab);    box-shadow:0 0 0 2px var(--c-rehab),    0 8px 22px rgba(0,0,0,.25) }
    .tab[aria-selected="true"][data-variant="myths"]   { border-color: var(--c-myths);    box-shadow:0 0 0 2px var(--c-myths),    0 8px 22px rgba(0,0,0,.25) }
    .tab[aria-selected="true"][data-variant="faq"]     { border-color: var(--c-faq);      box-shadow:0 0 0 2px var(--c-faq),      0 8px 22px rgba(0,0,0,.25) }
    .tab[aria-selected="true"][data-variant="dx"]      { border-color: var(--c-dx);       box-shadow:0 0 0 2px var(--c-dx),       0 8px 22px rgba(0,0,0,.25) }

    .cards{ margin-top:8px }
    .card{ display:none; background: var(--card); border:1px solid var(--stroke); border-radius:var(--radius);
      padding:16px 16px 14px; backdrop-filter: blur(10px) saturate(125%); box-shadow: 0 14px 34px rgba(8,10,22,.42);
      transition: transform var(--speed), box-shadow var(--speed), border-color var(--speed); color:var(--text); }
    .card[aria-hidden="false"]{ display:block; animation:fadeIn .28s ease both }
    @keyframes fadeIn{ from{opacity:0; transform:translateY(4px)} to{opacity:1; transform:none} }
    .card:hover{ transform: translateY(-2px); box-shadow: 0 18px 48px rgba(8,10,22,.55), 0 0 22px rgba(164,107,255,.18) }
    .card h3{ position:relative; margin:.15rem 0 .85rem; font-size:16px; font-weight:900; letter-spacing:.3px; color:#e6f0ff }
    .card h3::after{ content:""; display:block; height:1px; margin-top:.55rem;
      background:linear-gradient(90deg, rgba(207,226,255,.55), rgba(255,255,255,.08) 45%, transparent); }
    .card[data-type="symptoms"]{border-color: rgba(94,234,212,.55)}
    .card[data-type="causes"]  {border-color: rgba(164,107,255,.55)}
    .card[data-type="firstaid"]{border-color: rgba(112,225,177,.55)}
    .card[data-type="otc"]     {border-color: rgba(255,184,108,.65)}
    .card[data-type="rx"]      {border-color: rgba(255,107,107,.70)}
    .card[data-type="rehab"]   {border-color: rgba(94,234,212,.65); background: linear-gradient(180deg, rgba(94,234,212,.08), rgba(255,255,255,.04));}
    .card[data-type="myths"]   {border-color: rgba(164,107,255,.65)}
    .card[data-type="faq"]     {border-color: rgba(94,234,212,.55)}
    .card[data-type="dx"]      {border-color: rgba(164,107,255,.65)}

    ul.clean{ list-style:none; margin:0; padding:0 }
    ul.clean li{ position:relative; padding:10px 12px 10px 36px; border-radius:10px; margin-bottom:7px;
      border:1px solid rgba(255,255,255,.10); background: rgba(255,255,255,.03); color:#f6f8ff; }
    .cb{ position:absolute; left:10px; top:50%; transform:translateY(-50%); width:18px; height:18px; border-radius:4px;
      border:1px solid rgba(255,255,255,.35); background:rgba(255,255,255,.05); display:inline-block }
    .cb.checked{ background:#fff; box-shadow:0 0 0 2px rgba(164,107,255,.25) inset }
    .li-checked{ outline:1px solid rgba(164,107,255,.45); background: rgba(164,107,255,.10) }
    .more-wrap{ margin-top:10px }
    .more-btn{ display:inline-block; margin-top:8px; padding:10px 14px; border-radius:10px; font-weight:800;
      background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.18); cursor:pointer; color:#e9efff;
      transition: box-shadow var(--speed);}
    .more-btn:hover{ box-shadow:0 0 0 2px rgba(255,110,199,.32), 0 0 14px rgba(255,110,199,.18) }
    .more-content{ overflow:hidden; max-height:0; transition:max-height .3s ease; }
    .more-content.open{ max-height:1200px }

    .subhead{ margin:.9rem 0 .5rem; font-weight:900; color:#e6f0ff; }
    .risk-mini{ display:flex; align-items:center; gap:10px; margin:.15rem 0 .35rem }
    .risk-mini small{ color:#d6e4ff; font-weight:800 }
    .riskbar{ position:relative; width:200px; height:12px; border-radius:999px; overflow:hidden;
      outline:1px solid rgba(255,255,255,.16);
      background: linear-gradient(90deg, var(--ok), var(--warn), var(--danger)); }
    .cursor{ position:absolute; top:50%; transform:translate(-50%,-50%); width:16px; height:16px; border-radius:50%;
      background:#fff; transition:left .25s ease; }
    .riskbar.high .cursor{ animation:pulse 1s infinite }
    @keyframes pulse{ 0%{ box-shadow:0 0 0 0 rgba(255,107,107,.45)} 70%{ box-shadow:0 0 0 14px rgba(255,107,107,0)} 100%{ box-shadow:0 0 0 0 rgba(255,107,107,0)} }

    .strip{ background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      border: 1px solid rgba(255,255,255,.16); padding:.7rem 1rem; border-radius:.8rem; margin:.6rem 0; }
    .strip--warn{ background: linear-gradient(180deg, rgba(255,184,108,.18), rgba(255,255,255,.04)); border-color: rgba(255,184,108,.55); }
    .strip--warn.alert{ box-shadow:0 0 0 2px rgba(255,107,107,.35), 0 10px 28px rgba(255,20,20,.18); border-color: rgba(255,107,107,.8) }
    .cta{ display:inline-block; padding:8px 12px; border-radius:10px; font-weight:900; background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.18); text-decoration:none; color:var(--text); }

    .dx-list li{ display:flex; gap:10px; align-items:flex-start; }
    .dx-badge{ margin-left:auto; font-size:12px; padding:4px 8px; border-radius:999px; font-weight:900; letter-spacing:.2px }
    .dx-badge.poz{ background:rgba(94,234,212,.18); border:1px solid rgba(94,234,212,.45); color:#d9fffa }
    .dx-badge.sor{ background:rgba(255,107,107,.20); border:1px solid rgba(255,107,107,.65); color:#ffe6e6 }
    .dx-ico{ width:22px; height:22px; display:grid; place-items:center; border-radius:6px;
      background:rgba(164,107,255,.18); border:1px solid rgba(164,107,255,.35) }
    .dx-note{ color:#cfe2ff; font-size:13px; margin:.15rem 0 .35rem }
    .sr-only{ position:absolute !important; left:-9999px !important; }
  </style>
</head>
<body>
  <div class="bg-anim" aria-hidden="true"></div>
  <div class="grid-bg" aria-hidden="true"></div>
  <canvas id="bh-particles" aria-hidden="true"></canvas>

  <div class="bh-backbar">
    <button id="bhReturnTop" type="button" aria-label="Wr√≥ƒá do poprzedniej strony">‚Üê Wr√≥ƒá</button>
  </div>

  <header class="app" aria-label="Nawigacja lokalna">
    <div class="hero" role="region" aria-label="Nag≈Ç√≥wek szczeg√≥≈Ç√≥w">
      <div class="hero-top">
        <div class="crumbs" id="crumbs">Boli Help / <span id="crumb-typ">‚Äî</span> / <span id="crumb-label">Szczeg√≥≈Çy</span></div>
        <div class="label"><span id="label-icon" aria-hidden="true">‚óè</span><span id="label-text"><b>‚Äî</b></span></div>
      </div>

      <div class="tabs" role="tablist" aria-label="Sekcje tre≈õci">
        <button class="tab" data-variant="symptoms" role="tab" aria-selected="true"  data-target="#s-objawy">Objawy</button>
        <button class="tab" data-variant="causes"   role="tab" aria-selected="false" data-target="#s-przyczyny">Przyczyny</button>
        <button class="tab" data-variant="firstaid" role="tab" aria-selected="false" data-target="#s-aid">Pierwsza pomoc</button>
        <button class="tab" data-variant="otc"      role="tab" aria-selected="false" data-target="#s-otc">Leki OTC</button>
        <button class="tab" data-variant="rx"       role="tab" aria-selected="false" data-target="#s-rx">Leki na receptƒô</button>
        <button class="tab" data-variant="rehab"    role="tab" aria-selected="false" data-target="#s-rehab">Rehabilitacja / Profilaktyka</button>
        <button class="tab" data-variant="myths"    role="tab" aria-selected="false" data-target="#s-mity">Mity vs Fakty</button>
        <button class="tab" data-variant="faq"      role="tab" aria-selected="false" data-target="#s-faq">FAQ</button>
        <button class="tab" data-variant="dx"       role="tab" aria-selected="false" data-target="#s-dx">Choroby (beta)</button>
      </div>

      <p class="hero-note">Edukacyjnie, nie diagnostycznie. W nag≈Çej, ciƒô≈ºkiej dolegliwo≈õci lub przy czerwonych flagach ‚Äî skorzystaj z <b>112</b> lub SOR.</p>
      <p class="legend">Zaznacz <strong>objawy</strong> i <strong>czerwone flagi</strong> w karcie ‚ÄûObjawy‚Äù ‚Äî pasek <b>Ryzyko</b> zareaguje automatycznie.</p>
    </div>
  </header>

  <main>
    <section class="cards" aria-label="Karty z informacjami szczeg√≥≈Çowymi">
      <article class="card" data-type="symptoms" id="s-objawy" aria-labelledby="h-obj" role="tabpanel" aria-hidden="false">
        <h3 id="h-obj">Objawy</h3>
        <ul class="clean" id="symp-common"></ul>
        <div class="more-wrap" id="mw-symp-common" hidden>
          <div class="more-content" id="mc-symp-common"></div>
          <button class="more-btn" data-more="symp-common">Poka≈º wiƒôcej</button>
        </div>

        <div class="subhead">Kiedy siƒô niepokoiƒá (czerwone flagi)</div>
        <div class="risk-mini" aria-label="Szacowany poziom ryzyka">
          <small>Ryzyko: <span id="risk-label">niskie</span></small>
          <span class="riskbar" id="riskbar"><span class="cursor" id="risk-cursor-card" style="left:15%"></span></span>
        </div>
        <ul class="clean" id="urgent"></ul>
        <div class="more-wrap" id="mw-urgent" hidden>
          <div class="more-content" id="mc-urgent"></div>
          <button class="more-btn" data-more="urgent">Poka≈º wiƒôcej</button>
        </div>
        <div class="strip strip--warn" id="urgent-strip">
          Masz objawy alarmowe? <strong>Nie zwlekaj.</strong>
          <a class="cta" id="cta-112" href="tel:112" aria-label="Zadzwo≈Ñ na numer alarmowy 112">Zadzwo≈Ñ 112</a>
        </div>
      </article>

      <article class="card" data-type="causes" id="s-przyczyny" role="tabpanel" aria-hidden="true">
        <h3 id="h-cause">Przyczyny</h3>
        <ul class="clean" id="causes"></ul>
        <div class="more-wrap" id="mw-causes" hidden>
          <div class="more-content" id="mc-causes"></div>
          <button class="more-btn" data-more="causes">Poka≈º wiƒôcej</button>
        </div>
      </article>

      <article class="card" data-type="firstaid" id="s-aid" role="tabpanel" aria-hidden="true">
        <h3 id="h-aid">Pierwsza pomoc</h3>
        <ul class="clean" id="firstaid"></ul>
        <div class="more-wrap" id="mw-firstaid" hidden>
          <div class="more-content" id="mc-firstaid"></div>
          <button class="more-btn" data-more="firstaid">Poka≈º wiƒôcej</button>
        </div>
      </article>

      <article class="card" data-type="otc" id="s-otc" role="tabpanel" aria-hidden="true">
        <h3 id="h-otc">Leki bez recepty (OTC)</h3>
        <ul class="clean" id="meds-otc"></ul>
        <div class="more-wrap" id="mw-meds-otc" hidden>
          <div class="more-content" id="mc-meds-otc"></div>
          <button class="more-btn" data-more="meds-otc">Poka≈º wiƒôcej</button>
        </div>
      </article>

      <article class="card" data-type="rx" id="s-rx" role="tabpanel" aria-hidden="true">
        <h3 id="h-rx">Leki na receptƒô (informacyjnie)</h3>
        <ul class="clean" id="meds-rx"></ul>
        <div class="more-wrap" id="mw-meds-rx" hidden>
          <div class="more-content" id="mc-meds-rx"></div>
          <button class="more-btn" data-more="meds-rx">Poka≈º wiƒôcej</button>
        </div>
      </article>

      <article class="card" data-type="rehab" id="s-rehab" role="tabpanel" aria-hidden="true">
        <h3 id="h-rehab">Rehabilitacja / Profilaktyka</h3>
        <ul class="clean" id="rehab"></ul>
        <div class="more-wrap" id="mw-rehab" hidden>
          <div class="more-content" id="mc-rehab"></div>
          <button class="more-btn" data-more="rehab">Poka≈º wiƒôcej</button>
        </div>
      </article>

      <article class="card" data-type="myths" id="s-mity" role="tabpanel" aria-hidden="true">
        <h3 id="h-mity">Mity vs Fakty</h3>
        <ul class="clean" id="myths"></ul>
      </article>

      <article class="card" data-type="faq" id="s-faq" role="tabpanel" aria-hidden="true">
        <h3 id="h-faq">FAQ</h3>
        <ul class="clean" id="faq"></ul>
      </article>

      <article class="card" data-type="dx" id="s-dx" role="tabpanel" aria-hidden="true">
        <h3 id="h-dx">Choroby (beta)</h3>
        <p class="dx-note">Podpowiedzi edukacyjne, generowane na podstawie zaznaczonych objaw√≥w. Nie zastƒôpujƒÖ konsultacji.</p>
        <ul class="clean dx-list" id="dx-list"></ul>
      </article>
    </section>
  </main>

  <script>
    try{ if('scrollRestoration' in history){ history.scrollRestoration = 'manual'; } }catch(e){}
    window.addEventListener('DOMContentLoaded', function(){
      window.scrollTo(0,0);
      const b = document.getElementById('bhReturnTop');
      b?.addEventListener('click', function(){
        if (document.referrer && document.referrer.includes(location.host)) history.back();
        else window.location.href = 'index.html';
      });
    });

    const qs = new URLSearchParams(location.search);
    const RAW_TYP   = (qs.get('typ')||'kobieta').toLowerCase();
    const RAW_CZESC = (qs.get('czesc')||'glowa').toLowerCase();
    const RAW_LABEL = (qs.get('label')||RAW_CZESC).toString();

    const ALIAS = { 'oko':'oczy','klatka-piersiowa':'klatka','watroba':'brzuch','zoladek':'brzuch','ramie':'plecy','d≈Ço≈Ñ':'plecy','dlon':'plecy','udo':'biodra' };
    const TYP = RAW_TYP; const CZESC = ALIAS[RAW_CZESC] || RAW_CZESC; const LABEL = RAW_LABEL;

    document.getElementById('crumb-typ').textContent = TYP;
    document.getElementById('crumb-label').textContent = LABEL;
    document.getElementById('label-text').innerHTML = '<b>'+ LABEL + '</b> ‚Ä¢ ' + TYP;

    const tabs = Array.from(document.querySelectorAll('.tab'));
    const panels = Array.from(document.querySelectorAll('.card[role="tabpanel"]'));
    function showPanel(targetSel){
      panels.forEach(p=>{ const active = ('#'+p.id)===targetSel; p.setAttribute('aria-hidden', active? 'false':'true'); });
      tabs.forEach(t=>{ const on = t.getAttribute('data-target')===targetSel; t.setAttribute('aria-selected', on?'true':'false'); if(on) t.focus({preventScroll:true}); });
      document.querySelector(targetSel)?.scrollIntoView({behavior:'smooth', block:'start'});
    }
    tabs.forEach(t=>{
      t.addEventListener('click', ()=> showPanel(t.getAttribute('data-target')));
      t.addEventListener('keydown', e=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); t.click(); } });
    });
    (function tabsKeyboard(){
      const order = tabs;
      tabs.forEach((t,i)=>{
        t.addEventListener('keydown',e=>{
          if(e.key==='ArrowRight'){ e.preventDefault(); order[(i+1)%order.length].focus(); }
          if(e.key==='ArrowLeft'){ e.preventDefault(); order[(i-1+order.length)%order.length].focus(); }
        });
      });
    })();

    const BASE = {
      rehabCommon:["Sen i regeneracja ‚Äî 7‚Äì9 h","Nawodnienie ‚Äî ma≈Çe porcje","Lekka aktywno≈õƒá 20‚Äì30 min","Ergonomia ‚Äî przerwy co 30‚Äì45 min","Oddech przeponowy ‚Äî 5 min","Higiena cyfrowa ‚Äî 20-20-20"],
      otcPain:[{t:"Paracetamol ‚Äî b√≥l/gorƒÖczka",audience:"all"},{t:"Ibuprofen ‚Äî b√≥l/zapalenie (nie przy wrzodach/ciƒÖ≈ºy)",audience:"adult"},{t:"S√≥l fizjologiczna/nawil≈ºanie",audience:"all"},{t:"Przeciwhistaminowe ‚Äî po konsultacji",audience:"all"}],
      urgentCommon:["Nag≈Ça, silna, narastajƒÖca dolegliwo≈õƒá","Utrata przytomno≈õci/drgawki","Trudno≈õci w oddychaniu lub sinica","Krwawienie nie do opanowania","GorƒÖczka >39¬∞C mimo leczenia","Nowe objawy neurologiczne"],
      mythsCommon:[{m:"Antybiotyk na przeziƒôbienie",f:"Wiƒôkszo≈õƒá przeziƒôbie≈Ñ to wirusy."},{m:"B√≥l trzeba przeczekaƒá",f:"Nawodnienie i odpoczynek pomagajƒÖ."},{m:"Im wiƒôcej lek√≥w, tym lepiej",f:"Lepiej mniej, ale w≈Ça≈õciwie dobranych."}],
      faqCommon:[{q:"Co w domu?",a:"Pierwsza pomoc + obserwacja czerwonych flag."},{q:"Kiedy do lekarza?",a:"Gdy silne/utrzymujƒÖce siƒô 48‚Äì72h lub flagi."},{q:"≈ÅƒÖczenie OTC?",a:"Nie duplikuj substancji czynnych."}]
    };

    const CONTENT = {
      glowa:{label:"G≈Çowa (b√≥l)",risk:30,symptoms:["Ucisk obustronny","PulsujƒÖcy jednostronny","Nadwra≈ºliwo≈õƒá na ≈õwiat≈Ço/d≈∫wiƒôk","Sztywno≈õƒá karku"],causes:["Napiƒôcie/stres","Migrena","Nadu≈ºycie lek√≥w","Sen/ekrany"],firstaid:["Nawodnienie, odpoczynek","Masa≈º skroni","Ch≈Çodny/ciep≈Çy ok≈Çad","Kr√≥tki spacer"],otc:[...BASE.otcPain],rx:["Tryptany","Profilaktyka migreny"],rehab:[...BASE.rehabCommon,"Dzienniczek b√≥lu","ƒÜwiczenia karku"],urgent:["Nag≈Çy najgorszy b√≥l","GorƒÖczka + sztywno≈õƒá karku","Uraz g≈Çowy + zaburzenia",...BASE.urgentCommon.slice(2)],myths:[...BASE.mythsCommon],faq:[...BASE.faqCommon]},
      nos:{label:"Nos",risk:20,symptoms:["Katar wodnisty/gƒôsty","Zatkanie, upo≈õledzenie wƒôchu","Kichanie/≈õwiƒÖd (alergia)","B√≥l zatok","Krwawienie z nosa"],causes:["Przeziƒôbienie","Alergia","Zapalenie zatok","Suche powietrze","Krzywa przegroda, polipy","Uraz"],firstaid:["Nawil≈ºanie NaCl","Nawil≈º powietrze, wietrz","Krwawienie: pochyl, ucisk 10 min","Ch≈Çodny ok≈Çad"],otc:["Aerozole z solƒÖ","Krople obkurczajƒÖce (kr√≥tkotrwale)","P/histaminowe","Preparaty do zatok"],rx:["Donosowe GKS","Antybiotyk przy bakteryjnych"],rehab:[...BASE.rehabCommon,"Irygacje nosa","Unikanie dymu/zapach√≥w"],urgent:["Krwawienie >20 min","Wysoka gorƒÖczka + silny b√≥l zatok","Uraz/deformacja/wyciek p≈Çynu",...BASE.urgentCommon.slice(2)],myths:[...BASE.mythsCommon],faq:[...BASE.faqCommon]},
      klatka:{label:"Klatka piersiowa",risk:60,symptoms:["Ucisk/ciƒô≈ºar","B√≥l przy oddychaniu/ucisku","Zgaga/pieczenie","Duszno≈õƒá, zimny pot"],causes:["Miƒô≈õniowe","Refluks","Wie≈Ñcowa/OZW","Op≈Çucna/osierdzie"],firstaid:["Odpoczynek","Przy ucisku i duszno≈õci ‚Äî 112/SOR","P√≥≈ÇsiedzƒÖco"],otc:[{t:"P/b√≥lowe wg ulotki",audience:"adult"},"Na refluks"],rx:[{t:"Nitrogliceryna wg zalece≈Ñ",audience:"adult"},"Leczenie kardiologiczne"],rehab:[...BASE.rehabCommon,"Redukcja ryzyka: ruch/dieta/sen","Stopniowy powr√≥t do aktywno≈õci"],urgent:["Ucisk do lewej rƒôki/szczƒôki + pot","Duszno≈õƒá spoczynkowa","Omdlenie/ko≈Çatanie",...BASE.urgentCommon.slice(2)],myths:[...BASE.mythsCommon],faq:[...BASE.faqCommon]},
      pluca:{label:"P≈Çuca/Duszno≈õƒá",risk:55,symptoms:["Duszno≈õƒá","Kaszel suchy/mokry","≈öwisty","Zmƒôczenie"],causes:["Infekcje","Astma/POChP","Alergie","Zatorowo≈õƒá"],firstaid:["Wolny oddech, d≈Çugi wydech","P√≥≈ÇsiedzƒÖco","Nawodnienie, wietrzenie"],otc:["Syropy (dob√≥r z farmaceutƒÖ)","Inhalacje NaCl"],rx:["Celowane po diagnozie"],rehab:[...BASE.rehabCommon,"ƒÜwiczenia oddechowe"],urgent:["Duszno≈õƒá spoczynkowa","B√≥l w klatce + duszno≈õƒá","Sinica/krwioplucie",...BASE.urgentCommon.slice(2)],myths:[...BASE.mythsCommon],faq:[...BASE.faqCommon]},
      brzuch:{label:"Brzuch",risk:40,symptoms:["B√≥l (lokalizacja r√≥≈ºna)","Wzdƒôcia, nudno≈õci, biegunka/zaparcie","Twardy brzuch (alarm)"],causes:["Niestrawno≈õƒá","IBS","Wyrostek/kamica","Zaparcia"],firstaid:["Nawadnianie ma≈Çymi porcjami","Termofor (gdy brak ostrego brzucha)","Odpoczynek"],otc:["Os≈Çonowe/przeciwwzdƒôciowe","Na zgagƒô/kwas",{t:"Drotaweryna (doro≈õli)",audience:"adult"}],rx:["PPI/antybiotyk wg rozpoznania"],rehab:[...BASE.rehabCommon,"Regularne posi≈Çki, mniej przetworzonej","Dzienniczek objaw√≥w/dieta"],urgent:["Twardy brzuch, silny b√≥l","Krew w stolcu/wymiotach",...BASE.urgentCommon.slice(2)],myths:[...BASE.mythsCommon],faq:[...BASE.faqCommon]},
      serce:{label:"Serce",risk:65,symptoms:["Ko≈Çatanie","Zawroty/os≈Çabienie","B√≥l klatki, duszno≈õƒá"],causes:["Stres/odwodnienie","Zaburzenia rytmu","Wie≈Ñcowa"],firstaid:["Odpoczynek, spokojny oddech","Nawodnienie"],otc:["Brak uniwersalnych OTC"],rx:["EKG + leczenie"],rehab:[...BASE.rehabCommon,"Trening tlenowy po ocenie","Stres, sen"],urgent:["Ko≈Çatanie z omdleniem","B√≥l z duszno≈õciƒÖ",...BASE.urgentCommon.slice(2)],myths:[...BASE.mythsCommon],faq:[...BASE.faqCommon]},
      biodra:{label:"Biodra",risk:25,symptoms:["B√≥l pachwiny/biodra","Trzaski/sztywno≈õƒá","Ograniczenie ruchu"],causes:["PrzeciƒÖ≈ºenie/kaletka","Zmiany przeciƒÖ≈ºeniowe","Nier√≥wnowaga"],firstaid:["Odpoczynek wzglƒôdny","Ch≈Çodzenie/ciep≈Ço","RozciƒÖganie"],otc:[...BASE.otcPain],rx:["P/zapalne"],rehab:[...BASE.rehabCommon,"Aktywacja po≈õladkowych"],urgent:["Uraz + brak obciƒÖ≈ºania",...BASE.urgentCommon.slice(2)],myths:[...BASE.mythsCommon],faq:[...BASE.faqCommon]},
      kolano:{label:"Kolano",risk:25,symptoms:["B√≥l przodu kolana","Obrzƒôk po wysi≈Çku/urazie","Niestabilno≈õƒá"],causes:["PrzeciƒÖ≈ºenie rzepki","Uraz wiƒôzade≈Ç/≈ÇƒÖkotek","Zapalenie ≈õciƒôgien"],firstaid:["RICE","Unikaj b√≥lu, wracaj stopniowo","Elastyczna stabilizacja"],otc:[...BASE.otcPain],rx:["Wg ortopedy/fizjo"],rehab:[...BASE.rehabCommon,"Wzmacnianie czworog≈Çowych"],urgent:["Uraz z ‚Äûtrzaskiem‚Äù + obrzƒôk",...BASE.urgentCommon.slice(2)],myths:[...BASE.mythsCommon],faq:[...BASE.faqCommon]},
      stopy:{label:"Stopy",risk:15,symptoms:["B√≥l piƒôty/przodostopia","Odciski/pƒôcherze","Sztywno≈õƒá poranna"],causes:["Obuwie/obciƒÖ≈ºenia","Rozciƒôgno/≈õciƒôgna","Biomechanika"],firstaid:["Lepsze obuwie, wk≈Çadki","Ch≈Çodzenie, rolowanie","Stopniowe obciƒÖ≈ºenia"],otc:[...BASE.otcPain],rx:["Fizjoterapia"],rehab:[...BASE.rehabCommon,"ƒÜwiczenia st√≥p","RozciƒÖganie Achillesa"],urgent:["Ostry b√≥l + obrzƒôk, brak chodu",...BASE.urgentCommon.slice(2)],myths:[...BASE.mythsCommon],faq:[...BASE.faqCommon]},
      skora:{label:"Sk√≥ra",risk:15,symptoms:["Wysypka/≈õwiƒÖd","Sucho≈õƒá/pƒôkanie","Pƒôcherze/sƒÖczenie"],causes:["Alergia/AZS","UkƒÖszenia/podra≈ºnienia","Infekcje"],firstaid:["Ch≈Çodzenie, delikatne mycie","Emolienty","Usu≈Ñ alergen"],otc:["Emolienty/bariera","P/histaminowe doustne","Antyseptyki miejscowe"],rx:["Sterydy/antybiotyki miejscowe"],rehab:[...BASE.rehabCommon,"Letni prysznic","Bawe≈Çna, delikatne detergenty"],urgent:["Szybko szerzƒÖca siƒô wysypka + gorƒÖczka","Obrzƒôk twarzy/warg/jƒôzyka",...BASE.urgentCommon.slice(2)],myths:[...BASE.mythsCommon],faq:[...BASE.faqCommon]},
      kaszel:{label:"Kaszel",risk:25,symptoms:["Suchy/mokry","Duszno≈õƒá, chrypka"],causes:["Infekcje","Alergie/dra≈ºnienie","Refluks"],firstaid:["Nawadnianie, nawil≈ºanie","Unikaj dymu","Mi√≥d (‚â•1 r.≈º.)"],otc:["Syropy (dob√≥r z farmaceutƒÖ)","Inhalacje NaCl"],rx:["Leczenie przyczynowe"],rehab:[...BASE.rehabCommon,"ƒÜwiczenia oddechowe"],urgent:["Duszno≈õƒá spoczynkowa/sinica/krwioplucie",...BASE.urgentCommon.slice(2)],myths:[...BASE.mythsCommon],faq:[...BASE.faqCommon]},
      goraczka:{label:"GorƒÖczka",risk:30,symptoms:["Temp., dreszcze","B√≥le miƒô≈õni/g≈Çowy"],causes:["Wirusy/bakterie","Zapalenia"],firstaid:["Nawodnienie, lekki ubi√≥r","Letnie ok≈Çady/kƒÖpiel (bez alkoholu)"],otc:[{t:"Paracetamol/ibuprofen wg ulotki",audience:"all"}],rx:["Celowane po diagnozie"],rehab:[...BASE.rehabCommon,"Odpoczynek"],urgent:[">39¬∞C mimo leczenia","Sztywno≈õƒá karku, silny b√≥l g≈Çowy",...BASE.urgentCommon.slice(2)],myths:[...BASE.mythsCommon],faq:[...BASE.faqCommon]},
      zadlawienie:{label:"Zad≈Çawienie",risk:80,symptoms:["Nag≈Ça duszno≈õƒá","Chwytanie za szyjƒô","Bez/skƒÖpokaszlowy napad"],causes:["Kƒôs/ma≈Çe przedmioty"],firstaid:["Skuteczny kaszel ‚Äî zachƒôcaj","Doros≈Çy: 5 uderze≈Ñ plec√≥w ‚Üí Heimlich","Dziecko >1 r.≈º.: 5 plec√≥w ‚Üí 5 nadbrzusza","Niemowlƒô: 5 plec√≥w ‚Üí 5 uci≈õniƒôƒá klatki","Utrata przytomno≈õci: RKO 30:2, 112, AED"],otc:["‚Äî"],rx:["‚Äî"],rehab:[...BASE.rehabCommon,"Edukacja i profilaktyka"],urgent:["Ka≈ºde ciƒô≈ºkie zad≈Çawienie ‚Äî 112"],myths:[{m:"‚ÄûPalcem w ciemno‚Äù",f:"Ryzyko wepchniƒôcia g≈Çƒôbiej."}],faq:[...BASE.faqCommon]},
      ciaza:{label:"CiƒÖ≈ºa",risk:35,symptoms:["Nudno≈õci/wymioty","Zgaga/zaparcia","B√≥l krzy≈ºa/kurcze","Obrzƒôki","Zawroty"],causes:["Hormony","Zmiana postawy/ucisk","Niedobory"],firstaid:["Ma≈Çe, czƒôste posi≈Çki","Nawodnienie; imbir (po konsultacji)","Ruszaj siƒô ≈Çagodnie","Zgaga: unie≈õ wezg≈Çowie"],otc:["Witaminy wg zalece≈Ñ","≈örodki dozwolone w ciƒÖ≈ºy"],rx:["Tylko po ocenie lekarskiej"],rehab:[...BASE.rehabCommon,"ƒÜwiczenia w ciƒÖ≈ºy","Fizjo uroginekologiczna","Pozycje odciƒÖ≈ºajƒÖce"],urgent:["Krwawienie, silny b√≥l","Nag≈Çy obrzƒôk twarzy/b√≥l g≈Çowy","Zmniejszone ruchy p≈Çodu","Silna duszno≈õƒá/b√≥l w klatce",...BASE.urgentCommon.slice(2)],myths:[...BASE.mythsCommon],faq:[...BASE.faqCommon]}
    };

    const FALLBACK = { label: LABEL || CZESC, risk: 25, ...CONTENT.glowa };
    const entry = CONTENT[CZESC] || FALLBACK;
    document.getElementById('label-text').innerHTML = '<b>'+ (entry.label||LABEL) + '</b> ‚Ä¢ ' + TYP;

    const isChild = (TYP === 'dziecko');
    const allowItem = (item)=>{ if(typeof item==='string') return true; const aud=(item.audience||'all'); return isChild ? aud!=='adult' : aud!=='child'; };
    const textOf = (item)=> typeof item === 'string' ? item : item.t;

    const HIGH_RISK_PHRASES=["duszno≈õƒá","sinica","utrata przytomno≈õci","krwawienie","nag≈Ça","najgorszy b√≥l","omdlenie","krwioplucie"];
    const MID_RISK_PHRASES=["gorƒÖczka","sztywno≈õƒá karku","silny b√≥l","utrzymujƒÖce siƒô","zaburzenia widzenia","zawroty"];
    function weightFor(text,bucket){
      const s=(text||"").toLowerCase();
      if(bucket==='urgent') return 30;
      if(HIGH_RISK_PHRASES.some(k=>s.includes(k))) return 20;
      if(MID_RISK_PHRASES.some(k=>s.includes(k)))  return 10;
      if(bucket==='symptoms') return 8;
      return 0;
    }

    let selectedWeights=0;
    function updateRisk(){
      const base=Math.max(0,Math.min(100,entry.risk||25));
      const val =Math.max(0,Math.min(100,base+selectedWeights));
      const c=document.getElementById('risk-cursor-card');
      const bar=document.getElementById('riskbar');
      const lbl=document.getElementById('risk-label');
      if(c){ c.style.left = val + '%'; }
      if(lbl){ let t="niskie"; if(val>=70) t="wysokie"; else if(val>=40) t="umiarkowane"; lbl.textContent=t; }
      if(bar){
        const high=val>=70; bar.classList.toggle('high',high);
        const strip=document.getElementById('urgent-strip'); const cta=document.getElementById('cta-112');
        strip?.classList.toggle('alert',high); cta?.classList.toggle('cta-alert',high);
        if(high && navigator.vibrate){ try{ navigator.vibrate(120);}catch(_){} }
      }
    }

    function renderListInteractive(baseId,arr,bucket,threshold=7){
      const list=document.getElementById(baseId);
      const wrap=document.getElementById('mw-'+baseId);
      const moreContent=document.getElementById('mc-'+baseId);
      if(!list) return;
      list.innerHTML=''; const visible=[];
      (arr||[]).forEach(it=>{ if(allowItem(it)) visible.push(textOf(it)); });
      const head=visible.slice(0,threshold); const tail=visible.slice(threshold);
      function makeLi(txt){
        const li=document.createElement('li');
        const cb=document.createElement('span'); cb.className='cb'; cb.setAttribute('role','checkbox'); cb.setAttribute('aria-checked','false');
        li.appendChild(cb);
        const w=weightFor(txt,bucket); li.dataset.weight=String(w);
        li.appendChild(document.createTextNode(txt));
        function toggle(){
          const on=cb.classList.toggle('checked'); li.classList.toggle('li-checked',on); cb.setAttribute('aria-checked',on?'true':'false');
          selectedWeights += (on? +w : -w);
          updateRisk();
          try{ document.dispatchEvent(new CustomEvent('bh:symptoms-changed')); }catch(_){}
        }
        li.addEventListener('click',e=>{ if(e.target!==cb) toggle(); });
        cb.addEventListener('click',e=>{ e.stopPropagation(); toggle(); });
        return li;
      }
      head.forEach(t=>list.appendChild(makeLi(t)));
      if(tail.length && wrap && moreContent){
        wrap.hidden=false; moreContent.innerHTML='';
        const ul=document.createElement('ul'); ul.className='clean'; tail.forEach(t=>ul.appendChild(makeLi(t)));
        moreContent.appendChild(ul);
        const btn=wrap.querySelector('.more-btn'); let open=false;
        btn.onclick=()=>{ open=!open; moreContent.classList.toggle('open',open); btn.textContent=open?'Poka≈º mniej':'Poka≈º wiƒôcej'; };
      }else if(wrap){ wrap.hidden=true; }
    }

    function renderListPlain(baseId,arr,threshold=7){
      const list=document.getElementById(baseId);
      const wrap=document.getElementById('mw-'+baseId);
      const moreContent=document.getElementById('mc-'+baseId);
      if(!list) return;
      list.innerHTML=''; const visible=[];
      (arr||[]).forEach(it=>{ if(allowItem(it)) visible.push(textOf(it)); });
      const head=visible.slice(0,threshold); const tail=visible.slice(threshold);
      function makeLi(txt){ const li=document.createElement('li'); const cb=document.createElement('span'); cb.className='cb'; cb.style.visibility='hidden'; li.appendChild(cb); li.appendChild(document.createTextNode(txt)); return li; }
      head.forEach(t=>list.appendChild(makeLi(t)));
      if(tail.length && wrap && moreContent){
        wrap.hidden=false; moreContent.innerHTML='';
        const ul=document.createElement('ul'); ul.className='clean'; tail.forEach(t=>ul.appendChild(makeLi(t)));
        moreContent.appendChild(ul);
        const btn=wrap.querySelector('.more-btn'); let open=false;
        btn.onclick=()=>{ open=!open; moreContent.classList.toggle('open',open); btn.textContent=open?'Poka≈º mniej':'Poka≈º wiƒôcej'; };
      }else if(wrap){ wrap.hidden=true; }
    }

    function fillPairs(id,arr){
      const ul=document.getElementById(id); if(!ul) return;
      ul.innerHTML=''; (arr||[]).forEach(x=>{
        const li=document.createElement('li'); const cb=document.createElement('span'); cb.className='cb'; cb.style.visibility='hidden';
        li.appendChild(cb);
        const m=document.createElement('div'); const f=document.createElement('div');
        m.innerHTML='<strong>Mit:</strong> '+(x.m||'‚Äî'); f.innerHTML='<strong>Fakt:</strong> '+(x.f||'‚Äî');
        ul.appendChild(li); li.appendChild(m); li.appendChild(f);
      });
    }

    function fillFAQ(id,arr){
      const ul=document.getElementById(id); if(!ul) return;
      ul.innerHTML=''; (arr||[]).forEach(x=>{
        const li=document.createElement('li'); const cb=document.createElement('span'); cb.className='cb'; cb.style.visibility='hidden';
        li.appendChild(cb);
        li.innerHTML += '<strong>'+ (x.q||'Pytanie') +'</strong><div style="margin-top:4px;color:#b8c2e0">'+ (x.a||'Odpowied≈∫') +'</div>';
        ul.appendChild(li);
      });
    }

    renderListInteractive('symp-common', entry.symptoms, 'symptoms');
    renderListInteractive('urgent',      entry.urgent||[],   'urgent', 6);
    renderListPlain('causes',   entry.causes||[]);
    renderListPlain('firstaid', entry.firstaid||[]);
    renderListPlain('meds-otc', entry.otc||[]);
    renderListPlain('meds-rx',  entry.rx||[]);
    renderListPlain('rehab',    entry.rehab||[]);
    fillPairs('myths', entry.myths||[]);
    fillFAQ('faq',     entry.faq||[]);

    selectedWeights=0; updateRisk(); showPanel('#s-objawy');

    /* ===== Choroby (beta) ===== */
    const DX_RULES = {
      glowa: [
        {name:"B√≥l napiƒôciowy g≈Çowy", ifAny:["ucisk obustronny","stres","ekran"], advice:"POZ / samoobserwacja", badge:"poz"},
        {name:"Migrena", ifAny:["pulsujƒÖcy jednostronny","≈õwiat≈Ço","d≈∫wiƒôk"], advice:"POZ (neurolog przy nawrotach)", badge:"poz"},
        {name:"ZOMR ‚Äî pilnie", ifAny:["sztywno≈õƒá karku","wysoka gorƒÖczka"], advice:"pilnie SOR / 112", badge:"sor"}
      ],
      nos: [
        {name:"Nie≈ºyt nosa (wirusowy)", ifAny:["katar","zatkanie","kichanie"], advice:"POZ / objawowo", badge:"poz"},
        {name:"Zapalenie zatok", ifAny:["b√≥l zatok","gorƒÖczka"], advice:"POZ (rozwa≈º antybiotyk wg oceny)", badge:"poz"}
      ],
      klatka: [
        {name:"Refluks/zgaga", ifAny:["zgaga","pieczenie"], advice:"POZ / leczenie kwasu", badge:"poz"},
        {name:"OZW/Zawa≈Ç ‚Äî pilnie", ifAny:["ucisk","zimny pot","duszno≈õƒá"], advice:"pilnie SOR / 112", badge:"sor"}
      ],
      pluca: [
        {name:"Infekcja dr√≥g oddechowych", ifAny:["kaszel","gorƒÖczka"], advice:"POZ / obserwacja", badge:"poz"},
        {name:"Astma/POChP zaostrzenie", ifAny:["≈õwisty","duszno≈õƒá"], advice:"POZ pilnie / SOR przy ciƒô≈ºkiej duszno≈õci", badge:"poz"}
      ],
      brzuch: [
        {name:"Niestrawno≈õƒá/IBS", ifAny:["wzdƒôcia","biegunka","zaparcie"], advice:"POZ / dieta / nawadnianie", badge:"poz"},
        {name:"Ostry brzuch ‚Äî pilnie", ifAny:["twardy brzuch","silny b√≥l"], advice:"pilnie SOR / 112", badge:"sor"}
      ],
      serce: [
        {name:"Zaburzenia rytmu", ifAny:["ko≈Çatanie","zawroty"], advice:"POZ ‚Üí EKG", badge:"poz"},
        {name:"OZW ‚Äî pilnie", ifAny:["b√≥l klatki","duszno≈õƒá"], advice:"pilnie SOR / 112", badge:"sor"}
      ],
      biodra: [
        {name:"PrzeciƒÖ≈ºenie/kaletka", ifAny:["b√≥l","trzaski","sztywno≈õƒá"], advice:"POZ/Fizjo", badge:"poz"}
      ],
      kolano: [
        {name:"PrzeciƒÖ≈ºenie rzepki", ifAny:["b√≥l przodu kolana"], advice:"POZ/Fizjo", badge:"poz"}
      ],
      oczy: [
        {name:"Zapalenie spoj√≥wek", ifAny:["zaczerwienienie","≈Çzawienie","wydzielina"], advice:"POZ / higiena", badge:"poz"},
        {name:"Uraz/chemikalia ‚Äî pilnie", ifAny:["uraz","chemikalia"], advice:"pilnie SOR/okulista", badge:"sor"}
      ],
      skora: [
        {name:"AZS/alergia", ifAny:["wysypka","≈õwiƒÖd"], advice:"POZ / emolienty", badge:"poz"}
      ]
    };

    function gatherSelectedTexts(){
      const from = (ulId)=> Array.from(document.querySelectorAll('#'+ulId+' li.li-checked'))
                                  .map(li=> li.textContent.trim().toLowerCase());
      return { symp: from('symp-common'), urgent: from('urgent') };
    }

    function computeDx(){
      try{
        const {symp, urgent} = gatherSelectedTexts();
        const texts = (symp.concat(urgent)).join(' | ');
        const rules = DX_RULES[CZESC] || [];
        const hits = [];

        const urgentHit = ["duszno≈õƒá","sinica","utrata przytomno≈õci","twardy brzuch","krwawienie","najgorszy b√≥l"].some(k=>texts.includes(k));
        if(urgentHit){
          hits.push({name:"Objawy alarmowe", advice:"Zadzwo≈Ñ 112 / SOR", badge:"sor", ico:"‚ö†Ô∏è"});
        }

        rules.forEach(r=>{
          const ok = (r.ifAny||[]).some(key=> texts.includes(String(key).toLowerCase()));
          if(ok) hits.push({name:r.name, advice:r.advice, badge:r.badge, ico: r.badge==='sor'?'‚ö†Ô∏è':'ü©∫'});
        });

        if(!hits.length){
          hits.push({name:"Za ma≈Ço danych", advice:"Zaznacz objawy w zak≈Çadce ‚ÄûObjawy‚Äù", badge:"poz", ico:"‚ÑπÔ∏è"});
        }
        return hits.slice(0,4);
      }catch(_){
        return [{name:"Chwilowy b≈ÇƒÖd", advice:"Od≈õwie≈º stronƒô lub zaznacz objawy ponownie.", badge:"poz", ico:"‚ÑπÔ∏è"}];
      }
    }

    function renderDx(){
      const ul = document.getElementById('dx-list'); if(!ul) return;
      const items = computeDx();
      ul.innerHTML = '';
      items.forEach(it=>{
        const li = document.createElement('li');
        const cb=document.createElement('span'); cb.className='cb'; cb.style.visibility='hidden';
        const ico=document.createElement('span'); ico.className='dx-ico'; ico.textContent = it.ico || 'ü©∫';
        const text=document.createElement('div');
        text.innerHTML = `<strong>${it.name}</strong><div style="color:#b8c2e0;margin-top:4px">${it.advice}</div>`;
        const badge=document.createElement('span'); badge.className='dx-badge '+(it.badge==='sor'?'sor':'poz'); badge.textContent = it.badge==='sor'?'pilnie SOR':'POZ';
        li.appendChild(cb); li.appendChild(ico); li.appendChild(text); li.appendChild(badge);
        ul.appendChild(li);
      });
    }

    document.addEventListener('bh:symptoms-changed', renderDx);
    document.querySelector('[data-target="#s-dx"]')?.addEventListener('click', renderDx);
    renderDx();

    (function particles(){
      const c=document.getElementById('bh-particles'); if(!c) return;
      const prefersReduced=window.matchMedia?.('(prefers-reduced-motion: reduce)')?.matches;
      const dpr=Math.min(2,window.devicePixelRatio||1);
      const ctx=c.getContext('2d'); let W,H,dots=[];
      function targetCount(){ const t=Math.floor((innerWidth*innerHeight)/12000); return Math.max(90,Math.min(220,t)); }
      function resize(){
        W=c.width=Math.floor(innerWidth*dpr); H=c.height=Math.floor(innerHeight*dpr);
        c.style.width=innerWidth+'px'; c.style.height=innerHeight+'px';
        const N=targetCount(); dots=Array.from({length:N},()=>({x:Math.random()*W,y:Math.random()*H,vx:(Math.random()-.5)*.18*dpr,vy:(Math.random()-.5)*.18*dpr,r:(Math.random()*1.7+0.9)*dpr,a:Math.random()*.6+.25}));
      }
      function step(){
        ctx.clearRect(0,0,W,H);
        for(const p of dots){
          p.x+=p.vx; p.y+=p.vy; if(p.x<0||p.x>W) p.vx*=-1; if(p.y<0||p.y>H) p.vy*=-1;
          ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
          const g=ctx.createRadialGradient(p.x,p.y,0,p.x,p.y,p.r*3.2);
          g.addColorStop(0,`rgba(164,107,255,${0.26*p.a})`); g.addColorStop(1,`rgba(94,234,212,0)`); ctx.fillStyle=g; ctx.fill();
        }
        if(!prefersReduced) requestAnimationFrame(step);
      }
      addEventListener('resize',resize,{passive:true}); resize(); step();
    })();
  </script>
</body>
</html>
