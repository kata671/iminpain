<!DOCTYPE html>
<html lang="pl" data-page="szczegoly">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title id="title">Szczeg√≥≈Çy</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="style-overrides.css?v=9">

  <style>
  /* Uk≈Çad 3√ó i r√≥wne rzƒôdy */
  body[data-page="szczegoly"] .cards{
    display:grid;
    grid-template-columns: repeat(3, 320px);
    justify-content:center;
    gap:22px;
    max-width:1100px;
    margin:22px auto 32px;
    padding:0 12px;
  }
  @media (max-width:920px){
    body[data-page="szczegoly"] .cards{ grid-template-columns:repeat(2,320px); }
  }
  @media (max-width:560px){
    body[data-page="szczegoly"] .cards{ grid-template-columns:1fr; }
  }

  body[data-page="szczegoly"] .card{
    width:320px; height:360px;
    display:flex; flex-direction:column;
    box-sizing:border-box;
  }
  body[data-page="szczegoly"] .card .card-caption{
    display:flex; align-items:center; justify-content:center;
    min-height:52px; padding:8px 10px;
    text-align:center; font-weight:700;
    border-bottom:1px solid rgba(255,255,255,.08);
  }
  body[data-page="szczegoly"] .card ul,
  body[data-page="szczegoly"] .card p{
    margin:12px 12px 14px; padding:0;
    flex:1; overflow:auto;
  }
  body[data-page="szczegoly"] .card li{ list-style:disc inside; margin:6px 0; }

  /* Czerwony kafel */
  body[data-page="szczegoly"] .card.emergency{
    border:2px solid #ff4d4d;
    background:rgba(120,20,20,.88);
    color:#fff;
    font-weight:700;
  }
  body[data-page="szczegoly"] .card.emergency:hover{
    box-shadow:0 0 28px rgba(255,30,30,.9);
  }

  /* Spacer ‚Äì niewidoczny wype≈Çniacz */
  body[data-page="szczegoly"] .card.spacer{
    visibility:hidden;
    pointer-events:none;
    background:transparent;
    border:none;
    box-shadow:none;
  }
  </style>
</head>
<body>
  <nav><a id="sectionBack" href="index.html">‚Üê Powr√≥t</a></nav>
  <main id="content"><p>≈Åadowanie‚Ä¶</p></main>

  <script>
  (function () {
    function uniq(arr){ return Array.from(new Set((arr||[]).filter(Boolean))); }
    function mergeNodes(detailed, base){
      const src = detailed || {}, fall = base || {};
      const out = { title: src.title || fall.title || "Szczeg√≥≈Çy" };
      const keys = ["causes","symptoms","concerns","doctors","medications","first_aid","emergency","rehabilitation","avoid","prevention","mistakes"];
      keys.forEach(k => out[k] = uniq([...(fall[k]||[]), ...(src[k]||[])]));
      out.description = (src.description || "") || (fall.description || "");
      return out;
    }
    function card(title, items){
      const div = document.createElement("article");
      div.className = "card";
      let html = `<div class="card-caption">${title}</div>`;
      if(Array.isArray(items)){
        html += "<ul>";
        for(const it of items) html += `<li>${it}</li>`;
        html += "</ul>";
      }else if(typeof items==="string" && items.trim()){
        html += `<p>${items}</p>`;
      }else{
        html += `<p>Brak danych.</p>`;
      }
      div.innerHTML = html;
      return div;
    }
    function emergencyCard(items){
      const list = (items && items.length)?items:[
        "Silny, narastajƒÖcy b√≥l lub zniekszta≈Çcenie stawu.",
        "Duszno≈õƒá, omdlenie, objawy udaru.",
        "GorƒÖczka + silny b√≥l/obrzƒôk stawu."
      ];
      const div = card("üö® Niezw≈Çoczna pomoc (112/SOR)", list);
      div.classList.add("emergency");
      return div;
    }
    function spacerCard(){
      const div = document.createElement("article");
      div.className="card spacer";
      div.setAttribute("aria-hidden","true");
      div.innerHTML=`<div class="card-caption"> </div><p> </p>`;
      return div;
    }
    async function getJSON(url){
      const res=await fetch(`${url}?ts=${Date.now()}`,{cache:"no-store"});
      if(!res.ok) throw new Error(`HTTP ${res.status} @ ${url}`);
      return res.json();
    }
    function sectionUrlFromId(id){
      if(!id) return "index.html";
      const isK=id.endsWith("_k"), isM=id.endsWith("_m");
      const mapK={
        oczy_k:"kobieta-glowa.html",uszy_k:"kobieta-glowa.html",nos_k:"kobieta-glowa.html",
        szczeka_k:"kobieta-glowa.html",szyja_k:"kobieta-glowa.html",glowa_k:"kobieta-glowa.html",
        serce_k:"kobieta-klatka.html",pluca_k:"kobieta-klatka.html",klatka_piersiowa_k:"kobieta-klatka.html",
        brzuch_k:"kobieta-klatka.html",plecy_k:"kobieta-klatka.html",
        uklad_krw_k:"kobieta-klatka.html",uklad_oddech_k:"kobieta-klatka.html",uklad_pokarm_k:"kobieta-klatka.html",
        biodra_k:"kobieta-nogi.html",uda_k:"kobieta-nogi.html",kolano_k:"kobieta-nogi.html",
        lydka_k:"kobieta-nogi.html",kostka_k:"kobieta-nogi.html",stopy_k:"kobieta-nogi.html",
        ciaza_k:"kobieta.html"
      };
      const mapM={
        oczy_m:"mezczyzna-glowa.html",uszy_m:"mezczyzna-glowa.html",nos_m:"mezczyzna-glowa.html",
        szczeka_m:"mezczyzna-glowa.html",szyja_m:"mezczyzna-glowa.html",glowa_m:"mezczyzna-glowa.html",
        serce_m:"mezczyzna-klatka.html",pluca_m:"mezczyzna-klatka.html",klatka_piersiowa_m:"mezczyzna-klatka.html",
        brzuch_m:"mezczyzna-klatka.html",plecy_m:"mezczyzna-klatka.html",
        uklad_krw_m:"mezczyzna-klatka.html",uklad_oddech_m:"mezczyzna-klatka.html",uklad_pokarm_m:"mezczyzna-klatka.html",
        biodra_m:"mezczyzna-nogi.html",uda_m:"mezczyzna-nogi.html",kolano_m:"mezczyzna-nogi.html",
        lydka_m:"mezczyzna-nogi.html",kostka_m:"mezczyzna-nogi.html",stopy_m:"mezczyzna-nogi.html"
      };
      if(isK) return mapK[id]||"kobieta.html";
      if(isM) return mapM[id]||"mezczyzna.html";
      return "index.html";
    }
    async function render(){
      const params=new URLSearchParams(location.search);
      const id=params.get("id");
      const content=document.getElementById("content");
      const titleEl=document.getElementById("title");
      const back=document.getElementById("sectionBack");
      if(!id||!content) return;
      if(back) back.href=sectionUrlFromId(id);

      try{
        const detailed=await getJSON("data/detailed_conditions.json");
        const base=await getJSON("data/conditions.json");
        const merged=mergeNodes(detailed[id], base[id]);
        if(!merged.title && !merged.causes?.length){
          content.innerHTML="<p>Brak danych dla tego obszaru.</p>";
          return;
        }
        if(titleEl) titleEl.textContent=merged.title;

        const tiles=[];
        if(merged.causes?.length)      tiles.push(card("üåÄ Mo≈ºliwe przyczyny", merged.causes));
        if(merged.symptoms?.length)    tiles.push(card("ü§í Objawy", merged.symptoms));
        if(merged.concerns?.length)    tiles.push(card("‚ö†Ô∏è Kiedy siƒô niepokoiƒá", merged.concerns));
        if(merged.doctors?.length)     tiles.push(card("üë®‚Äç‚öïÔ∏è Lekarze", merged.doctors));
        if(merged.medications?.length) tiles.push(card("üíä Leki", merged.medications));
        if(merged.first_aid?.length)   tiles.push(card("‚õëÔ∏è Pierwsza pomoc", merged.first_aid));
        if(merged.rehabilitation?.length) tiles.push(card("üèÉ Rehabilitacja / ƒÜwiczenia", merged.rehabilitation));
        if(merged.avoid?.length)          tiles.push(card("‚ùå Czego unikaƒá", merged.avoid));
        if(merged.prevention?.length)     tiles.push(card("‚úÖ Profilaktyka", merged.prevention));
        if(merged.mistakes?.length)       tiles.push(card("‚ö†Ô∏è Najczƒôstsze b≈Çƒôdy", merged.mistakes));

        // czerwony kafel zawsze na pozycji 4
        const em=emergencyCard(merged.emergency);
        const targetIndex=Math.min(3, tiles.length);
        tiles.splice(targetIndex,0,em);

        if(merged.description && merged.description.trim()){
          tiles.push(card("‚ÑπÔ∏è Dodatkowe informacje", merged.description));
        }

        // spacery do pe≈Çnego rzƒôdu
        const remainder=tiles.length%3;
        if(remainder!==0){
          const toAdd=3-remainder;
          for(let i=0;i<toAdd;i++) tiles.push(spacerCard());
        }

        const grid=document.createElement("section");
        grid.className="cards";
        for(const t of tiles) grid.appendChild(t);

        content.innerHTML="";
        content.appendChild(grid);
      }catch(e){
        console.error(e);
        content.innerHTML=`<p class="error">B≈ÇƒÖd wczytywania danych: ${e.message}</p>`;
      }
    }
    if(document.readyState==="loading") document.addEventListener("DOMContentLoaded",render);
    else render();
  })();
  </script>
</body>
</html>
