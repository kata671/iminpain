<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Szczeg√≥≈Çy</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Tw√≥j g≈Ç√≥wny CSS (nie zmieniamy go) -->
  <link rel="stylesheet" href="style.css" />
  <!-- Drobne style pomocnicze strony (bezpieczne) -->
  <style>
    .nav-links { margin: 10px 0; }
    .back-link { color:#6cf; text-decoration:none; margin-right:12px; }
    .card h3 { margin:0 0 8px; }
    ul { margin:0; padding-left: 18px; }
    .pill { display:inline-block; height:10px; width:80px; border-radius:20px; background:#6cf; }
    .error { color:#f99; margin-top:20px; font-size:18px; }
  </style>
</head>
<body data-page="szczegoly">

  <div class="nav-links">
    <a href="index.html" class="back-link">‚Üê Strona g≈Ç√≥wna</a>
    <a href="#" id="sectionBack" class="back-link">‚Üê Wr√≥ƒá do wyboru sekcji</a>
  </div>

  <h1 id="title">Szczeg√≥≈Çy</h1>
  <div class="pill" aria-hidden="true"></div>

  <div id="content"></div>
  <div id="err" class="error" style="display:none"></div>

  <footer style="margin-top:40px">
    <p>¬© 2025 Iminpain ‚Äî Materia≈Ç poglƒÖdowy, nie zastƒôpuje konsultacji z lekarzem.</p>
  </footer>

<script>
/* ====== 1) Routing powrotu do w≈Ça≈õciwej sekcji ====== */
function sectionUrlFromId(id) {
  if (!id) return "index.html";
  const female = id.endsWith("_k");
  const male = id.endsWith("_m");

  const groupMapK = {
    // G≈Çowa
    oczy_k:"kobieta-glowa.html", uszy_k:"kobieta-glowa.html", nos_k:"kobieta-glowa.html",
    szczeka_k:"kobieta-glowa.html", szyja_k:"kobieta-glowa.html", glowa_k:"kobieta-glowa.html",
    // Klatka/Brzuch/Plecy i uk≈Çady
    serce_k:"kobieta-klatka.html", pluca_k:"kobieta-klatka.html",
    klatka_piersiowa_k:"kobieta-klatka.html", brzuch_k:"kobieta-klatka.html", plecy_k:"kobieta-klatka.html",
    uklad_krw_k:"kobieta-klatka.html", uklad_oddech_k:"kobieta-klatka.html", uklad_pokarm_k:"kobieta-klatka.html",
    // Nogi
    biodra_k:"kobieta-nogi.html", uda_k:"kobieta-nogi.html", kolano_k:"kobieta-nogi.html",
    lydka_k:"kobieta-nogi.html", kostka_k:"kobieta-nogi.html", stopy_k:"kobieta-nogi.html",
    // Inne
    ciaza_k:"kobieta.html"
  };

  const groupMapM = {
    // G≈Çowa
    oczy_m:"mezczyzna-glowa.html", uszy_m:"mezczyzna-glowa.html", nos_m:"mezczyzna-glowa.html",
    szczeka_m:"mezczyzna-glowa.html", szyja_m:"mezczyzna-glowa.html", glowa_m:"mezczyzna-glowa.html",
    // Klatka/Brzuch/Plecy i uk≈Çady
    serce_m:"mezczyzna-klatka.html", pluca_m:"mezczyzna-klatka.html",
    klatka_piersiowa_m:"mezczyzna-klatka.html", brzuch_m:"mezczyzna-klatka.html", plecy_m:"mezczyzna-klatka.html",
    uklad_krw_m:"mezczyzna-klatka.html", uklad_oddech_m:"mezczyzna-klatka.html", uklad_pokarm_m:"mezczyzna-klatka.html",
    // Nogi
    biodra_m:"mezczyzna-nogi.html", uda_m:"mezczyzna-nogi.html", kolano_m:"mezczyzna-nogi.html",
    lydka_m:"mezczyzna-nogi.html", kostka_m:"mezczyzna-nogi.html", stopy_m:"mezczyzna-nogi.html"
  };

  if (female) return groupMapK[id] || "kobieta.html";
  if (male) return groupMapM[id] || "mezczyzna.html";
  return "index.html";
}
const params = new URLSearchParams(location.search);
const id = params.get("id");
document.getElementById("sectionBack").href = sectionUrlFromId(id);

/* ====== 2) Helpery UI ====== */
function el(tag, className, html) {
  const e = document.createElement(tag);
  if (className) e.className = className;
  if (html !== undefined) e.innerHTML = html;
  return e;
}
function card(title, items) {
  const c = el("div", "card");
  c.appendChild(el("h3", null, title));
  if (Array.isArray(items)) {
    const ul = el("ul");
    items.forEach(it => ul.appendChild(el("li", null, it)));
    c.appendChild(ul);
  } else if (typeof items === "string") {
    c.appendChild(el("p", null, items));
  }
  return c;
}

/* ====== 3) Render z JSON (data/detailed_conditions.json) ====== */
async function load() {
  const err = document.getElementById("err");
  const content = document.getElementById("content");
  const titleEl = document.getElementById("title");

  try {
    if (!id) throw new Error("Brak parametru ?id w adresie.");

    // Pobierz dane (cache-buster, aby ominƒÖƒá cache GH Pages)
    const resp = await fetch("data/detailed_conditions.json?ts=" + Date.now(), { cache: "no-store" });
    if (!resp.ok) throw new Error("Nie uda≈Ço siƒô pobraƒá danych JSON (HTTP " + resp.status + ").");
    const allData = await resp.json();

    const node = allData[id];
    if (!node) {
      titleEl.textContent = "Brak danych: " + id;
      content.innerHTML = "<p style='color:#f99'>Nie znaleziono tre≈õci dla tego obszaru.</p>";
      return;
    }

    // Tytu≈Ç
    titleEl.textContent = node.title || id;

    // Siatka kart (kolejno≈õƒá: przyczyny, objawy, obawy/pilne, lekarze, leki, pierwsza pomoc)
    const grid = document.createElement("div");
    grid.className = "cards";

    if (node.causes)      grid.appendChild(card("Mo≈ºliwe przyczyny b√≥lu", node.causes));
    if (node.symptoms)    grid.appendChild(card("Typowe objawy", node.symptoms));
    if (node.concerns)    grid.appendChild(card("‚ö†Ô∏è Obawy / pilne sygna≈Çy", node.concerns));
    if (node.doctors)     grid.appendChild(card("Do jakiego lekarza", node.doctors));
    if (node.medications) grid.appendChild(card("Leki / ≈õrodki ≈ÇagodzƒÖce", node.medications));
    if (node.first_aid)   grid.appendChild(card("Pierwsza pomoc (domowa)", node.first_aid));

    // Zawsze dok≈Çadamy awaryjny kafelek (tre≈õƒá z node.emergency albo domy≈õlna)
    const emergencyList = Array.isArray(node.emergency) ? node.emergency : [
      "Silny, narastajƒÖcy b√≥l, duszno≈õƒá, zlewne poty, omdlenie.",
      "Objawy udaru: os≈Çabienie, be≈Çkotliwa mowa, opadniƒôty kƒÖcik ust.",
      "Ostra duszno≈õƒá, sinica, krwawienie, silny uraz.",
      "W razie wƒÖtpliwo≈õci: natychmiast zadzwo≈Ñ 112."
    ];
    const em = card("Niezw≈Çoczna pomoc (112/SOR)", emergencyList);
    em.classList.add("emergency");
    grid.appendChild(em);

    // Wstaw na stronƒô
    content.innerHTML = "";
    content.appendChild(grid);

    // D≈Çugi opis (opcjonalnie)
    if (node.description) {
      const desc = document.createElement("p");
      desc.style.marginTop = "16px";
      desc.textContent = node.description;
      content.appendChild(desc);
    }

  } catch (e) {
    const errEl = document.getElementById("err");
    errEl.style.display = "block";
    errEl.textContent = "B≈ÇƒÖd wczytywania: " + e.message;
  }
}
load();
</script>

<!-- ====== 4) ULTRA-bezpieczny hotfix wyglƒÖdu i uk≈Çadu ====== -->
<script>
/*
  Ten blok NIC nie zmienia w danych.
  Tylko:
   - ustawia sta≈Çy uk≈Çad 3 kolumn (3+3),
   - przenosi/dok≈Çada czerwony kafelek na pozycjƒô 5,
   - dodaje efekty hover (bia≈Çy/czerwony glow).
*/
(function hotfixSzczegolyLayout(){
  const EMERGENCY_TITLE = "Niezw≈Çoczna pomoc (112/SOR)";
  const DEFAULT_EM_LIST = [
    "Silny, narastajƒÖcy b√≥l, duszno≈õƒá, zlewne poty, omdlenie.",
    "Objawy udaru: os≈Çabienie, be≈Çkotliwa mowa, opadniƒôty kƒÖcik ust.",
    "Ostra duszno≈õƒá, sinica, krwawienie, silny uraz.",
    "W razie wƒÖtpliwo≈õci: natychmiast zadzwo≈Ñ 112."
  ];

  function ensureHoverCSS(){
    if (document.getElementById('szczegoly-hover-css')) return;
    const s = document.createElement('style');
    s.id = 'szczegoly-hover-css';
    s.textContent = `
      body[data-page="szczegoly"] .card{
        transition: transform .15s, box-shadow .15s, background .15s;
        border-radius: 16px;
      }
      body[data-page="szczegoly"] .card:hover{
        transform: translateY(-2px);
        box-shadow: 0 10px 24px rgba(255,255,255,.12), 0 0 20px rgba(165,140,255,.25);
      }
      body[data-page="szczegoly"] .card.emergency{
        background: rgba(120, 8, 8, .22);
        border: 2px solid #ff3c3c;
        box-shadow: inset 0 0 2px rgba(255,60,60,.5), 0 6px 18px rgba(0,0,0,.35);
      }
      body[data-page="szczegoly"] .card.emergency:hover{
        box-shadow: 0 10px 28px rgba(0,0,0,.5), 0 0 28px rgba(255,40,40,.9);
      }
    `;
    document.head.appendChild(s);
  }

  function makeEmergencyCard(){
    const wrap = document.createElement('div');
    wrap.className = 'card emergency';
    const h = document.createElement('h3');
    h.textContent = EMERGENCY_TITLE;
    wrap.appendChild(h);
    const ul = document.createElement('ul');
    DEFAULT_EM_LIST.forEach(t => { const li = document.createElement('li'); li.textContent = t; ul.appendChild(li); });
    wrap.appendChild(ul);
    return wrap;
  }

  function apply(){
    ensureHoverCSS();

    const grid = document.querySelector('#content .cards');
    if (!grid) return;

    // 1) Wymu≈õ layout 3 kolumn (inline style przebija wszystko)
    grid.style.display = 'grid';
    grid.style.gridTemplateColumns = 'repeat(3, 1fr)';
    grid.style.gap = '24px';
    grid.style.justifyItems = 'center';
    grid.style.alignItems = 'start';
    grid.style.maxWidth = '1100px';
    grid.style.margin = '28px auto';
    grid.style.padding = '0 8px';

    // 2) Delikatne ‚Äûramki‚Äù je≈õli ich nie ma (bez zmiany Twojego designu, tylko minimum)
    Array.from(grid.children).forEach(c => {
      if (!(c instanceof HTMLElement)) return;
      c.classList.add('card');
      c.style.maxWidth = c.style.maxWidth || '320px';
    });

    // 3) Znajd≈∫ lub dodaj czerwony kafelek
    let emergency = Array.from(grid.children).find(c =>
      c.classList?.contains('emergency') ||
      (c.querySelector && (c.querySelector('h3')?.textContent || '').trim().toLowerCase().startsWith(EMERGENCY_TITLE.toLowerCase()))
    );
    if (!emergency) emergency = makeEmergencyCard();
    emergency.classList.add('emergency');

    // 4) Ustaw na pozycji 5 (index 4)
    const targetIndex = 4;
    if (grid.children.length <= targetIndex) {
      grid.appendChild(emergency);
    } else {
      grid.insertBefore(emergency, grid.children[targetIndex]);
    }
  }

  // Uruchom po za≈Çadowaniu tre≈õci (i kr√≥tko p√≥≈∫niej ‚Äì gdyby co≈õ do≈Çadowa≈Ço layout)
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => { apply(); setTimeout(apply, 150); });
  } else {
    apply(); setTimeout(apply, 150);
  }
})();
</script>

</body>
</html>
<script>
/* üÜò Rescue loader ‚Äî dzia≈Ça tylko, gdy nic siƒô nie wyrenderowa≈Ço */
(async function rescueLoader(){
  try {
    // je≈õli ju≈º sƒÖ kafelki, nic nie r√≥b
    if (document.querySelector('#content .cards')) return;

    const idParam = new URLSearchParams(location.search).get('id');
    if (!idParam) return;

    // spr√≥buj kilku ≈õcie≈ºek (absolute + relative)
    const sources = [
      '/data/detailed_conditions.json',
      'data/detailed_conditions.json',
      '/data/conditions.json',
      'data/conditions.json'
    ];

    let data = null, lastErr = null;
    for (const src of sources) {
      try {
        const r = await fetch(src + '?ts=' + Date.now(), { cache: 'no-store' });
        if (!r.ok) { lastErr = 'HTTP ' + r.status + ' @ ' + src; continue; }
        data = await r.json();
        if (data) break;
      } catch(e) { lastErr = e.message; }
    }
    if (!data) {
      const err = document.getElementById('err');
      if (err) { err.style.display='block'; err.textContent = 'Nie mogƒô wczytaƒá danych JSON. ' + (lastErr||''); }
      return;
    }

    const node = data[idParam];
    if (!node) {
      const err = document.getElementById('err');
      if (err) { err.style.display='block'; err.textContent = 'Brak wpisu w JSON dla id=' + idParam; }
      return;
    }

    // pomocnicze
    const content = document.getElementById('content');
    const titleEl = document.getElementById('title');
    function el(tag, cls, html){ const e=document.createElement(tag); if(cls) e.className=cls; if(html!==undefined) e.innerHTML=html; return e; }
    function card(t, items){
      const c = el('div','card'); c.appendChild(el('h3',null,t));
      if (Array.isArray(items)) { const ul = el('ul'); items.forEach(x=>ul.appendChild(el('li',null,x))); c.appendChild(ul); }
      else if (typeof items === 'string') { c.appendChild(el('p',null,items)); }
      return c;
    }

    // tytu≈Ç
    if (titleEl) titleEl.textContent = node.title || idParam;

    // siatka
    const grid = el('div','cards');
    if (node.causes)      grid.appendChild(card('Mo≈ºliwe przyczyny b√≥lu', node.causes));
    if (node.symptoms)    grid.appendChild(card('Typowe objawy', node.symptoms));
    if (node.concerns)    grid.appendChild(card('‚ö†Ô∏è Obawy / pilne sygna≈Çy', node.concerns));
    if (node.doctors)     grid.appendChild(card('Do jakiego lekarza', node.doctors));
    if (node.medications) grid.appendChild(card('Leki / ≈õrodki ≈ÇagodzƒÖce', node.medications));
    if (node.first_aid)   grid.appendChild(card('Pierwsza pomoc (domowa)', node.first_aid));

    const emergencyList = Array.isArray(node.emergency) ? node.emergency : [
      'Silny, narastajƒÖcy b√≥l, duszno≈õƒá, zlewne poty, omdlenie.',
      'Objawy udaru: os≈Çabienie, be≈Çkotliwa mowa, opadniƒôty kƒÖcik ust.',
      'Ostra duszno≈õƒá, sinica, krwawienie, silny uraz.',
      'W razie wƒÖtpliwo≈õci: natychmiast zadzwo≈Ñ 112.'
    ];
    const em = card('Niezw≈Çoczna pomoc (112/SOR)', emergencyList);
    em.classList.add('emergency');
    grid.appendChild(em);

    content.innerHTML = '';
    content.appendChild(grid);

    if (node.description) {
      const p = document.createElement('p');
      p.style.marginTop = '16px';
      p.textContent = node.description;
      content.appendChild(p);
    }

    // minimalny uk≈Çad 3 kolumn (gdyby CSS nie doszed≈Ç)
    grid.style.display='grid';
    grid.style.gridTemplateColumns='repeat(3,1fr)';
    grid.style.gap='24px';
    grid.style.maxWidth='1100px';
    grid.style.margin='28px auto';
    grid.style.justifyItems='center';
    grid.style.alignItems='start';

  } catch(e){
    const err = document.getElementById('err');
    if (err) { err.style.display='block'; err.textContent = 'Rescue loader error: ' + e.message; }
  }
})();
</script>
