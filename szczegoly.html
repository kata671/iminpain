<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title id="title">Szczeg√≥≈Çy</title>

  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="style-overrides.css?v=12">

  <style>
    /* Siatka 3 kolumny */
    body[data-page="szczegoly"] .cards{
      display:grid;
      grid-template-columns:repeat(3,minmax(320px,1fr));
      grid-auto-flow:dense;
      justify-content:center;
      gap:22px;
      max-width:1120px;
      margin:24px auto 40px;
      padding:0 12px;
    }
    @media (max-width:920px){ body[data-page="szczegoly"] .cards{ grid-template-columns:repeat(2,minmax(300px,1fr)); } }
    @media (max-width:560px){ body[data-page="szczegoly"] .cards{ grid-template-columns:1fr; } }

    body[data-page="szczegoly"] .card{ display:flex; flex-direction:column; box-sizing:border-box; min-height:340px; }
    body[data-page="szczegoly"] .card .card-caption{
      min-height:52px; display:flex; align-items:center; justify-content:center;
      text-align:center; font-weight:700; border-bottom:1px solid rgba(255,255,255,.08); padding:8px 10px;
    }
    body[data-page="szczegoly"] .card ul, body[data-page="szczegoly"] .card p{ margin:12px 12px 14px; padding:0; flex:1; overflow:auto; }
    body[data-page="szczegoly"] .card li{ list-style:disc inside; margin:6px 0; }

    /* czerwony */
    body[data-page="szczegoly"] .card.emergency{ border:2px solid #ff4d4d; background:rgba(120,20,20,.88); color:#fff; font-weight:700; }
    body[data-page="szczegoly"] .card.emergency:hover{ box-shadow:0 0 28px rgba(255,30,30,.9); }

    /* ma≈Ça nawigacja */
    .nav-links{ max-width:1120px; margin:10px auto 0; padding:0 12px; }
    .nav-links a{ color:#66c; text-decoration:none; margin-right:12px; }
  </style>
</head>
<body data-page="szczegoly">
  <div class="nav-links">
    <a href="index.html">‚Üê Strona g≈Ç√≥wna</a>
    <a id="sectionBack" href="index.html">‚Üê Wr√≥ƒá do wyboru sekcji</a>
  </div>

  <h1 id="title" style="text-align:center; margin:12px 0 6px;">Szczeg√≥≈Çy</h1>

  <main id="content" style="min-height:320px; display:flex; justify-content:center; align-items:flex-start; padding:8px;">
    <p>≈Åadowanie‚Ä¶</p>
  </main>

  <footer style="margin:40px 0; text-align:center; opacity:.8;">
    <p>¬© 2025 Iminpain ‚Äî Materia≈Ç poglƒÖdowy; nie zastƒôpuje konsultacji z lekarzem.</p>
  </footer>

  <script>
  (function () {
    function uniq(arr){ return Array.from(new Set((arr||[]).filter(Boolean))); }
    function mergeNodes(detailed, base){
      const src = detailed || {}, fall = base || {};
      const out = { title: src.title || fall.title || "Szczeg√≥≈Çy" };
      const keys = ["causes","symptoms","concerns","doctors","medications","first_aid","emergency","rehabilitation","avoid","prevention","mistakes"];
      keys.forEach(k => out[k] = uniq([...(fall[k]||[]), ...(src[k]||[])]));
      out.description = (src.description || "") || (fall.description || "");
      return out;
    }
    function card(title, items){
      const div = document.createElement("article");
      div.className = "card";
      let html = `<div class="card-caption">${title}</div>`;
      if(Array.isArray(items)){
        html += "<ul>"; for(const it of items) html += `<li>${it}</li>`; html += "</ul>";
      }else if(typeof items==="string" && items.trim()){
        html += `<p>${items}</p>`;
      }else{
        html += `<p>Brak danych.</p>`;
      }
      div.innerHTML = html;
      return div;
    }
    function emergencyCard(items){
      const list = (items && items.length)?items:[
        "Silny, narastajƒÖcy b√≥l lub zniekszta≈Çcenie stawu.",
        "Duszno≈õƒá, omdlenie, objawy udaru.",
        "GorƒÖczka + silny b√≥l/obrzƒôk stawu."
      ];
      const div = card("üö® Niezw≈Çoczna pomoc (112/SOR)", list);
      div.classList.add("emergency");
      return div;
    }
    function fillerCard(type, descriptionText){
      if(type==="tips"){
        return card("‚ÑπÔ∏è Porady og√≥lne", [
          "Odpoczywaj, ale unikaj ca≈Çkowitej bezczynno≈õci.",
          "Zimno lub ciep≈Ço miejscowo ‚Äî wed≈Çug komfortu.",
          "Delikatna mobilizacja w granicach b√≥lu."
        ]);
      }
      if(type==="prevention"){
        return card("‚úÖ Profilaktyka (og√≥lna)", [
          "Regularny, umiarkowany ruch 150 min/tydz.",
          "Wzmacnianie core i stabilizacji.",
          "Higiena snu, ergonomia dnia."
        ]);
      }
      // fallback ‚Äì u≈ºyj opisu je≈õli jest
      return card("‚ÑπÔ∏è Dodatkowe informacje", descriptionText || "Brak dodatkowych informacji.");
    }

    async function getJSON(url){
      const res=await fetch(`${url}?ts=${Date.now()}`,{cache:"no-store"});
      if(!res.ok) throw new Error(`HTTP ${res.status} @ ${url}`);
      return res.json();
    }

    function sectionUrlFromId(id){
      if(!id) return "index.html";
      const isK=id.endsWith("_k"), isM=id.endsWith("_m");
      const mapK={
        oczy_k:"kobieta-glowa.html",uszy_k:"kobieta-glowa.html",nos_k:"kobieta-glowa.html",
        szczeka_k:"kobieta-glowa.html",szyja_k:"kobieta-glowa.html",glowa_k:"kobieta-glowa.html",
        serce_k:"kobieta-klatka.html",pluca_k:"kobieta-klatka.html",klatka_piersiowa_k:"kobieta-klatka.html",
        brzuch_k:"kobieta-klatka.html",plecy_k:"kobieta-klatka.html",
        uklad_krw_k:"kobieta-klatka.html",uklad_oddech_k:"kobieta-klatka.html",uklad_pokarm_k:"kobieta-klatka.html",
        biodra_k:"kobieta-nogi.html",uda_k:"kobieta-nogi.html",kolano_k:"kobieta-nogi.html",
        lydka_k:"kobieta-nogi.html",kostka_k:"kobieta-nogi.html",stopy_k:"kobieta-nogi.html",
        ciaza_k:"kobieta.html"
      };
      const mapM={
        oczy_m:"mezczyzna-glowa.html",uszy_m:"mezczyzna-glowa.html",nos_m:"mezczyzna-glowa.html",
        szczeka_m:"mezczyzna-glowa.html",szyja_m:"mezczyzna-glowa.html",glowa_m:"mezczyzna-glowa.html",
        serce_m:"mezczyzna-klatka.html",pluca_m:"mezczyzna-klatka.html",klatka_piersiowa_m:"mezczyzna-klatka.html",
        brzuch_m:"mezczyzna-klatka.html",plecy_m:"mezczyzna-klatka.html",
        uklad_krw_m:"mezczyzna-klatka.html",uklad_oddech_m:"mezczyzna-klatka.html",uklad_pokarm_m:"mezczyzna-klatka.html",
        biodra_m:"mezczyzna-nogi.html",uda_m:"mezczyzna-nogi.html",kolano_m:"mezczyzna-nogi.html",
        lydka_m:"mezczyzna-nogi.html",kostka_m:"mezczyzna-nogi.html",stopy_m:"mezczyzna-nogi.html"
      };
      if(isK) return mapK[id]||"kobieta.html";
      if(isM) return mapM[id]||"mezczyzna.html";
      return "index.html";
    }

    async function render(){
      const params=new URLSearchParams(location.search);
      const id=params.get("id");
      const content=document.getElementById("content");
      const titleEl=document.getElementById("title");
      const back=document.getElementById("sectionBack");
      if(!id||!content) return;
      if(back) back.href=sectionUrlFromId(id);

      try{
        const detailed=await getJSON("data/detailed_conditions.json");
        const base=await getJSON("data/conditions.json");
        const merged=mergeNodes(detailed[id], base[id]);
        if(!merged.title && !merged.causes?.length){
          content.innerHTML="<p>Brak danych dla tego obszaru.</p>";
          return;
        }
        if(titleEl) titleEl.textContent=merged.title;

        const tiles=[];
        if(merged.causes?.length)      tiles.push(card("üåÄ Mo≈ºliwe przyczyny", merged.causes));
        if(merged.symptoms?.length)    tiles.push(card("ü§í Objawy", merged.symptoms));
        if(merged.concerns?.length)    tiles.push(card("‚ö†Ô∏è Kiedy siƒô niepokoiƒá", merged.concerns));
        if(merged.doctors?.length)     tiles.push(card("üë®‚Äç‚öïÔ∏è Lekarze", merged.doctors));
        if(merged.medications?.length) tiles.push(card("üíä Leki", merged.medications));
        if(merged.first_aid?.length)   tiles.push(card("‚õëÔ∏è Pierwsza pomoc", merged.first_aid));
        if(merged.rehabilitation?.length) tiles.push(card("üèÉ Rehabilitacja / ƒÜwiczenia", merged.rehabilitation));
        if(merged.avoid?.length)          tiles.push(card("‚ùå Czego unikaƒá", merged.avoid));
        if(merged.prevention?.length)     tiles.push(card("‚úÖ Profilaktyka", merged.prevention));
        if(merged.mistakes?.length)       tiles.push(card("‚ö†Ô∏è Najczƒôstsze b≈Çƒôdy", merged.mistakes));

        // czerwony kafel na pozycji 4
        const em=emergencyCard(merged.emergency);
        const targetIndex=Math.min(3, tiles.length);
        tiles.splice(targetIndex,0,em);

        // opis jako dodatkowy kafel (je≈õli jest)
        if(merged.description && merged.description.trim()){
          tiles.push(card("‚ÑπÔ∏è Dodatkowe informacje", merged.description));
        }

        // üëá ZAMIAST ‚Äûspacer√≥w‚Äù: dok≈Çadamy WIDOCZNE wype≈Çniacze,
        // ≈ºeby 2. rzƒÖd nigdy nie by≈Ç ‚Äûdziurawy‚Äù.
        const rest = tiles.length % 3;
        if(rest === 1){
          // mamy 1 kafel w ostatnim rzƒôdzie ‚Üí dodaj 2
          tiles.push(fillerCard("tips", merged.description));
          tiles.push(fillerCard("prevention"));
        } else if(rest === 2){
          // mamy 2 kafle w ostatnim rzƒôdzie ‚Üí dodaj 1
          tiles.push(fillerCard("tips", merged.description));
        }
        // teraz tiles.length to wielokrotno≈õƒá 3

        const grid=document.createElement("section");
        grid.className="cards";
        for(const t of tiles) grid.appendChild(t);

        content.innerHTML="";
        content.appendChild(grid);
      }catch(e){
        console.error(e);
        content.innerHTML=`<p class="error">B≈ÇƒÖd wczytywania danych: ${e.message}</p>`;
      }
    }

    if(document.readyState==="loading") document.addEventListener("DOMContentLoaded",render);
    else render();
  })();
  </script>

  <!-- Afterburner (zostawiamy, ale teraz i tak nie bƒôdzie pustek) -->
  <style id="force-grid-fix">
    :where(.cards){
      display:grid !important;
      grid-template-columns: repeat(3, minmax(320px, 1fr)) !important;
      grid-auto-flow:dense !important;
      justify-content: center !important;
      gap: 22px !important;
      max-width: 1120px !important;
      margin: 24px auto 40px !important;
      padding: 0 12px !important;
    }
  </style>
</body>
</html>
