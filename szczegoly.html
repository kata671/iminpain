<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Szczegóły</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css">
  <style>
    .nav-links { margin: 10px 0; }
    .back-link { color:#6cf; text-decoration:none; margin-right:12px; }

    .cards {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 24px;
      max-width: 1200px;
      margin: 28px auto;
      justify-items: center;
      align-items: start;
    }

    .card {
      width: 100%;
      max-width: 340px;
      background: rgba(34, 42, 90, .85);
      border: 2px solid #5463b5;
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 6px 16px rgba(0,0,0,.25);
    }

    .card h3 { margin:0 0 8px; }
    .error { color:#f99; margin-top:20px; font-size:18px; }
    ul { margin:0; padding-left: 18px; }
    .pill { display:inline-block; height:10px; width:80px; border-radius:20px; background:#6cf; }

    @media (max-width: 980px) {
      .cards { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 640px) {
      .cards { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body data-page="szczegoly">

<div class="nav-links">
  <a href="index.html" class="back-link">← Strona główna</a>
  <a href="#" id="sectionBack" class="back-link">← Wróć do wyboru sekcji</a>
</div>

<h1 id="title">Szczegóły</h1>
<div class="pill" aria-hidden="true"></div>

<div id="content"></div>
<div id="err" class="error" style="display:none"></div>

<footer style="margin-top:40px">
  <p>© 2025 Iminpain — Materiał poglądowy, nie zastępuje konsultacji z lekarzem.</p>
</footer>

<script>
function sectionUrlFromId(id) {
  if (!id) return "index.html";
  const female = id.endsWith("_k");
  const male = id.endsWith("_m");
  const groupMapK = {
    oczy_k: "kobieta-glowa.html",
    uszy_k: "kobieta-glowa.html",
    nos_k: "kobieta-glowa.html",
    szczeka_k: "kobieta-glowa.html",
    szyja_k: "kobieta-glowa.html",
    glowa_k: "kobieta-glowa.html",
    serce_k: "kobieta-klatka.html",
    pluca_k: "kobieta-klatka.html",
    brzuch_k: "kobieta-klatka.html",
    plecy_k: "kobieta-klatka.html",
    klatka_piersiowa_k: "kobieta-klatka.html",
    uklad_krw_k: "kobieta-klatka.html",
    uklad_oddech_k: "kobieta-klatka.html",
    uklad_pokarm_k: "kobieta-klatka.html",
    biodra_k: "kobieta-nogi.html",
    uda_k: "kobieta-nogi.html",
    kolano_k: "kobieta-nogi.html",
    lydka_k: "kobieta-nogi.html",
    kostka_k: "kobieta-nogi.html",
    stopy_k: "kobieta-nogi.html",
    ciaza_k: "kobieta.html"
  };

  const groupMapM = {
    oczy_m: "mezczyzna-glowa.html",
    uszy_m: "mezczyzna-glowa.html",
    nos_m: "mezczyzna-glowa.html",
    szczeka_m: "mezczyzna-glowa.html",
    szyja_m: "mezczyzna-glowa.html",
    glowa_m: "mezczyzna-glowa.html",
    serce_m: "mezczyzna-klatka.html",
    pluca_m: "mezczyzna-klatka.html",
    brzuch_m: "mezczyzna-klatka.html",
    plecy_m: "mezczyzna-klatka.html",
    uklad_krw_m: "mezczyzna-klatka.html",
    uklad_oddech_m: "mezczyzna-klatka.html",
    uklad_pokarm_m: "mezczyzna-klatka.html",
    biodra_m: "mezczyzna-nogi.html",
    uda_m: "mezczyzna-nogi.html",
    kolano_m: "mezczyzna-nogi.html",
    lydka_m: "mezczyzna-nogi.html",
    kostka_m: "mezczyzna-nogi.html",
    stopy_m: "mezczyzna-nogi.html"
  };

  if (female) return groupMapK[id] || "kobieta.html";
  if (male) return groupMapM[id] || "mezczyzna.html";
  return "index.html";
}

const params = new URLSearchParams(location.search);
const id = params.get("id");
document.getElementById("sectionBack").href = sectionUrlFromId(id);

function el(tag, className, html) {
  const e = document.createElement(tag);
  if (className) e.className = className;
  if (html !== undefined) e.innerHTML = html;
  return e;
}

async function load() {
  const err = document.getElementById("err");
  const content = document.getElementById("content");
  const titleEl = document.getElementById("title");

  try {
    if (!id) throw new Error("Brak parametru ?id w adresie.");

    const candidates = [
      "data/detailed_conditions.json",
      "data/conditions.json",
      "/data/detailed_conditions.json",
      "/data/conditions.json"
    ];

    let data = null, usedUrl = null;

    for (const path of candidates) {
      try {
        const res = await fetch(path + "?" + Date.now(), { cache: "no-store" });
        if (!res.ok) continue;
        data = await res.json();
        usedUrl = path;
        break;
      } catch(e) { continue; }
    }

    if (!data) throw new Error("Nie udało się pobrać pliku JSON (sprawdź folder /data).");

    const node = data[id];
    if (!node) {
      const keys = Object.keys(data);
      const suggestions = keys.filter(k => k.includes("_k")).slice(0, 15);

      const info = document.createElement("div");
      info.style.cssText = "max-width:1100px;margin:24px auto;padding:12px 16px;background:#2a223b;border:1px solid #624ea8;border-radius:12px;color:#e9e6ff";
      info.innerHTML = `
        <h2>Brak wpisu dla <code>${id}</code></h2>
        <p>Plik danych: <code>${usedUrl}</code></p>
        <p>Dostępne przykłady kluczy:</p>
        <pre>${suggestions.join(", ")}</pre>
      `;
      content.innerHTML = "";
      content.appendChild(info);
      titleEl.textContent = "Brak danych: " + id;
      return;
    }

    titleEl.textContent = node.title || id;
    content.innerHTML = '';

    const grid = document.createElement("div");
    grid.className = "cards";

    grid.appendChild(card("Możliwe przyczyny bólu", node.causes));
    grid.appendChild(card("Typowe objawy", node.symptoms));
    grid.appendChild(card("Do jakiego lekarza", node.doctors));
    grid.appendChild(card("Leki / środki łagodzące", node.medications));
    grid.appendChild(card("Pierwsza pomoc (domowa)", node.first_aid));

    if (node.emergency && node.emergency.length) {
      const em = card("Niezwłoczna pomoc (112/SOR)", node.emergency);
      em.style.borderColor = "rgba(255,100,100,.6)";
      grid.appendChild(em);
    }

    content.appendChild(grid);

    if (node.description) {
      const desc = document.createElement("p");
      desc.style.marginTop = "16px";
      desc.textContent = node.description;
      content.appendChild(desc);
    }

  } catch (e) {
    err.style.display = 'block';
    err.textContent = "Błąd wczytywania: " + e.message;
    console.error(e);
  }
}

function card(title, items) {
  const c = el("div", "card");
  c.appendChild(el("h3", null, title));
  if (Array.isArray(items)) {
    const ul = el("ul");
    items.forEach(it => ul.appendChild(el("li", null, it)));
    c.appendChild(ul);
  } else if (typeof items === 'string') {
    c.appendChild(el("p", null, items));
  }
  return c;
}

load();
</script>
</body>
</html>
