<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Boli Help — Kobieta</title>
  <meta name="theme-color" content="#0e1230" />
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="assets/style.css?v=10" />
  <style>
    /* ===== TAPETA (jak na stronie głównej) ===== */
    html,body{height:100%}
    body[data-page="kobieta"]{
      position:relative; background:#0e1230 !important; color:#eef2ff;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    body[data-page="kobieta"]::before,
    body[data-page="kobieta"]::after,
    body[data-page="kobieta"] .container::before,
    body[data-page="kobieta"] .container::after{ content:none !important; display:none !important; }

    .bh-wallpaper,.bh-grid{position:fixed; inset:0; pointer-events:none}
    .bh-wallpaper{
      z-index:0;
      background:
        radial-gradient(42vw 36vh at 16% 12%, rgba(255,110,199,.30), transparent 60%),
        radial-gradient(36vw 30vh at 84% 10%, rgba(94,234,212,.22), transparent 60%),
        radial-gradient(40vw 44vh at 20% 88%, rgba(164,107,255,.16), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,0));
      filter: blur(10px) saturate(118%);
    }
    .bh-grid{
      z-index:1; opacity:.22;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='104' viewBox='0 0 120 104'%3E%3Cg fill='none' stroke='rgba(173,216,255,0.26)' stroke-width='1'%3E%3Cpolygon points='30,0 90,0 120,52 90,104 30,104 0,52'/%3E%3C/g%3E%3C/svg%3E");
      background-size:160px 138px; background-position:center;
    }
    .bh-floor-fade{
      position:fixed; left:0; right:0; bottom:0; height:120px; z-index:2; pointer-events:none;
      background:linear-gradient(180deg, rgba(14,18,48,0), rgba(14,18,48,.35) 55%, rgba(14,18,48,.6));
    }
    .container{position:relative; z-index:3; background:transparent !important; max-width:1100px; margin:0 auto; padding:0 16px}

    /* ===== SIATKA MINIATUREK ===== */
    .grid-thumbs{display:grid;gap:16px;}
    @media (min-width:981px){ .grid-thumbs{grid-template-columns:repeat(3,1fr)} }
    @media (max-width:980px){ .grid-thumbs{grid-template-columns:repeat(2,1fr)} }
    @media (max-width:640px){ .grid-thumbs{grid-template-columns:repeat(2,1fr);gap:12px} }

    /* ===== KAFELKI ===== */
    .thumb{
      border-radius:16px; overflow:hidden; text-decoration:none; color:inherit; display:block;
      background:
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)),
        rgba(60,32,100,.32);
      border:1px solid rgba(164,107,255,.28);
      box-shadow:0 8px 18px rgba(8,10,22,.35), 0 0 0 1px rgba(164,107,255,.18) inset;
      backdrop-filter:saturate(120%) blur(6px);
      transition:transform .22s ease, box-shadow .22s ease, border-color .22s ease;
    }
    .thumb:hover{
      transform:translateY(-3px);
      box-shadow:0 16px 28px rgba(8,10,22,.45), 0 0 18px rgba(164,107,255,.30), 0 0 0 1px rgba(164,107,255,.34) inset;
      border-color:rgba(164,107,255,.45);
    }
    .thumb:focus-visible{ outline:2px solid rgba(164,107,255,.65); outline-offset:2px; border-radius:18px }

    .thumb img{
      width:100%; display:block; object-fit:contain; object-position:center;
      background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      height:140px;
    }
    @media (min-width:981px){ .thumb img{ height:150px } }
    @media (max-width:980px){ .thumb img{ height:110px } }
    @media (max-width:640px){ .thumb img{ height:84px } }

    .thumb span{
      display:block; padding:10px 12px; font-weight:800; letter-spacing:.2px; color:#eef2ff;
      border-top:1px solid rgba(164,107,255,.22);
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      text-align:center;
    }
    @media (max-width:640px){ .thumb span{ font-size:12.5px; padding:8px 10px } }

    /* ===== PRZYCISK WRÓĆ ===== */
    #bhBackMini{
      appearance:none;
      border:1px solid rgba(164,107,255,.28);
      background:rgba(60,32,100,.28);
      color:#eef2ff;
      font-weight:700;
      padding:10px 14px;
      border-radius:12px;
      cursor:pointer;
      margin:16px 0;
      box-shadow:0 6px 16px rgba(8,10,22,.35), inset 0 0 0 1px rgba(164,107,255,.12), 0 0 8px rgba(164,107,255,.45);
      transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease;
    }
    #bhBackMini:hover{
      transform:translateY(-1px);
      border-color:rgba(164,107,255,.55);
      box-shadow:0 10px 20px rgba(8,10,22,.45), 0 0 14px rgba(164,107,255,.65), inset 0 0 0 1px rgba(164,107,255,.18);
    }
    #bhBackMini:focus-visible{
      outline:2px solid rgba(164,107,255,.75);
      outline-offset:2px;
    }
  </style>
</head>
<body data-page="kobieta">
  <!-- TAPETA -->
  <div class="bh-wallpaper" aria-hidden="true"></div>
  <div class="bh-grid" aria-hidden="true"></div>
  <div class="bh-floor-fade" aria-hidden="true"></div>

  <div class="container">
    <!-- GUZIK WRÓĆ -->
    <button id="bhBackMini" type="button" aria-label="Wróć do poprzedniej strony">← Wróć</button>

    <header class="header"><h1>Kobieta — wybierz część ciała</h1></header>

    <section class="grid-thumbs" aria-label="Miniatury — kobieta">
      <a class="thumb" href="szczegoly.html?typ=kobieta&czesc=oko&label=Oko"><img src="img/kobieta-oko.png" alt="Oko"><span>Oko</span></a>
      <a class="thumb" href="szczegoly.html?typ=kobieta&czesc=nos&label=Nos"><img src="img/kobieta-nos.png" alt="Nos"><span>Nos</span></a>
      <a class="thumb" href="szczegoly.html?typ=kobieta&czesc=gardlo&label=Gard%C5%82o"><img src="img/kobieta-gardlo.png" alt="Gardło"><span>Gardło</span></a>
      <a class="thumb" href="szczegoly.html?typ=kobieta&czesc=glowa&label=G%C5%82owa"><img src="img/kobieta-glowa.png" alt="Głowa"><span>Głowa</span></a>
      <a class="thumb" href="szczegoly.html?typ=kobieta&czesc=klatka&label=Klatka%20piersiowa"><img src="img/kobieta-klatka.png" alt="Klatka piersiowa"><span>Klatka</span></a>
      <a class="thumb" href="szczegoly.html?typ=kobieta&czesc=brzuch&label=Brzuch"><img src="img/kobieta-brzuch.png" alt="Brzuch"><span>Brzuch</span></a>
      <a class="thumb" href="szczegoly.html?typ=kobieta&czesc=plecy&label=Plecy"><img src="img/kobieta-plecy.png" alt="Plecy"><span>Plecy</span></a>
      <a class="thumb" href="szczegoly.html?typ=kobieta&czesc=biodra&label=Biodra"><img src="img/kobieta-biodra.png" alt="Biodra"><span>Biodra</span></a>
      <a class="thumb" href="szczegoly.html?typ=kobieta&czesc=udo&label=Udo"><img src="img/kobieta-udo.png" alt="Udo"><span>Udo</span></a>
      <a class="thumb" href="szczegoly.html?typ=kobieta&czesc=stopy&label=Stopy"><img src="img/kobieta-stopy.png" alt="Stopy"><span>Stopy</span></a>
      <a class="thumb" href="szczegoly.html?typ=kobieta&czesc=serce&label=Serce"><img src="img/kobieta-serce.png" alt="Serce"><span>Serce</span></a>
      <a class="thumb" href="szczegoly.html?typ=kobieta&czesc=pluca&label=P%C5%82uca"><img src="img/kobieta-pluca.png" alt="Płuca"><span>Płuca</span></a>
      <a class="thumb" href="szczegoly.html?typ=kobieta&czesc=watroba&label=W%C4%85troba"><img src="img/kobieta-watroba.png" alt="Wątroba"><span>Wątroba</span></a>
      <a class="thumb" href="szczegoly.html?typ=kobieta&czesc=zoladek&label=%C5%BBo%C5%82%C4%85dek"><img src="img/kobieta-zoladek.png" alt="Żołądek"><span>Żołądek</span></a>
      <a class="thumb" href="szczegoly.html?typ=kobieta&czesc=nerki&label=Nerki"><img src="img/kobieta-nerki.png" alt="Nerki"><span>Nerki</span></a>
      <a class="thumb" href="szczegoly.html?typ=kobieta&czesc=ciaza&label=Ci%C4%85%C5%BCa"><img src="img/kobieta-ciaza.png" alt="Ciąża"><span>Ciąża</span></a>
    </section>
  </div>

  <script>
    // Obsługa guzika "Wróć"
    (function(){
      var btn = document.getElementById('bhBackMini');
      if(!btn) return;
      btn.addEventListener('click', function(){
        if (document.referrer && document.referrer.includes(location.host)) {
          history.back();
        } else {
          location.href = 'index.html';
        }
      });
    })();
  </script>
<script src="/assets/js/translator-unified.js?v=1" defer></script>
<!-- BEGIN bh-patch:translator-oneblock -->
<script>
(function(){
  if (window.__bhPatchTranslatorOneBlock__) return;
  window.__bhPatchTranslatorOneBlock__ = 1;

  // ====== STYLE (wstrzykiwany, zero dodatkowych plików) ======
  (function injectStyle(){
    var css = `
:root {
  --bh-accent:#6c5ce7; --bh-bg:rgba(255,255,255,0.75);
  --bh-shadow:0 8px 20px rgba(0,0,0,0.12);
  --bh-radius:16px; --bh-blur:saturate(1.2) blur(6px);
  --bh-z:9999; --bh-font:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,"Noto Sans","Liberation Sans","Helvetica Neue",sans-serif;
}
.bh-translator-wrap{position:fixed;top:12px;right:12px;z-index:var(--bh-z);font-family:var(--bh-font)}
.bh-translator-btn{display:flex;align-items:center;gap:10px;padding:10px 14px;background:var(--bh-bg);backdrop-filter:var(--bh-blur);border:1px solid rgba(108,92,231,.25);border-radius:var(--bh-radius);box-shadow:var(--bh-shadow);cursor:pointer;color:#1f2937;user-select:none;-webkit-tap-highlight-color:transparent;transition:transform .12s ease,background .2s ease,border-color .2s ease}
.bh-translator-btn:hover{transform:translateY(-1px)}
.bh-translator-btn:active{transform:translateY(0)}
.bh-translator-btn .bh-icn{width:18px;height:18px;flex:0 0 auto;color:var(--bh-accent)}
.bh-translator-label{font-size:14px;line-height:1;font-weight:600}
.bh-translator-dd{position:absolute;right:0;margin-top:8px;background:var(--bh-bg);backdrop-filter:var(--bh-blur);border:1px solid rgba(108,92,231,.25);border-radius:14px;box-shadow:var(--bh-shadow);min-width:200px;padding:8px;display:none}
.bh-translator-wrap[aria-expanded="true"] .bh-translator-dd{display:block}
.bh-dd-item{display:flex;align-items:center;justify-content:space-between;width:100%;padding:10px 12px;border-radius:10px;background:transparent;border:0;cursor:pointer;color:#111827;font-size:14px;font-weight:600}
.bh-dd-item:hover{background:rgba(108,92,231,.08)}
.bh-dd-item small{color:#6b7280;font-weight:500}
@media(max-width:480px){.bh-translator-btn{padding:8px 12px;gap:8px}.bh-translator-label{font-size:13px}.bh-translator-dd{min-width:180px}}
[data-bh-no-translate]{}
    `;
    var s = document.createElement('style');
    s.setAttribute('data-bh-style','translator');
    s.appendChild(document.createTextNode(css));
    document.head.appendChild(s);
  })();

  // ====== USTAWIENIA ======
  var STORE_KEY='bh-lang';
  var SUPPORTED=[{code:'pl',label:'Polski'},{code:'en',label:'English'},{code:'de',label:'Deutsch'},{code:'uk',label:'Українська'}];
  var EMBED={
    en:{"Szukaj":"Search","Telefon alarmowy":"Emergency phone","Pierwsza pomoc":"First Aid","Apteka":"Pharmacy","Szpital":"Hospital","Objawy":"Symptoms","Przyczyny":"Causes","Leki":"Medications","Na receptę":"Prescription","Bez recepty":"Over-the-counter","Kiedy się niepokoić":"When to worry","Czerwone flagi":"Red flags"},
    de:{"Szukaj":"Suche","Telefon alarmowy":"Notruf","Pierwsza pomoc":"Erste Hilfe","Apteka":"Apotheke","Szpital":"Krankenhaus","Objawy":"Symptome","Przyczyny":"Ursachen","Leki":"Medikamente","Na receptę":"Verschreibungspflichtig","Bez recepty":"Rezeptfrei","Kiedy się niepokoić":"Wann man sich sorgen sollte","Czerwone flagi":"Rote Flaggen"},
    uk:{"Szukaj":"Пошук","Telefon alarmowy":"Екстрений номер","Pierwsza pomoc":"Перша допомога","Apteka":"Аптека","Szpital":"Лікарня","Objawy":"Симптоми","Przyczyny":"Причини","Leki":"Ліки","Na receptę":"За рецептом","Bez recepty":"Без рецепту","Kiedy się niepokoić":"Коли варто хвилюватись","Czerwone flagi":"Тривожні ознаки"}
  };
  var saved=localStorage.getItem(STORE_KEY);
  var browser=(navigator.language||'pl').slice(0,2).toLowerCase();
  var DEFAULT='pl';
  var initial=(saved && SUPPORTED.some(l=>l.code===saved))?saved:(SUPPORTED.some(l=>l.code===browser)?browser:DEFAULT);
  var active=DEFAULT, dict={};

  // ====== UI ======
  function createUI(){
    if (document.getElementById('bh-translator')) return;
    var wrap=document.createElement('div');
    wrap.className='bh-translator-wrap'; wrap.id='bh-translator';
    wrap.setAttribute('aria-expanded','false');

    var btn=document.createElement('button');
    btn.type='button'; btn.className='bh-translator-btn'; btn.setAttribute('aria-label','Language switcher');
    btn.innerHTML = `
      <svg class="bh-icn" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M12 21c4.97 0 9-4.03 9-9s-4.03-9-9-9-9 4.03-9 9 4.03 9 9 9Z" stroke="currentColor" stroke-width="1.6"></path>
        <path d="M3 12h18M12 3c3 3.5 3 14 0 18M6 6c3.5 2 8.5 2 12 0M6 18c3.5-2 8.5-2 12 0" stroke="currentColor" stroke-width="1.2"></path>
      </svg>
      <span class="bh-translator-label" data-bh-no-translate>Lang: ${(initial||'pl').toUpperCase()}</span>
    `;

    var dd=document.createElement('div');
    dd.className='bh-translator-dd'; dd.setAttribute('role','menu');
    SUPPORTED.forEach(function(item){
      var el=document.createElement('button');
      el.type='button'; el.className='bh-dd-item'; el.setAttribute('data-lang',item.code);
      el.innerHTML=`<span>${item.label}</span><small>${item.code.toUpperCase()}</small>`;
      dd.appendChild(el);
    });

    wrap.appendChild(btn); wrap.appendChild(dd); document.body.appendChild(wrap);

    btn.addEventListener('click', function(){
      wrap.setAttribute('aria-expanded', wrap.getAttribute('aria-expanded')==='true'?'false':'true');
    });
    document.addEventListener('click', function(e){ if (!wrap.contains(e.target)) wrap.setAttribute('aria-expanded','false'); });
    dd.addEventListener('click', function(e){
      var b=e.target.closest('.bh-dd-item'); if(!b) return;
      var lang=b.getAttribute('data-lang'); wrap.setAttribute('aria-expanded','false'); setLanguage(lang);
    });
  }

  // ====== ŁADOWANIE SŁOWNIKA ======
  function loadDict(lang){
    return new Promise(function(resolve){
      if (lang==='pl') return resolve({});
      // próbuj assets/i18n/{lang}.json; jeśli brak – wbudowany
      fetch('assets/i18n/'+lang+'.json', {cache:'no-store'})
        .then(function(r){ if(!r.ok) throw 0; return r.json(); })
        .then(function(json){ resolve(Object.assign({}, EMBED[lang]||{}, json)); })
        .catch(function(){ resolve(Object.assign({}, EMBED[lang]||{})); });
    });
  }

  // ====== TŁUMACZENIE ======
  function norm(t){ return (t||'').replace(/\s+/g,' ').trim(); }
  function translateNodeText(node){
    var original=norm(node.textContent||''); if(!original) return;
    var t=dict[original]; if (t && t!==original) node.textContent=t;
  }
  function walkAndTranslate(container){
    var SKIP=function(el){ return el.closest('[data-bh-no-translate]') || el.closest('#bh-translator'); };
    // data-i18n (dokładne klucze)
    container.querySelectorAll ? container.querySelectorAll('[data-i18n]').forEach(function(el){
      if (SKIP(el)) return; var key=el.getAttribute('data-i18n'); var t=dict[key]; if (t) el.textContent=t;
    }) : null;
    // atrybuty
    container.querySelectorAll ? container.querySelectorAll('[data-i18n-attr]').forEach(function(el){
      if (SKIP(el)) return;
      var map=(el.getAttribute('data-i18n-attr')||'').split(',').map(function(s){return s.trim();});
      map.forEach(function(pair){
        var sp=pair.split('|'); var attr=(sp[0]||'').trim(); var key=(sp[1]||'').trim();
        if(!attr||!key) return; var t=dict[key]; if(t) el.setAttribute(attr,t);
      });
    }) : null;
    // proste elementy tekstowe
    var cand=container.querySelectorAll ? container.querySelectorAll('h1,h2,h3,h4,h5,h6,p,li,button,a,th,td,span,label,small,strong,em') : [];
    cand.forEach(function(el){
      if (SKIP(el)) return;
      if (el.childElementCount===0) translateNodeText(el);
    });
  }

  var moInstalled=false;
  function installObserver(){
    if (moInstalled) return; moInstalled=true;
    var mo=new MutationObserver(function(muts){
      if (active==='pl') return;
      muts.forEach(function(m){
        if (m.type==='childList'){
          m.addedNodes.forEach(function(n){ if(n.nodeType===1) walkAndTranslate(n); });
        } else if (m.type==='attributes' && m.target && m.target.matches && m.target.matches('[data-i18n-attr]')){
          walkAndTranslate(m.target);
        }
      });
    });
    mo.observe(document.documentElement,{childList:true,subtree:true,attributes:true,attributeFilter:['placeholder','title','aria-label']});
  }

  function setLanguage(lang){
    if (!SUPPORTED.some(function(l){return l.code===lang;})) return;
    active=lang; localStorage.setItem(STORE_KEY, lang);
    var label=document.querySelector('#bh-translator .bh-translator-label');
    if (label) label.textContent='Lang: '+lang.toUpperCase();

    if (lang==='pl'){ location.reload(); return; }
    loadDict(lang).then(function(d){ dict=d; walkAndTranslate(document); installObserver(); });
  }

  // ====== START ======
  function init(){
    createUI();
    // jeśli użytkownik miał wybrany język – zastosuj
    if (initial!=='pl'){ setLanguage(initial); }
  }
  if (document.readyState==='loading'){ document.addEventListener('DOMContentLoaded', init); }
  else { init(); }
})();
</script>
<!-- END bh-patch:translator-oneblock -->
<!-- BEGIN bh-patch:translator-hotfix -->
<script>
(function(){
  if (window.__bhPatchTranslatorHotfix__) return;
  window.__bhPatchTranslatorHotfix__ = 1;

  // ===== A) Anty-Google-Translate (baner/ramka/auto) =====
  (function neutralizeGoogleTranslate(){
    // 1) Meta "notranslate" – blokuje podpowiedzi i auto-tłumaczenie
    var hasMeta = document.querySelector('meta[name="google"][content*="notranslate"]');
    if (!hasMeta) {
      var m = document.createElement('meta');
      m.setAttribute('name','google'); m.setAttribute('content','notranslate');
      document.head.appendChild(m);
    }

    // 2) CSS: ukryj UI Google Translate (baner/tooltipy), nawet jeśli już się wstrzyknął
    var css = `
.goog-te-banner-frame, .goog-te-gadget, .goog-tooltip, .goog-te-balloon-frame, #google_translate_element,
.VIpgJd-ZVi9od-ORHb, .VIpgJd-ZVi9od-l4eHX-hSRGPd, .VIpgJd-ZVi9od-ORHb-OEVmcd { display:none !important; visibility:hidden !important; }
body { top: 0 !important; }
`;
    var s = document.createElement('style');
    s.setAttribute('data-bh-style','anti-google-translate');
    s.appendChild(document.createTextNode(css));
    document.head.appendChild(s);

    // 3) Usuń już wstrzyknięte elementy/klasy
    function purgeGT(){
      ['iframe.goog-te-banner-frame','#google_translate_element','.VIpgJd-ZVi9od-ORHb','.goog-te-gadget'].forEach(function(sel){
        document.querySelectorAll(sel).forEach(function(n){ try{ n.remove(); }catch(_){ n.style.display='none'; } });
      });
      document.documentElement.classList.remove('translated-ltr','translated-rtl');
      document.body.style.top = null;
      // Wyzeruj stan google translate jeśli istniał
      try { localStorage.removeItem('googtrans'); } catch(_){}
      try { sessionStorage.removeItem('googtrans'); } catch(_){}
      // Zneutralizuj globalny init jeśli snippet google był dodany
      window.googleTranslateElementInit = function(){};
      // Zablokuj ewentualne przyszłe ładowanie element.js
      var _createElement = document.createElement;
      document.createElement = function(tag){
        var el = _createElement.call(document, tag);
        if (tag.toLowerCase()==='script') {
          var _setAttr = el.setAttribute;
          el.setAttribute = function(name, value){
            if (name==='src' && /translate_a\/element\.js/i.test(String(value||''))) {
              // zignoruj ładowanie skryptu google translate
              return;
            }
            return _setAttr.apply(el, arguments);
          };
        }
        return el;
      };
    }
    purgeGT();
    // Dodatkowo próbuj czyścić, jeśli coś doładuje się dynamicznie
    var mo = new MutationObserver(function(){ purgeGT(); });
    mo.observe(document.documentElement, { childList:true, subtree:true });
  })();

  // ===== B) Wzmocnienie naszego tłumacza (natychmiast po wyborze) =====
  (function reinforceBHTranslator(){
    // Jeżeli masz w projekcie poprzedni blok "translator-oneblock" / "bh-translator.js",
    // poniższy kod zadba o natychmiastowe tłumaczenie i poprawne nasłuchiwanie kliknięć.

    // 1) Gdy istnieje dropdown naszego tłumacza – dodaj także pointerup (mobile), plus focusem.
    function bindFastActions(){
      var dd = document.querySelector('#bh-translator .bh-translator-dd');
      var wrap = document.getElementById('bh-translator');
      if (!dd || !wrap) return;

      function onPick(e){
        var b = e.target.closest('.bh-dd-item'); if(!b) return;
        var lang = b.getAttribute('data-lang');
        wrap.setAttribute('aria-expanded','false');
        // Jeśli mamy globalny setLanguage z naszego widgetu – użyj.
        if (typeof window.setLanguage === 'function') {
          try { window.setLanguage(lang); } catch(_){}
          return;
        }
        // Jeśli nie – spróbuj odpalić standardową ścieżkę poprzedniego bloku.
        try {
          // Wersje wcześniejsze miały setLanguage w IIFE – nie w globalu,
          // więc wymusimy ponowne tłumaczenie przez zapis języka i reload jeśli PL
          localStorage.setItem('bh-lang', lang);
          if (lang === 'pl') { location.reload(); return; }
          // Spróbuj wywołać ponowny skan (fallback bardzo defensywny)
          setTimeout(function(){
            var ev = new Event('bh-translate-rescan'); document.dispatchEvent(ev);
          }, 0);
        } catch(_){}
      }

      ['click','pointerup','keyup'].forEach(function(type){
        dd.addEventListener(type, function(e){
          if (type==='keyup' && e.key !== 'Enter') return;
          onPick(e);
        }, { passive:true });
      });
    }

    // 2) Uniwersalny "rescan" – podłącz do naszego wcześniejszego kodu jeśli słucha zdarzeń
    document.addEventListener('bh-translate-rescan', function(){
      try {
        // Jeśli w poprzednim bloku jest funkcja walkAndTranslate dostępna przez closure – nie mamy do niej dostępu,
        // ale jeśli aktywny jest MutationObserver, wystarczy prowokacja minimalnej mutacji:
        var mark = document.createElement('span');
        mark.setAttribute('data-bh-no-translate','');
        document.body.appendChild(mark);
        requestAnimationFrame(function(){ mark.remove(); });
      } catch(_){}
    });

    // 3) Jeżeli UI tłumacza jeszcze nie istnieje (np. tylko "oneblock" z innej strony go doda),
    // poczekaj na DOM i podłącz zdarzenia.
    function whenReady(){
      bindFastActions();
      // Gwarantujemy, że label się odświeży przy wejściu między stronami
      var saved = localStorage.getItem('bh-lang');
      var label = document.querySelector('#bh-translator .bh-translator-label');
      if (label && saved) label.textContent = 'Lang: ' + saved.toUpperCase();
    }
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', whenReady);
    } else {
      whenReady();
    }
  })();
})();
</script>
<!-- END bh-patch:translator-hotfix -->
<!-- BEGIN bh-patch:translator-fix-v2 -->
<script>
(function(){
  if (window.__bhPatchTranslatorFixV2__) return;
  window.__bhPatchTranslatorFixV2__ = 1;

  // ========== USTAWIENIA ==========
  var BH_STORE_KEY = 'bh-lang';
  var BH_SUPPORTED = [
    { code: 'pl', label: 'Polski' },
    { code: 'en', label: 'English' },
    { code: 'de', label: 'Deutsch' },
    { code: 'uk', label: 'Українська' }
  ];

  // Minimalne słowniki wbudowane (możesz rozbudować później plikami assets/i18n/*.json)
  var BH_EMBED = {
    en: {
      "szukaj":"Search","telefon alarmowy":"Emergency phone","pierwsza pomoc":"First Aid","apteka":"Pharmacy","szpital":"Hospital",
      "objawy":"Symptoms","przyczyny":"Causes","leki":"Medications","na receptę":"Prescription","bez recepty":"Over-the-counter",
      "kiedy się niepokoić":"When to worry","czerwone flagi":"Red flags","lekarz":"Doctor","kontakt":"Contact","informacje":"Information"
    },
    de: {
      "szukaj":"Suche","telefon alarmowy":"Notruf","pierwsza pomoc":"Erste Hilfe","apteka":"Apotheke","szpital":"Krankenhaus",
      "objawy":"Symptome","przyczyny":"Ursachen","leki":"Medikamente","na receptę":"Verschreibungspflichtig","bez recepty":"Rezeptfrei",
      "kiedy się niepokoić":"Wann Sorgen machen","czerwone flagi":"Rote Flaggen","lekarz":"Arzt","kontakt":"Kontakt","informacje":"Informationen"
    },
    uk: {
      "szukaj":"Пошук","telefon alarmowy":"Екстрений номер","pierwsza pomoc":"Перша допомога","apteka":"Аптека","szpital":"Лікарня",
      "objawy":"Симптоми","przyczyny":"Причини","leki":"Ліки","na receptę":"За рецептом","bez recepty":"Без рецепту",
      "kiedy się niepokoić":"Коли варто хвилюватися","czerwone flagi":"Тривожні ознаки","lekarz":"Лікар","kontakt":"Контакт","informacje":"Інформація"
    }
  };

  var BH_DEFAULT = 'pl';
  var savedLang = localStorage.getItem(BH_STORE_KEY);
  var browserLang = (navigator.language||'pl').slice(0,2).toLowerCase();
  var BH_INITIAL = (savedLang && BH_SUPPORTED.some(l=>l.code===savedLang)) ? savedLang :
                   (BH_SUPPORTED.some(l=>l.code===browserLang) ? browserLang : BH_DEFAULT);

  // ========== POMOCNICZE ==========
  function bhNorm(str){
    return String(str||'').toLowerCase()
      .replace(/\s+/g,' ')
      .replace(/[.,;:!?()[\]{}"„”‚’'`/\\|<>~^%€$#@*+=\-–—]/g,'')
      .trim();
  }
  function bhTextOnly(el){
    // tłumaczymy tylko proste treści (bez HTML dzieci), aby nie niszczyć złożonych bloków
    return el && el.childElementCount === 0;
  }

  // ========== ZAŁĄCZENIE / UTWORZENIE UI (jeśli brak) ==========
  function ensureUI(){
    if (document.getElementById('bh-translator')) return;
    // Lekki styl (jeśli poprzedni blok go nie wstrzyknął)
    if (!document.querySelector('style[data-bh-style="translator-core"]')){
      var css = `
:root{--bh-accent:#6c5ce7;--bh-bg:rgba(255,255,255,.75);--bh-shadow:0 8px 20px rgba(0,0,0,.12);--bh-radius:16px;--bh-blur:saturate(1.2) blur(6px);--bh-z:9999;--bh-font:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,"Noto Sans","Liberation Sans","Helvetica Neue",sans-serif}
.bh-translator-wrap{position:fixed;top:12px;right:12px;z-index:var(--bh-z);font-family:var(--bh-font)}
.bh-translator-btn{display:flex;align-items:center;gap:10px;padding:10px 14px;background:var(--bh-bg);backdrop-filter:var(--bh-blur);border:1px solid rgba(108,92,231,.25);border-radius:var(--bh-radius);box-shadow:var(--bh-shadow);cursor:pointer;color:#1f2937;user-select:none;-webkit-tap-highlight-color:transparent;transition:transform .12s ease,background .2s ease,border-color .2s ease}
.bh-translator-btn:hover{transform:translateY(-1px)}.bh-translator-btn:active{transform:translateY(0)}
.bh-translator-btn .bh-icn{width:18px;height:18px;flex:0 0 auto;color:var(--bh-accent)}
.bh-translator-label{font-size:14px;line-height:1;font-weight:600}
.bh-translator-dd{position:absolute;right:0;margin-top:8px;background:var(--bh-bg);backdrop-filter:var(--bh-blur);border:1px solid rgba(108,92,231,.25);border-radius:14px;box-shadow:var(--bh-shadow);min-width:200px;padding:8px;display:none}
.bh-translator-wrap[aria-expanded="true"] .bh-translator-dd{display:block}
.bh-dd-item{display:flex;align-items:center;justify-content:space-between;width:100%;padding:10px 12px;border-radius:10px;background:transparent;border:0;cursor:pointer;color:#111827;font-size:14px;font-weight:600}
.bh-dd-item:hover{background:rgba(108,92,231,.08)}.bh-dd-item small{color:#6b7280;font-weight:500}
@media(max-width:480px){.bh-translator-btn{padding:8px 12px;gap:8px}.bh-translator-label{font-size:13px}.bh-translator-dd{min-width:180px}}
      `;
      var st = document.createElement('style');
      st.setAttribute('data-bh-style','translator-core');
      st.appendChild(document.createTextNode(css));
      document.head.appendChild(st);
    }

    var wrap=document.createElement('div'); wrap.id='bh-translator'; wrap.className='bh-translator-wrap'; wrap.setAttribute('aria-expanded','false');
    var btn=document.createElement('button'); btn.type='button'; btn.className='bh-translator-btn'; btn.setAttribute('aria-label','Language switcher');
    btn.innerHTML = `
      <svg class="bh-icn" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M12 21c4.97 0 9-4.03 9-9s-4.03-9-9-9-9 4.03-9 9 4.03 9 9 9Z" stroke="currentColor" stroke-width="1.6"></path>
        <path d="M3 12h18M12 3c3 3.5 3 14 0 18M6 6c3.5 2 8.5 2 12 0M6 18c3.5-2 8.5-2 12 0" stroke="currentColor" stroke-width="1.2"></path>
      </svg>
      <span class="bh-translator-label" data-bh-no-translate>Lang: ${(BH_INITIAL||'pl').toUpperCase()}</span>
    `;
    var dd=document.createElement('div'); dd.className='bh-translator-dd'; dd.setAttribute('role','menu');
    BH_SUPPORTED.forEach(function(l){
      var b=document.createElement('button'); b.type='button'; b.className='bh-dd-item'; b.setAttribute('data-lang',l.code);
      b.innerHTML = `<span>${l.label}</span><small>${l.code.toUpperCase()}</small>`;
      dd.appendChild(b);
    });
    wrap.appendChild(btn); wrap.appendChild(dd); document.body.appendChild(wrap);

    btn.addEventListener('click', function(){
      wrap.setAttribute('aria-expanded', wrap.getAttribute('aria-expanded')==='true'?'false':'true');
    });
    document.addEventListener('click', function(e){ if (!wrap.contains(e.target)) wrap.setAttribute('aria-expanded','false'); });

    // Delegacja na elementy listy (klik, pointer, Enter)
    dd.addEventListener('click', bhPickLang, {passive:true});
    dd.addEventListener('pointerup', bhPickLang, {passive:true});
    dd.addEventListener('keyup', function(e){ if(e.key==='Enter') bhPickLang(e); }, {passive:true});
    function bhPickLang(e){
      var b=e.target.closest('.bh-dd-item'); if(!b) return;
      wrap.setAttribute('aria-expanded','false');
      var code=b.getAttribute('data-lang'); if (!code) return;
      window.bhSetLanguage(code); // globalny, natychmiastowy
    }
  }

  // ========== ZAŁADOWANIE SŁOWNIKA (z pliku + wbudowany) ==========
  function bhLoadDict(lang){
    return new Promise(function(resolve){
      if (lang==='pl') return resolve({});
      fetch('assets/i18n/'+lang+'.json',{cache:'no-store'}).then(function(r){
        if (!r.ok) throw 0; return r.json();
      }).then(function(json){
        // scal: wbudowany (lowercase keys) + plik (preferuj plik)
        var base = BH_EMBED[lang]||{};
        var lcBase = {}; Object.keys(base).forEach(function(k){ lcBase[bhNorm(k)] = base[k]; });
        var lcFile = {}; Object.keys(json||{}).forEach(function(k){ lcFile[bhNorm(k)] = json[k]; });
        resolve(Object.assign({}, lcBase, lcFile));
      }).catch(function(){
        var base = BH_EMBED[lang]||{};
        var lc = {}; Object.keys(base).forEach(function(k){ lc[bhNorm(k)] = base[k]; });
        resolve(lc);
      });
    });
  }

  // ========== TŁUMACZENIE ==========
  var bhActive = BH_DEFAULT;
  var bhDict = {};

  function bhTranslateTree(root){
    // 1) Dokładne klucze: data-i18n
    root.querySelectorAll && root.querySelectorAll('[data-i18n]').forEach(function(el){
      if (el.closest('#bh-translator')) return;
      var key = el.getAttribute('data-i18n');
      var t = bhDict[bhNorm(key)];
      if (t) el.textContent = t;
    });

    // 2) Atrybuty
    root.querySelectorAll && root.querySelectorAll('[data-i18n-attr]').forEach(function(el){
      if (el.closest('#bh-translator')) return;
      (el.getAttribute('data-i18n-attr')||'').split(',').map(function(s){return s.trim();}).forEach(function(pair){
        var sp = pair.split('|'); var attr=(sp[0]||'').trim(); var key=(sp[1]||'').trim();
        if(!attr || !key) return;
        var t = bhDict[bhNorm(key)];
        if (t) el.setAttribute(attr, t);
      });
    });

    // 3) Proste elementy tekstowe (bez dzieci) – ostrożnie, aby nie mieszać zdań
    var candidates = root.querySelectorAll ? root.querySelectorAll('h1,h2,h3,h4,h5,h6,p,li,button,a,th,td,span,label,small,strong,em,figcaption,legend,summary,dd,dt,caption') : [];
    candidates.forEach(function(el){
      if (el.closest('#bh-translator')) return;
      if (!bhTextOnly(el)) return;
      var k = bhNorm(el.textContent);
      if (!k) return;
      var t = bhDict[k];
      if (t && t !== el.textContent) el.textContent = t;
    });
  }

  var bhObserverInstalled = false;
  function bhInstallObserver(){
    if (bhObserverInstalled) return;
    bhObserverInstalled = true;
    var mo = new MutationObserver(function(muts){
      if (bhActive==='pl') return;
      muts.forEach(function(m){
        if (m.type==='childList'){
          m.addedNodes.forEach(function(n){ if (n.nodeType===1) bhTranslateTree(n); });
        }
      });
    });
    mo.observe(document.documentElement, { childList:true, subtree:true });
  }

  // ========== API GLOBALNE ==========
  window.bhSetLanguage = function(lang){
    if (!BH_SUPPORTED.some(function(l){return l.code===lang;})) return;
    bhActive = lang;
    localStorage.setItem(BH_STORE_KEY, lang);
    var label = document.querySelector('#bh-translator .bh-translator-label');
    if (label) label.textContent = 'Lang: ' + lang.toUpperCase();

    if (lang === 'pl'){
      // powrót do oryginalnego PL – najpewniej przez reload (bez banerów, bo już zablokowane)
      location.reload();
      return;
    }
    // Załaduj słownik i przetłumacz cały dokument
    bhLoadDict(lang).then(function(dict){
      bhDict = dict || {};
      bhTranslateTree(document);
      bhInstallObserver();
    });
  };

  // ========== START ==========
  function bhInit(){
    ensureUI(); // jeśli już jest – tylko podłączy zdarzenia
    // Jeśli wcześniej zapisano język, zastosuj bez klikania
    if (BH_INITIAL !== 'pl') {
      window.bhSetLanguage(BH_INITIAL);
    } else {
      // zsynchronizuj label, gdy ktoś wcześniej zmienił
      var saved = localStorage.getItem(BH_STORE_KEY);
      var lbl = document.querySelector('#bh-translator .bh-translator-label');
      if (lbl && saved) lbl.textContent = 'Lang: ' + saved.toUpperCase();
    }
  }
  if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', bhInit); else bhInit();

  // ========== DODATKOWO: brak tooltipów/bannerów (gdyby przeglądarka coś próbowała) ==========
  (function hardenNoGoogle(){
    var meta = document.querySelector('meta[name="google"][content*="notranslate"]');
    if (!meta) {
      var m = document.createElement('meta'); m.name='google'; m.content='notranslate'; document.head.appendChild(m);
    }
    var s = document.createElement('style'); s.setAttribute('data-bh-style','anti-google-translate'); s.textContent = `
.goog-te-banner-frame,.goog-te-gadget,.goog-tooltip,.goog-te-balloon-frame,#google_translate_element,
.VIpgJd-ZVi9od-ORHb,.VIpgJd-ZVi9od-l4eHX-hSRGPd,.VIpgJd-ZVi9od-ORHb-OEVmcd{display:none !important;visibility:hidden !important}
body{top:0 !important}
`; document.head.appendChild(s);
    try { localStorage.removeItem('googtrans'); sessionStorage.removeItem('googtrans'); } catch(_){}
    window.googleTranslateElementInit = function(){};
  })();

})();
</script>
<!-- END bh-patch:translator-fix-v2 -->
<!-- BEGIN bh-patch:translator-fix-v3 -->
<script>
(function(){
  if (window.__bhPatchTranslatorFixV3__) return;
  window.__bhPatchTranslatorFixV3__ = 1;

  // ===== Założenia krótkie =====
  // 1) Tekst bazowy strony jest po polsku (PL).
  // 2) Ten silnik tłumaczy węzły TEKSTOWE (TreeWalker) – także wewnątrz złożonych elementów.
  // 3) Słowniki frazowe (n-gramy) + słownik słów. Możesz rozszerzać assets/i18n/{lang}.json.
  // 4) Nie dotykamy elementów oznaczonych [data-bh-no-translate] ani #bh-translator.

  // ===== Konfiguracja =====
  var BH_STORE_KEY = 'bh-lang';
  var BH_DEFAULT   = 'pl';
  var BH_SUPPORTED = [
    { code:'pl', label:'Polski' },
    { code:'en', label:'English' },
    { code:'de', label:'Deutsch' },
    { code:'uk', label:'Українська' }
  ];
  var savedLang   = localStorage.getItem(BH_STORE_KEY);
  var browserLang = (navigator.language||'pl').slice(0,2).toLowerCase();
  var BH_INITIAL  = (savedLang && BH_SUPPORTED.some(l=>l.code===savedLang)) ? savedLang :
                    (BH_SUPPORTED.some(l=>l.code===browserLang) ? browserLang : BH_DEFAULT);

  // ===== Anti Google Translate (baner itp.) =====
  (function(){
    if (!document.querySelector('meta[name="google"][content*="notranslate"]')) {
      var m=document.createElement('meta'); m.name='google'; m.content='notranslate'; document.head.appendChild(m);
    }
    var s=document.createElement('style');
    s.setAttribute('data-bh-style','anti-google-translate');
    s.textContent = '.goog-te-banner-frame,.goog-te-gadget,.goog-tooltip,.goog-te-balloon-frame,#google_translate_element,.VIpgJd-ZVi9od-ORHb,.VIpgJd-ZVi9od-l4eHX-hSRGPd,.VIpgJd-ZVi9od-ORHb-OEVmcd{display:none!important;visibility:hidden!important}body{top:0!important}';
    document.head.appendChild(s);
    try { localStorage.removeItem('googtrans'); sessionStorage.removeItem('googtrans'); } catch(_){}
    window.googleTranslateElementInit = function(){};
  })();

  // ===== Mini UI (jeśli wcześniejszy UI nie istnieje) =====
  function ensureUI(){
    if (document.getElementById('bh-translator')) return;
    var st=document.createElement('style'); st.setAttribute('data-bh-style','translator-core'); st.textContent = `
:root{--bh-accent:#6c5ce7;--bh-bg:rgba(255,255,255,.75);--bh-shadow:0 8px 20px rgba(0,0,0,.12);--bh-radius:16px;--bh-blur:saturate(1.2) blur(6px);--bh-z:9999;--bh-font:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,"Noto Sans","Liberation Sans","Helvetica Neue",sans-serif}
.bh-translator-wrap{position:fixed;top:12px;right:12px;z-index:var(--bh-z);font-family:var(--bh-font)}
.bh-translator-btn{display:flex;align-items:center;gap:10px;padding:10px 14px;background:var(--bh-bg);backdrop-filter:var(--bh-blur);border:1px solid rgba(108,92,231,.25);border-radius:var(--bh-radius);box-shadow:var(--bh-shadow);cursor:pointer;color:#1f2937}
.bh-translator-btn:hover{transform:translateY(-1px)}.bh-translator-label{font-size:14px;font-weight:600}
.bh-translator-dd{position:absolute;right:0;margin-top:8px;background:var(--bh-bg);backdrop-filter:var(--bh-blur);border:1px solid rgba(108,92,231,.25);border-radius:14px;box-shadow:var(--bh-shadow);min-width:200px;padding:8px;display:none}
.bh-translator-wrap[aria-expanded="true"] .bh-translator-dd{display:block}
.bh-dd-item{display:flex;align-items:center;justify-content:space-between;width:100%;padding:10px 12px;border-radius:10px;background:transparent;border:0;cursor:pointer;color:#111827;font-size:14px;font-weight:600}
.bh-dd-item:hover{background:rgba(108,92,231,.08)}.bh-dd-item small{color:#6b7280}
@media(max-width:480px){.bh-translator-btn{padding:8px 12px;gap:8px}.bh-translator-dd{min-width:180px}}`;
    document.head.appendChild(st);

    var wrap=document.createElement('div'); wrap.id='bh-translator'; wrap.className='bh-translator-wrap'; wrap.setAttribute('aria-expanded','false');
    var btn=document.createElement('button'); btn.type='button'; btn.className='bh-translator-btn'; btn.setAttribute('aria-label','Language switcher');
    btn.innerHTML = '<svg class="bh-icn" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 21c4.97 0 9-4.03 9-9s-4.03-9-9-9-9 4.03-9 9 4.03 9 9 9Z" stroke="currentColor" stroke-width="1.6"></path><path d="M3 12h18M12 3c3 3.5 3 14 0 18M6 6c3.5 2 8.5 2 12 0M6 18c3.5-2 8.5-2 12 0" stroke="currentColor" stroke-width="1.2"></path></svg><span class="bh-translator-label" data-bh-no-translate>Lang: '+(BH_INITIAL||'pl').toUpperCase()+'</span>';
    var dd=document.createElement('div'); dd.className='bh-translator-dd'; dd.setAttribute('role','menu');
    BH_SUPPORTED.forEach(function(l){ var b=document.createElement('button'); b.type='button'; b.className='bh-dd-item'; b.setAttribute('data-lang',l.code); b.innerHTML='<span>'+l.label+'</span><small>'+l.code.toUpperCase()+'</small>'; dd.appendChild(b); });
    wrap.appendChild(btn); wrap.appendChild(dd); document.body.appendChild(wrap);
    btn.addEventListener('click', function(){ wrap.setAttribute('aria-expanded', wrap.getAttribute('aria-expanded')==='true'?'false':'true'); });
    document.addEventListener('click', function(e){ if(!wrap.contains(e.target)) wrap.setAttribute('aria-expanded','false'); });
    dd.addEventListener('click', function(e){ var b=e.target.closest('.bh-dd-item'); if(!b) return; wrap.setAttribute('aria-expanded','false'); window.bhSetLanguage(b.getAttribute('data-lang')); }, {passive:true});
    dd.addEventListener('pointerup', function(e){ var b=e.target.closest('.bh-dd-item'); if(!b) return; wrap.setAttribute('aria-expanded','false'); window.bhSetLanguage(b.getAttribute('data-lang')); }, {passive:true});
  }

  // ===== Narzędzia normalizacji i casing =====
  function stripDiacritics(s){
    return s.normalize('NFD').replace(/[\u0300-\u036f]/g,'');
  }
  function normKey(s){
    return stripDiacritics(String(s||'').toLowerCase())
      .replace(/\s+/g,' ')
      .replace(/[^\p{L}\p{N}\s\-]/gu,'')
      .trim();
  }
  function detectCase(sample){
    if (!sample) return 'lower';
    if (sample === sample.toUpperCase()) return 'upper';
    if (sample[0] === sample[0].toUpperCase()) return 'capitalized';
    return 'lower';
  }
  function applyCase(translated, sample){
    var mode = detectCase(sample);
    if (mode==='upper') return translated.toUpperCase();
    if (mode==='capitalized') return translated.charAt(0).toUpperCase()+translated.slice(1);
    return translated;
  }

  // ===== Wbudowane SŁOWNIKI (frazy i słowa bazowe) =====
  // Uwaga: rozszerz assets/i18n/{lang}.json – tutaj tylko trzon (UI + medyczne podstawy).
  var EMBED = {
    en: {
      // frazy dłuższe (n-gramy)
      "pierwsza pomoc":"first aid","telefon alarmowy":"emergency phone","kiedy sie niepokoic":"when to worry","czerwone flagi":"red flags",
      "na recepte":"prescription","bez recepty":"over-the-counter","wezwanie pogotowia":"call an ambulance",
      "objawy i przyczyny":"symptoms and causes","leczenie i leki":"treatment and medications",
      // pojedyncze słowa
      "szukaj":"search","szpital":"hospital","apteka":"pharmacy","lekarz":"doctor","leki":"medications","objawy":"symptoms","przyczyny":"causes",
      "kontakt":"contact","informacje":"information","uwaga":"warning","numer":"number","pomoc":"help","mapa":"map","adres":"address",
      "serce":"heart","pluca":"lungs","watroba":"liver","zoladek":"stomach","nerki":"kidneys","oko":"eye","ucho":"ear","nos":"nose","usta":"mouth",
      "plecy":"back","ramie":"arm","przedramie":"forearm","dlon":"hand","kolano":"knee","udo":"thigh","stopa":"foot","glowa":"head","szyja":"neck",
      "mezczyzna":"man","kobieta":"woman","dziecko":"child","nagle":"sudden","bol":"pain","goraczka":"fever","kaszel":"cough","duszność":"shortness of breath","zadlawienie":"choking"
    },
    de: {
      "pierwsza pomoc":"erste hilfe","telefon alarmowy":"notruf","kiedy sie niepokoic":"wann sorgen machen","czerwone flagi":"rote flaggen",
      "na recepte":"verschreibungspflichtig","bez recepty":"rezeptfrei","wezwanie pogotowia":"krankenwagen rufen",
      "objawy i przyczyny":"symptome und ursachen","leczenie i leki":"behandlung und medikamente",
      "szukaj":"suche","szpital":"krankenhaus","apteka":"apotheke","lekarz":"arzt","leki":"medikamente","objawy":"symptome","przyczyny":"ursachen",
      "kontakt":"kontakt","informacje":"informationen","uwaga":"achtung","numer":"nummer","pomoc":"hilfe","mapa":"karte","adres":"adresse",
      "serce":"herz","pluca":"lungen","watroba":"leber","zoladek":"magen","nerki":"nieren","oko":"auge","ucho":"ohr","nos":"nase","usta":"mund",
      "plecy":"rücken","ramie":"arm","przedramie":"unterarm","dlon":"hand","kolano":"knie","udo":"oberschenkel","stopa":"fuß","glowa":"kopf","szyja":"hals",
      "mezczyzna":"mann","kobieta":"frau","dziecko":"kind","bol":"schmerz","goraczka":"fieber","kaszel":"husten","duszność":"atemnot","zadlawienie":"erstickung"
    },
    uk: {
      "pierwsza pomoc":"перша допомога","telefon alarmowy":"екстрений номер","kiedy sie niepokoic":"коли варто хвилюватись","czerwone flagi":"тривожні ознаки",
      "na recepte":"за рецептом","bez recepty":"без рецепту","wezwanie pogotowia":"виклик швидкої",
      "objawy i przyczyny":"симптоми та причини","leczenie i leki":"лікування та ліки",
      "szukaj":"пошук","szpital":"лікарня","apteka":"аптека","lekarz":"лікар","leki":"ліки","objawy":"симптоми","przyczyny":"причини",
      "kontakt":"контакт","informacje":"інформація","uwaga":"увага","numer":"номер","pomoc":"допомога","mapa":"карта","adres":"адреса",
      "serce":"серце","pluca":"легені","watroba":"печінка","zoladek":"шлунок","nerki":"нири","oko":"око","ucho":"вухо","nos":"ніс","usta":"рот",
      "plecy":"спина","ramie":"рука","przedramie":"передпліччя","dlon":"кисть","kolano":"коліно","udo":"стегно","stopa":"стопа","glowa":"голова","szyja":"шия",
      "mezczyzna":"чоловік","kobieta":"жінка","dziecko":"дитина","bol":"біль","goraczka":"гарячка","kaszel":"кашель","duszność":"задишка","zadlawienie":"удушення"
    }
  };

  // ===== Cache oryginalnych tekstów =====
  var originalTextMap = new WeakMap(); // node -> oryginalny string (PL)
  var currentLang = document.documentElement.getAttribute('data-bh-current-lang') || BH_DEFAULT;

  // ===== Loader słownika (scalenie pliku i wbudowanego) =====
  function loadDict(lang){
    return new Promise(function(resolve){
      if (lang===BH_DEFAULT) return resolve({phr: {}, tok: {}});
      fetch('assets/i18n/'+lang+'.json', {cache:'no-store'}).then(function(r){
        if(!r.ok) throw 0; return r.json();
      }).then(function(fileJson){
        resolve(buildDict(lang, fileJson||{}));
      }).catch(function(){
        resolve(buildDict(lang, {}));
      });
    });
  }
  function buildDict(lang, fileJson){
    // Wejście plikowe może mieć formę { "PL fraza": "TL", ... }
    var base = EMBED[lang] || {};
    var merge = Object.assign({}, base, fileJson);
    var phr = {}; // frazy (n-gramy: 5..2)
    var tok = {}; // tokeny (1 słowo)
    Object.keys(merge).forEach(function(pl){
      var key = normKey(pl);
      if (!key) return;
      if (key.indexOf(' ')>0) phr[key] = merge[pl];
      else tok[key] = merge[pl];
    });
    return { phr: phr, tok: tok };
  }

  // ===== Tłumaczenie jednego ciągu znaków =====
  function translateStringFromPolish(str, dict){
    var src = String(str||'');
    var norm = normKey(src);
    if (!norm) return src;

    // 1) Najpierw pełne dopasowanie frazy
    if (dict.phr[norm]) {
      return applyCase(dict.phr[norm], src);
    }

    // 2) Tokenizacja + n-gramy wewnątrz zdania (5..2 słów)
    var words = norm.split(' ');
    var originalWords = src.split(/(\s+)/); // zachowaj spacje
    // Zbuduj mapę indeksów słów (bez spacji)
    var pure = src.match(/\S+|\s+/g) || [];
    // Stwórz kopię do podmian
    var out = src;

    // Priorytet: dłuższe n-gramy -> krótsze
    var maxN = Math.min(5, words.length);
    for (var n=maxN; n>=2; n--){
      for (var i=0; i<=words.length-n; i++){
        var slice = words.slice(i, i+n).join(' ');
        if (dict.phr[slice]){
          // znajdź oryginalny fragment przybliżony (reguła na znaki diaktryczne i interpunkcję)
          var regex = new RegExp('\\b' + words.slice(i, i+n).map(function(w){
            var w2 = stripDiacritics(w).replace(/[.*+?^${}()|[\]\\]/g,'\\$&');
            return w2;
          }).join('\\s+') + '\\b', 'i');
          out = out.replace(regex, function(m){ return applyCase(dict.phr[slice], m); });
        }
      }
    }

    // 3) Pojedyncze słowa
    out = out.replace(/\b([A-Za-zÀ-žĄąĆćĘęŁłŃńÓóŚśŹźŻż\-]+)\b/g, function(m){
      var key = normKey(m);
      var t = dict.tok[key];
      return t ? applyCase(t, m) : m;
    });

    return out;
  }

  // ===== Przejście po drzewie: TreeWalker (węzły tekstowe) =====
  function shouldSkip(node){
    if (!node) return true;
    if (node.nodeType !== 3) return true; // text
    var p = node.parentElement;
    if (!p) return true;
    if (p.closest('#bh-translator,[data-bh-no-translate]')) return true;
    if (['SCRIPT','STYLE','CODE','PRE','TEXTAREA','NOSCRIPT','SVG'].includes(p.tagName)) return true;
    return false;
  }

  function translateDocument(dict){
    var walker = document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT, null);
    var nodes = [];
    while (walker.nextNode()) nodes.push(walker.currentNode);

    nodes.forEach(function(textNode){
      if (shouldSkip(textNode)) return;

      // zapisz oryginał tylko raz (PL baseline)
      if (!originalTextMap.has(textNode)) {
        originalTextMap.set(textNode, textNode.nodeValue);
      }
      var baseline = originalTextMap.get(textNode);

      if (currentLang === 'pl') {
        // powrót do PL
        if (textNode.nodeValue !== baseline) textNode.nodeValue = baseline;
        return;
      }
      // tłumacz z baseline, nie z aktualnej wartości (idempotencja)
      var translated = translateStringFromPolish(baseline, dict);
      if (translated && translated !== textNode.nodeValue) {
        textNode.nodeValue = translated;
      }
    });

    // Atrybuty typu placeholder/title/aria-label – tylko jeśli były zdefiniowane
    document.querySelectorAll('[placeholder],[title],[aria-label]').forEach(function(el){
      if (el.closest('#bh-translator,[data-bh-no-translate]')) return;

      ['placeholder','title','aria-label'].forEach(function(attr){
        var val = el.getAttribute(attr);
        if (!val) return;
        var key = 'bh__orig__'+attr;
        if (!el.hasAttribute(key)) el.setAttribute(key, val); // baseline
        var baseline = el.getAttribute(key);
        if (currentLang === 'pl') {
          if (el.getAttribute(attr)!==baseline) el.setAttribute(attr, baseline);
        } else {
          var tr = translateStringFromPolish(baseline, dict);
          if (tr && tr !== el.getAttribute(attr)) el.setAttribute(attr, tr);
        }
      });
    });
  }

  var activeDict = { phr:{}, tok:{} };

  // ===== API globalne =====
  window.bhSetLanguage = function(lang){
    if (!BH_SUPPORTED.some(function(l){ return l.code===lang; })) return;
    if (lang === currentLang) return;

    localStorage.setItem(BH_STORE_KEY, lang);
    currentLang = lang;
    document.documentElement.setAttribute('data-bh-current-lang', lang);

    var label = document.querySelector('#bh-translator .bh-translator-label');
    if (label) label.textContent = 'Lang: ' + lang.toUpperCase();

    if (lang === 'pl'){
      translateDocument(activeDict); // przywróć baseline
      return;
    }
    loadDict(lang).then(function(dict){
      activeDict = dict;
      translateDocument(activeDict);
    });
  };

  // ===== Inicjalizacja =====
  function init(){
    ensureUI();
    // ustaw label zgodnie z zapisem
    var saved = localStorage.getItem(BH_STORE_KEY);
    var label = document.querySelector('#bh-translator .bh-translator-label');
    if (label && saved) label.textContent = 'Lang: ' + saved.toUpperCase();

    if (BH_INITIAL !== 'pl') {
      // ładuj słownik i tłumacz od razu
      currentLang = BH_INITIAL;
      document.documentElement.setAttribute('data-bh-current-lang', currentLang);
      loadDict(currentLang).then(function(dict){
        activeDict = dict;
        translateDocument(activeDict);
      });
    } else {
      currentLang = 'pl';
      document.documentElement.setAttribute('data-bh-current-lang', 'pl');
    }

    // Obserwator dla dynamicznego DOM
    var mo = new MutationObserver(function(muts){
      if (currentLang==='pl') return;
      var need=false;
      for (var i=0;i<muts.length;i++){
        if (muts[i].type==='childList' && muts[i].addedNodes.length){ need=true; break; }
      }
      if (need) translateDocument(activeDict);
    });
    mo.observe(document.body, {childList:true, subtree:true});
  }
  if (document.readyState==='loading') document.addEventListener('DOMContentLoaded', init); else init();
})();
</script>
<!-- END bh-patch:translator-fix-v3 -->
<!-- BEGIN bh-patch:translator-fix-v4 -->
<script>
(function(){
  if (window.__bhPatchTranslatorFixV4__) return;
  window.__bhPatchTranslatorFixV4__ = 1;

  // ---------- KONFIG ----------
  var BH_SUPPORTED = [
    { code:'pl', label:'Polski' },
    { code:'en', label:'English' },
    { code:'de', label:'Deutsch' },
    { code:'uk', label:'Українська' }
  ];
  var STORE = 'bh-lang';
  var SESSION_LOCK = 'bh-lang-session-lock'; // aby nie nadpisywać wyboru w obrębie sesji
  var DEFAULT = 'pl';

  // ---------- WYŁĄCZ GOOGLE TRANSLATE UI ----------
  (function antiGT(){
    if (!document.querySelector('meta[name="google"][content*="notranslate"]')) {
      var m=document.createElement('meta'); m.name='google'; m.content='notranslate'; document.head.appendChild(m);
    }
    var s=document.createElement('style'); s.textContent = `
.goog-te-banner-frame,.goog-te-gadget,.goog-tooltip,.goog-te-balloon-frame,#google_translate_element,
.VIpgJd-ZVi9od-ORHb,.VIpgJd-ZVi9od-l4eHX-hSRGPd,.VIpgJd-ZVi9od-ORHb-OEVmcd{display:none!important;visibility:hidden!important}
body{top:0!important}`;
    s.setAttribute('data-bh-style','anti-google-translate'); document.head.appendChild(s);
    try{ localStorage.removeItem('googtrans'); sessionStorage.removeItem('googtrans'); }catch(_){}
    window.googleTranslateElementInit = function(){};
  })();

  // ---------- DICTIONARIES (rdzeń UI + medyczne podstawy; rozszerz plikami assets/i18n/{lang}.json) ----------
  function stripDiacritics(s){ return String(s||'').normalize('NFD').replace(/[\u0300-\u036f]/g,''); }
  function keyNorm(s){ return stripDiacritics(String(s||'').toLowerCase()).replace(/[^\p{L}\p{N}\s\-]/gu,'').replace(/\s+/g,' ').trim(); }
  function caseOf(sample){ if(!sample) return 'lower'; if(sample===sample.toUpperCase()) return 'upper'; if(sample[0]===sample[0].toUpperCase()) return 'cap'; return 'lower'; }
  function applyCase(t,s){ var k=caseOf(s); if(k==='upper') return t.toUpperCase(); if(k==='cap') return t.charAt(0).toUpperCase()+t.slice(1); return t; }

  var EMBED = {
    en: {
      // FRAZY (n-gramy)
      "pierwsza pomoc": "first aid",
      "telefon alarmowy": "emergency phone",
      "kiedy sie niepokoic": "when to worry",
      "czerwone flagi": "red flags",
      "na recepte": "prescription",
      "bez recepty": "over-the-counter",
      "objawy i przyczyny": "symptoms and causes",
      "leczenie i leki": "treatment and medications",
      "masz objawy alarmowe nie zwlekaj": "red-flag symptoms? do not wait",
      "zadzwon 112": "call 112",
      "ryzyko niskie": "low risk",
      "pokaz wiecej": "show more",
      "zaznacz": "select",
      "zobacz podpowiedzi": "see suggestions",
      "rekomendacje profilaktyka": "recommendations / prevention",
      "rekomendacje / profilaktyka": "recommendations / prevention",
      "leki otc": "otc medications",
      "leki na recepte": "prescription medications",
      // SŁOWA
      "szukaj":"search","objawy":"symptoms","przyczyny":"causes","leki":"medications","lekarz":"doctor",
      "apteka":"pharmacy","szpital":"hospital","kontakt":"contact","informacje":"information",
      "glowa":"head","szyja":"neck","gardlo":"throat","oko":"eye","ucho":"ear","nos":"nose","usta":"mouth",
      "plecy":"back","ramie":"arm","przedramie":"forearm","dlon":"hand","bark":"shoulder","klatka":"chest",
      "brzuch":"stomach","biodro":"hip","udo":"thigh","kolano":"knee","lydka":"calf","stopa":"foot",
      "mezczyzna":"man","kobieta":"woman","dziecko":"child",
      "bor": "pain","bol": "pain","goraczka":"fever","kaszel":"cough","duszność":"shortness of breath","zadlawienie":"choking"
    },
    de: {
      "pierwsza pomoc":"erste hilfe","telefon alarmowy":"notruf","kiedy sie niepokoic":"wann sorgen machen","czerwone flagi":"rote flaggen",
      "na recepte":"verschreibungspflichtig","bez recepty":"rezeptfrei","objawy i przyczyny":"symptome und ursachen","leczenie i leki":"behandlung und medikamente",
      "masz objawy alarmowe nie zwlekaj":"alarm-symptome? nicht warten","zadzwon 112":"ruf 112","ryzyko niskie":"geringes risiko","pokaz wiecej":"mehr anzeigen",
      "zaznacz":"auswählen","zobacz podpowiedzi":"vorschläge ansehen","rekomendacje / profilaktyka":"empfehlungen / prävention",
      "szukaj":"suche","objawy":"symptome","przyczyny":"ursachen","leki":"medikamente","lekarz":"arzt",
      "apteka":"apotheke","szpital":"krankenhaus","kontakt":"kontakt","informacje":"informationen",
      "glowa":"kopf","szyja":"hals","gardlo":"rachen","oko":"auge","ucho":"ohr","nos":"nase","usta":"mund",
      "plecy":"rücken","ramie":"arm","przedramie":"unterarm","dlon":"hand","bark":"schulter","klatka":"brust",
      "brzuch":"magen","biodro":"hüfte","udo":"oberschenkel","kolano":"knie","lydka":"wade","stopa":"fuß",
      "mezczyzna":"mann","kobieta":"frau","dziecko":"kind","bol":"schmerz","goraczka":"fieber","kaszel":"husten","duszność":"atemnot","zadlawienie":"erstickung"
    },
    uk: {
      "pierwsza pomoc":"перша допомога","telefon alarmowy":"екстрений номер","kiedy sie niepokoic":"коли варто хвилюватися","czerwone flagi":"тривожні ознаки",
      "na recepte":"за рецептом","bez recepty":"без рецепту","objawy i przyczyny":"симптоми та причини","leczenie i leki":"лікування та ліки",
      "masz objawy alarmowe nie zwlekaj":"тривожні симптоми? не зволікай","zadzwon 112":"зателефонуй 112","ryzyko niskie":"низький ризик","pokaz wiecej":"показати більше",
      "zaznacz":"познач","zobacz podpowiedzi":"переглянути підказки","rekomendacje / profilaktyka":"рекомендації / профілактика",
      "szukaj":"пошук","objawy":"симптоми","przyczyny":"причини","leki":"ліки","lekarz":"лікар",
      "apteka":"аптека","szpital":"лікарня","kontakt":"контакт","informacje":"інформація",
      "glowa":"голова","szyja":"шия","gardlo":"горло","oko":"око","ucho":"вухо","nos":"ніс","usta":"рот",
      "plecy":"спина","ramie":"рука","przedramie":"передпліччя","dlon":"кисть","bark":"плече","klatka":"груди",
      "brzuch":"живіт","biodro":"стегно","udo":"стегно","kolano":"коліно","lydka":"литка","stopa":"ступня",
      "mezczyzna":"чоловік","kobieta":"жінка","dziecko":"дитина","bol":"біль","goraczka":"гарячка","kaszel":"кашель","duszność":"задишка","zadlawienie":"удушення"
    }
  };

  function buildDict(lang, fileJson){
    var merged = Object.assign({}, EMBED[lang]||{}, fileJson||{});
    var phr={}, tok={};
    Object.keys(merged).forEach(function(pl){
      var k=keyNorm(pl); if(!k) return;
      if (k.indexOf(' ')>0) phr[k]=merged[pl]; else tok[k]=merged[pl];
    });
    return {phr:phr, tok:tok};
  }

  function loadDict(lang){
    return new Promise(function(resolve){
      if (lang==='pl') return resolve({phr:{},tok:{}});
      fetch('assets/i18n/'+lang+'.json', {cache:'no-store'})
       .then(function(r){ if(!r.ok) throw 0; return r.json(); })
       .then(function(j){ resolve(buildDict(lang, j)); })
       .catch(function(){ resolve(buildDict(lang, {})); });
    });
  }

  // ---------- UI (jeśli brak) ----------
  function ensureUI(){
    if (document.getElementById('bh-translator')) return;
    var st=document.createElement('style'); st.textContent=`
:root{--bh-accent:#6c5ce7;--bh-bg:rgba(255,255,255,.75);--bh-shadow:0 8px 20px rgba(0,0,0,.12);--bh-radius:16px;--bh-blur:saturate(1.2) blur(6px);--bh-z:9999;--bh-font:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,"Noto Sans","Liberation Sans","Helvetica Neue",sans-serif}
.bh-translator-wrap{position:fixed;top:12px;right:12px;z-index:var(--bh-z);font-family:var(--bh-font)}
.bh-translator-btn{display:flex;align-items:center;gap:10px;padding:10px 14px;background:var(--bh-bg);backdrop-filter:var(--bh-blur);border:1px solid rgba(108,92,231,.25);border-radius:16px;box-shadow:var(--bh-shadow);cursor:pointer;color:#1f2937}
.bh-translator-btn:hover{transform:translateY(-1px)}
.bh-translator-label{font-size:14px;font-weight:600}
.bh-translator-dd{position:absolute;right:0;margin-top:8px;background:var(--bh-bg);backdrop-filter:var(--bh-blur);border:1px solid rgba(108,92,231,.25);border-radius:14px;box-shadow:var(--bh-shadow);min-width:200px;padding:8px;display:none}
.bh-translator-wrap[aria-expanded="true"] .bh-translator-dd{display:block}
.bh-dd-item{display:flex;align-items:center;justify-content:space-between;width:100%;padding:10px 12px;border-radius:10px;background:transparent;border:0;cursor:pointer;color:#111827;font-size:14px;font-weight:600}
.bh-dd-item:hover{background:rgba(108,92,231,.08)}`; st.setAttribute('data-bh-style','translator-core'); document.head.appendChild(st);

    var wrap=document.createElement('div'); wrap.id='bh-translator'; wrap.className='bh-translator-wrap'; wrap.setAttribute('aria-expanded','false');
    var btn=document.createElement('button'); btn.type='button'; btn.className='bh-translator-btn'; btn.setAttribute('aria-label','Language switcher');
    btn.innerHTML = '<span class="bh-translator-label" data-bh-no-translate>Lang: PL</span>';
    var dd=document.createElement('div'); dd.className='bh-translator-dd'; dd.setAttribute('role','menu');
    BH_SUPPORTED.forEach(function(l){ var b=document.createElement('button'); b.type='button'; b.className='bh-dd-item'; b.setAttribute('data-lang',l.code); b.innerHTML='<span>'+l.label+'</span><small>'+l.code.toUpperCase()+'</small>'; dd.appendChild(b); });
    wrap.appendChild(btn); wrap.appendChild(dd); document.body.appendChild(wrap);

    btn.addEventListener('click', function(){ wrap.setAttribute('aria-expanded', wrap.getAttribute('aria-expanded')==='true'?'false':'true'); });
    document.addEventListener('click', function(e){ if(!wrap.contains(e.target)) wrap.setAttribute('aria-expanded','false'); });
    dd.addEventListener('click', function(e){ var b=e.target.closest('.bh-dd-item'); if(!b) return; wrap.setAttribute('aria-expanded','false'); window.bhSetLanguage(b.getAttribute('data-lang')); }, {passive:true});
    dd.addEventListener('pointerup', function(e){ var b=e.target.closest('.bh-dd-item'); if(!b) return; wrap.setAttribute('aria-expanded','false'); window.bhSetLanguage(b.getAttribute('data-lang')); }, {passive:true});
  }

  // ---------- MECHANIKA TŁUMACZEŃ ----------
  var originalText = new WeakMap(); // textNode -> baseline PL
  var currentLang = 'pl';
  var dictActive = {phr:{}, tok:{}};

  function translateStringPL(src, dict){
    var s = String(src||'');
    var norm = keyNorm(s);
    if (!norm) return s;

    // pełne frazy
    if (dict.phr[norm]) return applyCase(dict.phr[norm], s);

    // n-gramy 5..2
    var words = norm.split(' ');
    var out = s;
    var maxN = Math.min(5, words.length);
    for (var n=maxN; n>=2; n--){
      for (var i=0; i<=words.length-n; i++){
        var slice = words.slice(i, i+n).join(' ');
        if (dict.phr[slice]){
          var re = new RegExp('\\b' + words.slice(i, i+n).map(function(w){ return stripDiacritics(w).replace(/[.*+?^${}()|[\]\\]/g,'\\$&'); }).join('\\s+') + '\\b','i');
          out = out.replace(re, function(m){ return applyCase(dict.phr[slice], m); });
        }
      }
    }
    // słowa
    out = out.replace(/\b([A-Za-zÀ-žĄąĆćĘęŁłŃńÓóŚśŹźŻż\-]+)\b/g, function(m){
      var k=keyNorm(m); var t=dict.tok[k]; return t?applyCase(t,m):m;
    });
    return out;
  }

  function shouldSkipTextNode(node){
    if (!node || node.nodeType!==3) return true;
    var p=node.parentElement; if(!p) return true;
    if (p.closest('#bh-translator,[data-bh-no-translate]')) return true;
    if (['SCRIPT','STYLE','CODE','PRE','TEXTAREA','NOSCRIPT','SVG'].includes(p.tagName)) return true;
    return false;
  }

  function applyTranslation(){
    var tw=document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT, null);
    var nodes=[]; while(tw.nextNode()) nodes.push(tw.currentNode);

    nodes.forEach(function(tn){
      if (shouldSkipTextNode(tn)) return;

      // baseline PL zapisujemy tylko, gdy nie istnieje
      if (!originalText.has(tn)) originalText.set(tn, tn.nodeValue);

      var baseline = originalText.get(tn);
      if (currentLang==='pl') {
        if (tn.nodeValue!==baseline) tn.nodeValue = baseline;
      } else {
        var tr = translateStringPL(baseline, dictActive);
        if (tr && tr!==tn.nodeValue) tn.nodeValue = tr;
      }
    });

    // atrybuty
    document.querySelectorAll('[placeholder],[title],[aria-label]').forEach(function(el){
      if (el.closest('#bh-translator,[data-bh-no-translate]')) return;
      ['placeholder','title','aria-label'].forEach(function(attr){
        var v = el.getAttribute(attr); if (v==null) return;
        var key = 'data-bh-orig-'+attr;
        if (!el.hasAttribute(key)) el.setAttribute(key, v);
        var base = el.getAttribute(key);
        if (currentLang==='pl') el.setAttribute(attr, base);
        else el.setAttribute(attr, translateStringPL(base, dictActive));
      });
    });
  }

  function installObserver(){
    var mo=new MutationObserver(function(muts){
      if (currentLang==='pl') return;
      var changed=false;
      for (var i=0;i<muts.length;i++){
        if (muts[i].type==='childList' && muts[i].addedNodes.length){ changed=true; break; }
      }
      if (changed) applyTranslation();
    });
    mo.observe(document.body, {childList:true, subtree:true});
  }

  // ---------- API ----------
  window.bhSetLanguage = function(lang){
    if (!BH_SUPPORTED.some(function(l){return l.code===lang;})) return;
    currentLang = lang;
    localStorage.setItem(STORE, lang);
    sessionStorage.setItem(SESSION_LOCK, '1'); // użytkownik dokonał wyboru w tej sesji
    var label=document.querySelector('#bh-translator .bh-translator-label'); if (label) label.textContent='Lang: '+lang.toUpperCase();

    if (lang==='pl'){ applyTranslation(); return; }
    loadDict(lang).then(function(d){ dictActive=d; applyTranslation(); });
  };

  // ---------- START (WYMUSZENIE PL NA WEJŚCIU) ----------
  function getQueryLang(){
    var m=location.search.match(/[?&]lang=([a-z]{2})/i);
    return m ? m[1].toLowerCase() : null;
  }

  function init(){
    ensureUI();

    // Jeśli przychodzimy „z zewnątrz” i nie ma blokady sesji – start w PL (reset starego wyboru).
    var qLang = getQueryLang();
    var sessionLocked = sessionStorage.getItem(SESSION_LOCK)==='1';
    if (!sessionLocked && !qLang) {
      try{ localStorage.setItem(STORE, 'pl'); }catch(_){}
      currentLang = 'pl';
    } else {
      currentLang = (qLang || localStorage.getItem(STORE) || 'pl');
    }

    // Ustaw label
    var lbl=document.querySelector('#bh-translator .bh-translator-label');
    if (lbl) lbl.textContent='Lang: '+(currentLang||'pl').toUpperCase();

    if (currentLang==='pl'){ applyTranslation(); } 
    else { loadDict(currentLang).then(function(d){ dictActive=d; applyTranslation(); }); }

    installObserver();
  }

  if (document.readyState==='loading') document.addEventListener('DOMContentLoaded', init); else init();

})();
</script>
<!-- END bh-patch:translator-fix-v4 -->
</body>
</html>
